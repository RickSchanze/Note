{"ID":"20240730141740-ue7pasj","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240730141740-ue7pasj","title":"Chapter 9 Physically Based Shading 基于物理的着色","type":"doc","updated":"20240730143035"},"Children":[{"ID":"20240730143035-v6ps597","Type":"NodeParagraph","Properties":{"id":"20240730143035-v6ps597"}},{"ID":"20240730141741-guz1xqc","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240730141741-guz1xqc","updated":"20240730141741"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"# ","Properties":{"id":""}},{"Type":"NodeText","Data":"Chapter 9 Physically Based Shading 基于物理的着色"}]},{"ID":"20240730141742-x36rob5","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240730141742-x36rob5","updated":"20240730141742"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"目录"}]},{"ID":"20240730141743-ygtt088","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141743-ygtt088","updated":"20240730141743"},"Children":[{"ID":"20240730141744-g6q717o","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141744-g6q717o","updated":"20240730141744"},"Children":[{"ID":"20240730141745-kpg61cs","Type":"NodeParagraph","Properties":{"id":"20240730141745-kpg61cs","updated":"20240730141745"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#91-光的物理学","TextMarkTextContent":"9.1 光的物理学"}]},{"ID":"20240730141746-fg47hjy","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141746-fg47hjy","updated":"20240730141746"},"Children":[{"ID":"20240730141747-5ym8wwj","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141747-5ym8wwj","updated":"20240730141747"},"Children":[{"ID":"20240730141748-cdy6uqm","Type":"NodeParagraph","Properties":{"id":"20240730141748-cdy6uqm","updated":"20240730141748"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#911-粒子","TextMarkTextContent":"9.1.1 粒子"}]}]},{"ID":"20240730141749-tgzooax","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141749-tgzooax","updated":"20240730141749"},"Children":[{"ID":"20240730141750-i6w8k8q","Type":"NodeParagraph","Properties":{"id":"20240730141750-i6w8k8q","updated":"20240730141750"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#912-介质","TextMarkTextContent":"9.1.2 介质"}]}]},{"ID":"20240730141751-nhpfsh5","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141751-nhpfsh5","updated":"20240730141751"},"Children":[{"ID":"20240730141752-wwn0ofc","Type":"NodeParagraph","Properties":{"id":"20240730141752-wwn0ofc","updated":"20240730141752"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#913-表面","TextMarkTextContent":"9.1.3 表面"}]}]},{"ID":"20240730141753-dv2gpu8","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141753-dv2gpu8","updated":"20240730141753"},"Children":[{"ID":"20240730141754-90sm6cn","Type":"NodeParagraph","Properties":{"id":"20240730141754-90sm6cn","updated":"20240730141754"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#914-次表面散射","TextMarkTextContent":"9.1.4 次表面散射"}]}]}]}]},{"ID":"20240730141755-7rk7lze","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141755-7rk7lze","updated":"20240730141755"},"Children":[{"ID":"20240730141756-gu9hecz","Type":"NodeParagraph","Properties":{"id":"20240730141756-gu9hecz","updated":"20240730141756"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#92-相机","TextMarkTextContent":"9.2 相机"}]}]},{"ID":"20240730141757-j90zrwo","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141757-j90zrwo","updated":"20240730141757"},"Children":[{"ID":"20240730141758-q8k846o","Type":"NodeParagraph","Properties":{"id":"20240730141758-q8k846o","updated":"20240730141758"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#93-The-BRDF","TextMarkTextContent":"9.3 The BRDF"}]}]},{"ID":"20240730141759-j3ayjbb","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141759-j3ayjbb","updated":"20240730141759"},"Children":[{"ID":"20240730141760-xwn5mz6","Type":"NodeParagraph","Properties":{"id":"20240730141760-xwn5mz6","updated":"20240730141760"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#94-光照Illumination","TextMarkTextContent":"9.4 光照（Illumination）"}]}]},{"ID":"20240730141761-ur8w9c1","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141761-ur8w9c1","updated":"20240730141761"},"Children":[{"ID":"20240730141762-wr2022q","Type":"NodeParagraph","Properties":{"id":"20240730141762-wr2022q","updated":"20240730141762"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#95-菲涅尔反射","TextMarkTextContent":"9.5 菲涅尔反射"}]},{"ID":"20240730141763-40i509f","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141763-40i509f","updated":"20240730141763"},"Children":[{"ID":"20240730141764-wtefd9v","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141764-wtefd9v","updated":"20240730141764"},"Children":[{"ID":"20240730141765-ehp1r9f","Type":"NodeParagraph","Properties":{"id":"20240730141765-ehp1r9f","updated":"20240730141765"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#951-外反射","TextMarkTextContent":"9.5.1 外反射"}]}]},{"ID":"20240730141766-8t8qrwh","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141766-8t8qrwh","updated":"20240730141766"},"Children":[{"ID":"20240730141767-6hv3lf4","Type":"NodeParagraph","Properties":{"id":"20240730141767-6hv3lf4","updated":"20240730141767"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#952-典型的菲涅尔反射值","TextMarkTextContent":"9.5.2 典型的菲涅尔反射值"}]},{"ID":"20240730141768-n2tm265","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141768-n2tm265","updated":"20240730141768"},"Children":[{"ID":"20240730141769-l7askfz","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141769-l7askfz","updated":"20240730141769"},"Children":[{"ID":"20240730141770-k77rbp6","Type":"NodeParagraph","Properties":{"id":"20240730141770-k77rbp6","updated":"20240730141770"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#电介质的菲涅尔反射率","TextMarkTextContent":"电介质的菲涅尔反射率"}]}]},{"ID":"20240730141771-p6fptfq","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141771-p6fptfq","updated":"20240730141771"},"Children":[{"ID":"20240730141772-tftkdle","Type":"NodeParagraph","Properties":{"id":"20240730141772-tftkdle","updated":"20240730141772"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#金属的菲涅尔反射率","TextMarkTextContent":"金属的菲涅尔反射率"}]}]},{"ID":"20240730141773-s58udlr","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141773-s58udlr","updated":"20240730141773"},"Children":[{"ID":"20240730141774-f15liwn","Type":"NodeParagraph","Properties":{"id":"20240730141774-f15liwn","updated":"20240730141774"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#半导体的菲涅尔反射值","TextMarkTextContent":"半导体的菲涅尔反射值"}]}]},{"ID":"20240730141775-umoykr5","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141775-umoykr5","updated":"20240730141775"},"Children":[{"ID":"20240730141776-vq7lokm","Type":"NodeParagraph","Properties":{"id":"20240730141776-vq7lokm","updated":"20240730141776"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#水中的菲涅尔反射率","TextMarkTextContent":"水中的菲涅尔反射率"}]}]},{"ID":"20240730141777-a9tbrx9","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141777-a9tbrx9","updated":"20240730141777"},"Children":[{"ID":"20240730141778-jqnxv1e","Type":"NodeParagraph","Properties":{"id":"20240730141778-jqnxv1e","updated":"20240730141778"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#参数化的菲涅尔值","TextMarkTextContent":"参数化的菲涅尔值"}]}]}]}]},{"ID":"20240730141779-nlq03cy","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141779-nlq03cy","updated":"20240730141779"},"Children":[{"ID":"20240730141780-673qzdr","Type":"NodeParagraph","Properties":{"id":"20240730141780-673qzdr","updated":"20240730141780"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#953-内反射","TextMarkTextContent":"9.5.3 内反射"}]}]}]}]},{"ID":"20240730141781-i7o4ow5","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141781-i7o4ow5","updated":"20240730141781"},"Children":[{"ID":"20240730141782-pecw98u","Type":"NodeParagraph","Properties":{"id":"20240730141782-pecw98u","updated":"20240730141782"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#96-微观几何Microgeometry","TextMarkTextContent":"9.6 微观几何（Microgeometry）"}]}]},{"ID":"20240730141783-g0tt5q9","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141783-g0tt5q9","updated":"20240730141783"},"Children":[{"ID":"20240730141784-5wh5m6o","Type":"NodeParagraph","Properties":{"id":"20240730141784-5wh5m6o","updated":"20240730141784"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#97-微表面理论","TextMarkTextContent":"9.7 微表面理论"}]}]},{"ID":"20240730141785-8z4y92i","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141785-8z4y92i","updated":"20240730141785"},"Children":[{"ID":"20240730141786-h59s0ql","Type":"NodeParagraph","Properties":{"id":"20240730141786-h59s0ql","updated":"20240730141786"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#98-表面反射的BRDF模型","TextMarkTextContent":"9.8 表面反射的BRDF模型"}]},{"ID":"20240730141787-3mbn8lk","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141787-3mbn8lk","updated":"20240730141787"},"Children":[{"ID":"20240730141788-4z4esvc","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141788-4z4esvc","updated":"20240730141788"},"Children":[{"ID":"20240730141789-clswqwo","Type":"NodeParagraph","Properties":{"id":"20240730141789-clswqwo","updated":"20240730141789"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#981-法线分布函数","TextMarkTextContent":"9.8.1 法线分布函数"}]},{"ID":"20240730141790-fdhdm31","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141790-fdhdm31","updated":"20240730141790"},"Children":[{"ID":"20240730141791-tu87clr","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141791-tu87clr","updated":"20240730141791"},"Children":[{"ID":"20240730141792-9kupfsv","Type":"NodeParagraph","Properties":{"id":"20240730141792-9kupfsv","updated":"20240730141792"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#各项同性法线分布函数","TextMarkTextContent":"各项同性法线分布函数"}]}]},{"ID":"20240730141793-gk0imz0","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141793-gk0imz0","updated":"20240730141793"},"Children":[{"ID":"20240730141794-d9di5ju","Type":"NodeParagraph","Properties":{"id":"20240730141794-d9di5ju","updated":"20240730141794"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#各项异性法线分布函数","TextMarkTextContent":"各项异性法线分布函数"}]}]}]}]},{"ID":"20240730141795-6uwmpyx","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141795-6uwmpyx","updated":"20240730141795"},"Children":[{"ID":"20240730141796-33st3pz","Type":"NodeParagraph","Properties":{"id":"20240730141796-33st3pz","updated":"20240730141796"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#982-多次反弹的表面反射","TextMarkTextContent":"9.8.2 多次反弹的表面反射"}]}]}]}]},{"ID":"20240730141797-4s6e336","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141797-4s6e336","updated":"20240730141797"},"Children":[{"ID":"20240730141798-85x0k00","Type":"NodeParagraph","Properties":{"id":"20240730141798-85x0k00","updated":"20240730141798"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#99-次表面散射的BRDF模型","TextMarkTextContent":"9.9 次表面散射的BRDF模型"}]},{"ID":"20240730141799-f7ahkz9","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141799-f7ahkz9","updated":"20240730141799"},"Children":[{"ID":"20240730141800-oa6hyx8","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141800-oa6hyx8","updated":"20240730141800"},"Children":[{"ID":"20240730141801-ig1ydmo","Type":"NodeParagraph","Properties":{"id":"20240730141801-ig1ydmo","updated":"20240730141801"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#991-次表面反照率","TextMarkTextContent":"9.9.1 次表面反照率"}]}]},{"ID":"20240730141802-7ocuihm","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141802-7ocuihm","updated":"20240730141802"},"Children":[{"ID":"20240730141803-26jrihd","Type":"NodeParagraph","Properties":{"id":"20240730141803-26jrihd","updated":"20240730141803"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#992-次表面散射和粗糙的尺度","TextMarkTextContent":"9.9.2 次表面散射和粗糙的尺度"}]}]},{"ID":"20240730141804-m3xkg7f","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141804-m3xkg7f","updated":"20240730141804"},"Children":[{"ID":"20240730141805-2kqcu6j","Type":"NodeParagraph","Properties":{"id":"20240730141805-2kqcu6j","updated":"20240730141805"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#993-光滑表面的次表面模型","TextMarkTextContent":"9.9.3 光滑表面的次表面模型"}]}]},{"ID":"20240730141806-ty86fvv","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141806-ty86fvv","updated":"20240730141806"},"Children":[{"ID":"20240730141807-ij0zf6v","Type":"NodeParagraph","Properties":{"id":"20240730141807-ij0zf6v","updated":"20240730141807"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#994-粗糙表面的次表面模型","TextMarkTextContent":"9.9.4 粗糙表面的次表面模型"}]}]}]}]},{"ID":"20240730141808-gw85na4","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141808-gw85na4","updated":"20240730141808"},"Children":[{"ID":"20240730141809-gzx99wi","Type":"NodeParagraph","Properties":{"id":"20240730141809-gzx99wi","updated":"20240730141809"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#910-布料的BRDF模型","TextMarkTextContent":"9.10 布料的BRDF模型"}]},{"ID":"20240730141810-9w68ubv","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141810-9w68ubv","updated":"20240730141810"},"Children":[{"ID":"20240730141811-dcu6wes","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141811-dcu6wes","updated":"20240730141811"},"Children":[{"ID":"20240730141812-dxkbdk0","Type":"NodeParagraph","Properties":{"id":"20240730141812-dxkbdk0","updated":"20240730141812"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#9101-经验布料模型","TextMarkTextContent":"9.10.1 经验布料模型"}]}]},{"ID":"20240730141813-6p0a25j","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141813-6p0a25j","updated":"20240730141813"},"Children":[{"ID":"20240730141814-7akjshu","Type":"NodeParagraph","Properties":{"id":"20240730141814-7akjshu","updated":"20240730141814"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#9102-微表面布料模型","TextMarkTextContent":"9.10.2 微表面布料模型"}]}]},{"ID":"20240730141815-7o4s5ef","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141815-7o4s5ef","updated":"20240730141815"},"Children":[{"ID":"20240730141816-smj2dsk","Type":"NodeParagraph","Properties":{"id":"20240730141816-smj2dsk","updated":"20240730141816"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#9103-微圆柱体布料模型","TextMarkTextContent":"9.10.3 微圆柱体布料模型"}]}]}]}]},{"ID":"20240730141817-pbbxgtb","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141817-pbbxgtb","updated":"20240730141817"},"Children":[{"ID":"20240730141818-n49u1as","Type":"NodeParagraph","Properties":{"id":"20240730141818-n49u1as","updated":"20240730141818"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#911波动光学的BRDF模型","TextMarkTextContent":"9.11波动光学的BRDF模型"}]},{"ID":"20240730141819-eakgs1i","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141819-eakgs1i","updated":"20240730141819"},"Children":[{"ID":"20240730141820-wo9iqi8","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141820-wo9iqi8","updated":"20240730141820"},"Children":[{"ID":"20240730141821-4oidhhm","Type":"NodeParagraph","Properties":{"id":"20240730141821-4oidhhm","updated":"20240730141821"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#9111-衍射模型","TextMarkTextContent":"9.11.1 衍射模型"}]}]},{"ID":"20240730141822-vh9jgw6","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141822-vh9jgw6","updated":"20240730141822"},"Children":[{"ID":"20240730141823-qlixt6u","Type":"NodeParagraph","Properties":{"id":"20240730141823-qlixt6u","updated":"20240730141823"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#9112-薄膜干涉模型","TextMarkTextContent":"9.11.2 薄膜干涉模型"}]}]}]}]},{"ID":"20240730141824-fuj6jno","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141824-fuj6jno","updated":"20240730141824"},"Children":[{"ID":"20240730141825-egzrn58","Type":"NodeParagraph","Properties":{"id":"20240730141825-egzrn58","updated":"20240730141825"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#912-分层材质","TextMarkTextContent":"9.12 分层材质"}]}]},{"ID":"20240730141826-jw3ac6p","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141826-jw3ac6p","updated":"20240730141826"},"Children":[{"ID":"20240730141827-if5wihx","Type":"NodeParagraph","Properties":{"id":"20240730141827-if5wihx","updated":"20240730141827"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#913-混合和过滤材质","TextMarkTextContent":"9.13 混合和过滤材质"}]},{"ID":"20240730141828-1tvctzx","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141828-1tvctzx","updated":"20240730141828"},"Children":[{"ID":"20240730141829-bvbvh7n","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141829-bvbvh7n","updated":"20240730141829"},"Children":[{"ID":"20240730141830-tuy5q7n","Type":"NodeParagraph","Properties":{"id":"20240730141830-tuy5q7n","updated":"20240730141830"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#9131过滤法线与法线分布","TextMarkTextContent":"9.13.1过滤法线与法线分布"}]}]}]}]},{"ID":"20240730141831-qhl2aja","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141831-qhl2aja","updated":"20240730141831"},"Children":[{"ID":"20240730141832-nw7k4k7","Type":"NodeParagraph","Properties":{"id":"20240730141832-nw7k4k7","updated":"20240730141832"},"Children":[{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"#补充阅读和资源","TextMarkTextContent":"补充阅读和资源"}]}]}]},{"ID":"20240730141833-771ravi","Type":"NodeBlockquote","Properties":{"id":"20240730141833-771ravi","updated":"20240730141833"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240730141834-iszoe00","Type":"NodeParagraph","Properties":{"id":"20240730141834-iszoe00","updated":"20240730141834"},"Children":[{"Type":"NodeText","Data":"John Constable ——“There is nothing ugly; I never saw an ugly thing in my life: for let the form of an object be what it may, — light, shade, and perspective will always make it beautiful.”"}]}]},{"ID":"20240730141835-70tqg9l","Type":"NodeBlockquote","Properties":{"id":"20240730141835-70tqg9l","updated":"20240730141835"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240730141836-970erb2","Type":"NodeParagraph","Properties":{"id":"20240730141836-970erb2","updated":"20240730141836"},"Children":[{"Type":"NodeText","Data":"约翰·康斯太勃尔——“没有什么是丑陋的；我一生中从未见过丑陋的东西，因为不管一个物体的形状如何，光、影和透视总是会使它变得美丽。”（英国风景画家；1776—1837）"}]}]},{"ID":"20240730141837-bjoz1un","Type":"NodeParagraph","Properties":{"id":"20240730141837-bjoz1un","updated":"20240730141837"},"Children":[{"Type":"NodeText","Data":"在本章节中，我们将从各个方面介绍有关基于物理的着色。首先我们会在章节9.1中介绍光与物质交互的物理原理；在章节9.2-9.4中，我们将展示这些物理原理是如何转换到着色过程中的；章节9.5-9.7介绍了一些构建模块，它们专门用于基于物理的着色模型；章节9.8-9.12介绍了包含一系列材质类型的着色模型；最后，在章节9.13中，我们描述了各种材质是如何混合在一起的，并介绍了一些避免瑕疵、保持材质外观的过滤方法。"}]},{"ID":"20240730141838-vd8ofmv","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240730141838-vd8ofmv","updated":"20240730141838"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"9.1 光的物理学"}]},{"ID":"20240730141839-hh0m1h9","Type":"NodeParagraph","Properties":{"id":"20240730141839-hh0m1h9","updated":"20240730141839"},"Children":[{"Type":"NodeText","Data":"光与物质的相互作用，是基于物理的着色的理论基础，理解这些相互作用的原理，有助于帮助我们建立一个对光本质的基础理解。"}]},{"ID":"20240730141840-angis1u","Type":"NodeParagraph","Properties":{"id":"20240730141840-angis1u","updated":"20240730141840"},"Children":[{"Type":"NodeText","Data":"在物理光学（physical optic）中，光被认为是一种电磁横波（electromagnetic transverse wave），它使得电场（electric field）和磁场（magnetic field）在其传播方向的垂直面上来回振荡。电场和磁场的振荡是耦合的，二者的矢量相互垂直，并且长度之比也是固定的，这个比值等于相位速度（phase velocity），我们将在稍后进行讨论。"}]},{"ID":"20240730141841-qgpdbuj","Type":"NodeParagraph","Properties":{"id":"20240730141841-qgpdbuj","updated":"20240730141841"},"Children":[{"Type":"NodeText","Data":"图9.1展示了一个简单的光波，事实上，这是最简单的一种，即一个完美的正弦函数。这个波只有一个波长（wavelength），使用希腊字母$\\lambda$进行表示。在章节8.1中我们提到，人眼所感知到的颜色，与光线的波长密切相关，因此，具有单一波长的光被称为单色光（monochromatic light）。然而在实践中所遇到的大多数光都是多色光（polychromatic light），即它们包含了许多不同的波长。"}]},{"ID":"20240730141842-sjugmnd","Type":"NodeParagraph","Properties":{"id":"20240730141842-sjugmnd","updated":"20240730141842"},"Children":[{"Type":"NodeText","Data":"之所以我们说图9.1所展示的光波是简单的，是因为它是线性偏振（linearly  polarized）的。这意味着对于空间中的一个不动点，电场和磁场都沿着一条直线来回运动；相比之下，在这本书中，我们所关注的是更加普遍的非偏振光（unpolarized light）。在非偏振光中，电场和磁场会在垂直于传播方向的所有方向上均匀分布。尽管这种单色的、线性偏振的光波是很简单的，但是理解它们的行为仍然十分有用，因为任何光波都可以被分解成这种简单波的组合。"}]},{"ID":"20240730141843-lbhm5xf","Type":"NodeParagraph","Properties":{"id":"20240730141843-lbhm5xf","updated":"20240730141843"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.1：光是一种电磁横波。电场和磁场的矢量垂直于光线的传播方向，并以90度夹角相互振荡。本图中所展示的是最简单的光波，它是单色光（仅有一个固定的波长 \\lambda ），并且是线性偏振的（电场和磁场各自沿着一条直线进行振荡）。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611103315-20240730142820-qg5of3s.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.1：光是一种电磁横波。电场和磁场的矢量垂直于光线的传播方向，并以90度夹角相互振荡。本图中所展示的是最简单的光波，它是单色光（仅有一个固定的波长 \\lambda ），并且是线性偏振的（电场和磁场各自沿着一条直线进行振荡）。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141844-897f9ny","Type":"NodeParagraph","Properties":{"id":"20240730141844-897f9ny","updated":"20240730141844"},"Children":[{"Type":"NodeText","Data":"如果我们以一个给定的相位（例如偏振峰值），对波上的一个点进行追踪，我们将看到它会以一个恒定的速度在空间中进行移动，这就是波的相位速度（phase velocity）。对于真空中的光波而言，其相位速度为$c$，通常被称为光速，大约是每秒30万公里。"}]},{"ID":"20240730141845-4wjjtkp","Type":"NodeParagraph","Properties":{"id":"20240730141845-4wjjtkp","updated":"20240730141845"},"Children":[{"Type":"NodeText","Data":"在章节8.1.1中，我们讨论了可见光的波长分布，单个波长的大小大约在400纳米-700纳米，这个长度大约是一根蜘蛛丝的一半到三分之一左右，而一根蜘蛛丝还不到人类头发直径的五分之一，如图9.2所示。在光学中，通常都会使用相对于波长的尺度来描述尺寸大小，例如：我们会说蜘蛛丝的宽度大约为$2\\lambda - 3\\lambda$（即2-3倍的波长），头发的宽度为$100\\lambda - 200\\lambda$。"}]},{"ID":"20240730141846-j8p1wuh","Type":"NodeParagraph","Properties":{"id":"20240730141846-j8p1wuh","updated":"20240730141846"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.2：左图展示了不同波长的可见光与一根蜘蛛丝，蜘蛛丝的长度略微超过1微米。右图是一根蜘蛛丝和一根人类头发的直径对比。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611103844-20240730142820-oc6ntk6.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.2：左图展示了不同波长的可见光与一根蜘蛛丝，蜘蛛丝的长度略微超过1微米。右图是一根蜘蛛丝和一根人类头发的直径对比。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141847-aslbkal","Type":"NodeParagraph","Properties":{"id":"20240730141847-aslbkal","updated":"20240730141847"},"Children":[{"Type":"NodeText","Data":"光波会携带能量，这个能量流的强度等于电场强度和磁场强度的乘积，由于电场和磁场交替振荡，二者强度是成比例的，因此光线能量流的强度与电场强度的平方成正比。这里我们会关注电场，这是因为电场对物质的影响要比磁场大得多。在渲染中，我们关注的是随着时间变化的平均能量流，它与振幅的（amplitude）平方成正比，这个平均能量流的强度就是irradiance，通常使用字母$E$来进行表示。我们在章节8.1.1中介绍了irradiance和其他光量的关系。"}]},{"ID":"20240730141848-umcb0yz","Type":"NodeParagraph","Properties":{"id":"20240730141848-umcb0yz","updated":"20240730141848"},"Children":[{"Type":"NodeText","Data":"光波会以线性的方式进行叠加，总体波是各个分量波之和。然而，由于irradiance和振幅的平方成正比，这似乎导致了一个悖论，例如：将两个相同的光波进行叠加，会不会导致irradiance“1+1=4”的情况？由于irradiance描述的是能量流，这会不会违反能量守恒能量？对于这两个问题，前者的答案是“有时会”，而后者的答案则是“不会”。"}]},{"ID":"20240730141849-i2y1bl2","Type":"NodeParagraph","Properties":{"id":"20240730141849-i2y1bl2","updated":"20240730141849"},"Children":[{"Type":"NodeText","Data":"为了对刚才的两个问题进行说明，我们来看看以下这个简单的例子：现在有$n$个单色光要进行叠加，除了相位之外，其他的属性完全相同。这$n$个波的振幅均为$a$，使用$E_1$来表示每个波的irradiance，$E_1$和$a^2$成正比，也就是说，$E_1=ka^2$，其中$k$是常数。"}]},{"ID":"20240730141850-28k6h0s","Type":"NodeParagraph","Properties":{"id":"20240730141850-28k6h0s","updated":"20240730141850"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.3： n 个具有相同频率、相同偏振和相同振幅的单色光，它们以三种不同的方式进行叠加。从左到右分别是：相长干涉，相消干涉和不相干 叠加 。每种情况的下面都展示了对应组合波的振幅和irradiance。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611103901-20240730142820-3jq9r4i.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.3： n 个具有相同频率、相同偏振和相同振幅的单色光，它们以三种不同的方式进行叠加。从左到右分别是：相长干涉，相消干涉和不相干 叠加 。每种情况的下面都展示了对应组合波的振幅和irradiance。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141851-ij4qypn","Type":"NodeParagraph","Properties":{"id":"20240730141851-ij4qypn","updated":"20240730141851"},"Children":[{"Type":"NodeText","Data":"图9.3展示了三种不同的叠加情况。左图中，所有的波都具有相同的相位，叠加之后会相互加强，其irradiance是单个波的$n^2$倍，是$n$个独立波irradiance之和的$n$倍，这种情况被称为相长干涉（constructive interference）。在中间的图中，每一对波都处于相反的相位，两两相互抵消，叠加之后的振幅和irradiance均为0，这种情况被称为相消干涉（destructive interference）。"}]},{"ID":"20240730141852-lhy9732","Type":"NodeParagraph","Properties":{"id":"20240730141852-lhy9732","updated":"20240730141852"},"Children":[{"Type":"NodeText","Data":"相长干涉和相消干涉是两种特殊的相干叠加（coherent addition），即波峰和波谷以一种一致的方式进行排列。根据相对相位关系的不同，$ n  $个相同波相干叠加生成的组合波，其irradiance为单个波的$0-n^2$倍。"}]},{"ID":"20240730141853-5rhlfdh","Type":"NodeParagraph","Properties":{"id":"20240730141853-5rhlfdh","updated":"20240730141853"},"Children":[{"Type":"NodeText","Data":"然而通常来说，波都是以不相干的的方式进行叠加的（incoherent addition），这意味着它们的相位都是相对随机的，如图9.3右侧所示。在这种情况下，组合波的振幅为$\\sqrt{n}a$，其irradiance等于$n$个独立波的irradiance线性叠加，这正如我们所期望的那样。"}]},{"ID":"20240730141854-9hvx087","Type":"NodeParagraph","Properties":{"id":"20240730141854-9hvx087","updated":"20240730141854"},"Children":[{"Type":"NodeText","Data":"看起来相长干涉和相消干涉违反了能量守恒定律，但实际上并没有。这是因为图9.3并没有展示完整的情况——它仅仅展示了波在一个位置上的相互作用。当波在空间中进行传播的时候，它们之间的相位关系会发生变化，如图9.4所示。在某些位置上会发生相长干涉，组合波的irradiance会大于单个波irradiance之和；而在某些位置上则会发生相消干涉，组合波的irradiance会小于单个波irradiance之和。这并不违反能量守恒定律，因为通过相长干涉而获得的能量，与通过相消干涉而损失的能量是相等的。"}]},{"ID":"20240730141855-sfcf9ky","Type":"NodeParagraph","Properties":{"id":"20240730141855-sfcf9ky","updated":"20240730141855"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.4：图中展示了两个单色光，它们以相同的频率从两个点源进行传播。两个波在空间的不同位置上，会发生相长干涉和相消干涉。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611103922-20240730142820-6cp539z.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.4：图中展示了两个单色光，它们以相同的频率从两个点源进行传播。两个波在空间的不同位置上，会发生相长干涉和相消干涉。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141856-p913l49","Type":"NodeParagraph","Properties":{"id":"20240730141856-p913l49","updated":"20240730141856"},"Children":[{"Type":"NodeText","Data":"当物体中的电荷发生振荡时，就会发出电磁波，而引起振荡的部分能量（热能、电能、化学能）会被转化为光能，然后从物体上辐射出去。在渲染中，这样的物体会被视为光源，我们在章节5.2中首次讨论了光源，在第10章中，它们将从一个更加基于物理的角度，来对其进行描述。"}]},{"ID":"20240730141857-0lbpeqp","Type":"NodeParagraph","Properties":{"id":"20240730141857-0lbpeqp","updated":"20240730141857"},"Children":[{"Type":"NodeText","Data":"当光波被发射出来之后，它们穿过空间，直到遇到一些可以相互作用的物质。大多数光与物质交互作用，其核心现象都很简单，与上面所讨论的发射情况非常类似。振荡的电场会推动和拉动物质中的电荷，使它们也依次发生振荡。振荡的电荷会发射出新的光波，这个过程会将入射光波的一些能量重新定向到新的方向。这个作用过程被称为散射（scattering），它是各种光学现象的基础。"}]},{"ID":"20240730141858-jq4mo1n","Type":"NodeParagraph","Properties":{"id":"20240730141858-jq4mo1n","updated":"20240730141858"},"Children":[{"Type":"NodeText","Data":"散射出的光波与原始光波具有相同的频率。通常情况下，当原始光波包含多个频率的光波时，每个频率的光波都会单独与物质发生作用。而对于某个频率的入射光，也不会对其他频率的散射光产生能量贡献，除了一些特定和相对罕见的情况之外，例如荧光（fluorescence）和磷光（phosphorescence），我们不会在本书中讨论这些情况。"}]},{"ID":"20240730141859-gydabg4","Type":"NodeParagraph","Properties":{"id":"20240730141859-gydabg4","updated":"20240730141859"},"Children":[{"Type":"NodeText","Data":"一个孤立的分子会使光波向着各个方向进行散射，并使光的强度发生一些方向性的变化。但是更多的光线还是会沿着接近原始传播轴的方向进行散射，包括向前的方向或者向后的方向。分子作为散射体（scatterer）的有效性（分子附近的光波被散射的可能性），会随着波长的变化而发生很大的改变。"}]},{"ID":"20240730141860-39mpf3d","Type":"NodeParagraph","Properties":{"id":"20240730141860-39mpf3d","updated":"20240730141860"},"Children":[{"Type":"NodeText","Data":"在渲染中，我们主要关心的是包含许多分子的集合，光线在与这些聚集体发生相互作用的时候，其结果可能会与孤立分子的情况有所不同。从附近分子散射出的光波通常是相干的，因此会相互干涉，因为它们大概率都具有相同的入射波。本小节的剩余部分将专门讨论若干种多分子散射的特殊情况。"}]},{"ID":"20240730141861-r9yltgi","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240730141861-r9yltgi","updated":"20240730141861"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"9.1.1 粒子"}]},{"ID":"20240730141862-lq9upsa","Type":"NodeParagraph","Properties":{"id":"20240730141862-lq9upsa","updated":"20240730141862"},"Children":[{"Type":"NodeText","Data":"在理想气体（ideal gas）中，分子之间互不影响，即它们的相对位置是完全随机且不相关的，虽然这是一种抽象概念，但是对于标准大气压下的空气而言，这是一个相当好的模型。在这种情况下，从不同分子散射出的波，其相位差异是随机且不断变化的，因此这些散射波是不相干的，其能量呈线性叠加，如图9.3右侧所示。即从$n$个分子散射出的总光能，是单分子散射的$n$倍。"}]},{"ID":"20240730141863-cmygw44","Type":"NodeParagraph","Properties":{"id":"20240730141863-cmygw44","updated":"20240730141863"},"Children":[{"Type":"NodeText","Data":"相反，如果分子紧密地排列在比光波长小得多的团簇（cluster）中，那么每个团簇中的散射光波都是同相位的，即会发生相长干涉，如图9.3左侧所示。即从由$n$个分子组成的团簇散射出的总光强，是单分子散射的$ n^2  $倍，也是相同数量分子在理想气体散射中的$n$倍。这种关系意味着，对于一种密度恒定的物质，将分子聚集成团簇，将会显著增加散射光的强度。在保持整体分子密度不变的情况下，增加每个团簇的大小，将会进一步增加散射光的强度，直到团簇的直径接近光的波长，当超过这个临界值的时候，额外增加团簇的大小将并不会进一步增加散射光的强度"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"469]。"}]},{"ID":"20240730141864-dhxv3up","Type":"NodeParagraph","Properties":{"id":"20240730141864-dhxv3up","updated":"20240730141864"},"Children":[{"Type":"NodeText","Data":"这个过程解释了为什么云和雾的散射光是如此强烈。因为这两种现象都是由冷凝（condensation）产生的，所谓冷凝，是指空气中的水分子聚集成越来越大的团簇的过程。这会显著增加光的散射，即使水分子的总体密度并没有发生变化。有关云渲染的内容，将在章节14.4.2中进行讨论。"}]},{"ID":"20240730141865-xk4hh01","Type":"NodeParagraph","Properties":{"id":"20240730141865-xk4hh01","updated":"20240730141865"},"Children":[{"Type":"NodeText","Data":"当我们在讨论光线散射的时候，粒子（particle）这个术语同时代表了孤立的分子与包含多个分子的团簇。由于直径小于波长的多分子粒子散射，是孤立分子散射的增强版本（由于相长干涉），因此它会表现出相同的方向性变化和波长依赖性。这种类型的散射在大气粒子中被称为瑞利散射（Rayleigh scattering），在固体中则被称为丁达尔散射（Tyndall scattering）。"}]},{"ID":"20240730141866-ymef7ta","Type":"NodeBlockquote","Properties":{"id":"20240730141866-ymef7ta","updated":"20240730141866"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240730141867-upkfa8b","Type":"NodeParagraph","Properties":{"id":"20240730141867-upkfa8b","updated":"20240730141867"},"Children":[{"Type":"NodeText","Data":"译者注：丁达尔效应（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://en.wikipedia.org/wiki/Tyndall_effect","TextMarkATitle":"Tyndall effect - Wikipedia","TextMarkTextContent":"Tyndall effect - Wikipedia"},{"Type":"NodeText","Data":"）不是简单的瑞利散射或者简单的米氏散射，它特指胶体中发生的一种光学现象，即波长较长的光会更多地沿着光线方向进行传播，而波长较短的光则会被更多地散射。瑞利散射一般发生在粒子尺度小于十分之一可见光波长的情况下（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://en.wikipedia.org/wiki/Rayleigh_scattering","TextMarkATitle":"Rayleigh scattering - Wikipedia","TextMarkTextContent":"Rayleigh scattering - Wikipedia"},{"Type":"NodeText","Data":"）；米氏散射一般发生在粒子尺度接近或者大于可见光波长的情况下（"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"a","TextMarkAHref":"https://en.wikipedia.org/wiki/Mie_scattering","TextMarkATitle":"Mie scattering - Wikipedia","TextMarkTextContent":"Mie scattering - Wikipedia"},{"Type":"NodeText","Data":"）。"}]}]},{"ID":"20240730141868-55pitmr","Type":"NodeParagraph","Properties":{"id":"20240730141868-55pitmr","updated":"20240730141868"},"Children":[{"Type":"NodeText","Data":"当粒子的大小超过光波长的时候，散射波在不再是同相的，这会改变散射的性质。散射光的方向越来越倾向于前向（即光波的原始传播方向），此时波长的依赖性会降低，直到所有的可见光波长都被均匀散射，这种类型的散射被称为米氏散射（Mie scattering）。章节14.1会对瑞利散射和米氏散射进行了更加详细的描述。"}]},{"ID":"20240730141869-vgx4reu","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240730141869-vgx4reu","updated":"20240730141869"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"9.1.2 介质"}]},{"ID":"20240730141870-qhxj9ud","Type":"NodeParagraph","Properties":{"id":"20240730141870-qhxj9ud","updated":"20240730141870"},"Children":[{"Type":"NodeText","Data":"光在均匀介质（homogeneous medium）中进行传播是另一种重要的情况，均匀介质是指一个充满均匀分布的相同分子的空间。这里所说的均匀分布，并不是指分子间距要像晶体一样完全规则，如果液体和非晶体是纯净物（所有的分子都是相同的），并且没有间隙或者气泡的话，也可以认为它们在光学上是均匀的。"}]},{"ID":"20240730141871-vs0xjyc","Type":"NodeParagraph","Properties":{"id":"20240730141871-vs0xjyc","updated":"20240730141871"},"Children":[{"Type":"NodeText","Data":"在均匀介质中，散射波会整齐排列，除了沿着最初的传播方向之外，它们会在所有方向上都会产生相消干涉。当原始波与所有的单分子散射波结合之后，最终的结果与原始波基本相同，只有相位速度和振幅（在某些情况下）会有所不同。最后叠加的结果并不会表现出任何散射现象，因为散射现象已经被相消干涉有效抑制了。"}]},{"ID":"20240730141872-ic0zi2u","Type":"NodeParagraph","Properties":{"id":"20240730141872-ic0zi2u","updated":"20240730141872"},"Children":[{"Type":"NodeText","Data":"原始波和新波的相位速度之比，决定了介质的光学特性，这被称为折射率（index of refraction，IOR），通常使用字母$n$来进行表示。有些介质是具有吸收性的（absorptive），它们会将部分光能转换为热量，这会导致光波的振幅随着距离呈指数级下降，这个下降率由衰减率（attenuation index）定义，使用希腊字母$\\kappa (kappa)$来进行表示。$n$和$\\kappa$通常会随波长的变化而变化；这两个数字在一起，完整定义了一个介质会如何影响给定波长的光，它们通常被组合成一个复数$n+i\\kappa$，称为复折射率（complex index of refraction）。折射率对分子级别上的光相互作用细节进行了抽象，使得介质可以被视为一个连续的空间体积，这大大简化了模型的复杂度。"}]},{"ID":"20240730141873-hr55pat","Type":"NodeParagraph","Properties":{"id":"20240730141873-hr55pat","updated":"20240730141873"},"Children":[{"Type":"NodeText","Data":"虽然光的相位速度并不会直接影响物体外观，但是相位速度的变化则会对外观产生影响，我们稍后会进行解释。另一方面，光的吸收会对视觉效果产生直接影响，因为它降低了光的强度，并且也可以改变光的颜色（如果波长发生变化的话）。图9.5展示了一些光线吸收的例子。"}]},{"ID":"20240730141874-8t72rkr","Type":"NodeParagraph","Properties":{"id":"20240730141874-8t72rkr","updated":"20240730141874"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.5：四个装有不同吸收性质液体的小容器。从左到右分别是：纯净水，石榴汁，茶，咖啡。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611103936-20240730142820-zzvkfpa.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.5：四个装有不同吸收性质液体的小容器。从左到右分别是：纯净水，石榴汁，茶，咖啡。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141875-4bzg9tu","Type":"NodeParagraph","Properties":{"id":"20240730141875-4bzg9tu","updated":"20240730141875"},"Children":[{"Type":"NodeText","Data":"非均匀介质通常可以建模为嵌有散射粒子的均匀介质。相消干涉抑制了均匀介质中的散射现象，这是由分子的均匀排列所引起的；非均匀介质中的粒子排列并不均匀，从而会导致它们产生散射光波。分子分布中的任何局部变化，都将打破相消干涉的模式，从而允许散射光波进行传播；这种局部变化可以是一个不同分子类型的分子团，或者是气隙、气泡、密度变化等；在任何情况下，它都会像前面讨论的粒子那样，对光波进行散射，其散射性质同样取决于分子团的大小。即使是气体也可以这样进行建模，在气体情况下，“散射粒子”是由分子持续运动所引起的瞬态密度涨落（transient density fluctuation）。这个模型可以为气体建立一个具有意义的折射率$n$，这有利于理解它们的光学性质。图9.6展示了几种光线散射的例子。"}]},{"ID":"20240730141876-9551vzr","Type":"NodeParagraph","Properties":{"id":"20240730141876-9551vzr","updated":"20240730141876"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.6：从左到右分别是：水，加了几滴牛奶的水，加了大约10%牛奶的水，全脂牛奶，乳白色玻璃。大多数牛奶的散射粒子都要比可见光的波长大，因此它的散射主要是无色的，在中间的图像上有明显的淡蓝色。在最右侧图像中，乳白色玻璃中的散射粒子要比可见光的波长小，因此蓝光的散射强度要比红光强；同时由于明暗背景的分割，透射光在左边更加明显，而散射光则在右边更加明显。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611103950-20240730142820-cw5nw01.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.6：从左到右分别是：水，加了几滴牛奶的水，加了大约10%牛奶的水，全脂牛奶，乳白色玻璃。大多数牛奶的散射粒子都要比可见光的波长大，因此它的散射主要是无色的，在中间的图像上有明显的淡蓝色。在最右侧图像中，乳白色玻璃中的散射粒子要比可见光的波长小，因此蓝光的散射强度要比红光强；同时由于明暗背景的分割，透射光在左边更加明显，而散射光则在右边更加明显。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141877-iwkhm5v","Type":"NodeParagraph","Properties":{"id":"20240730141877-iwkhm5v","updated":"20240730141877"},"Children":[{"Type":"NodeText","Data":"散射和吸收现象都与尺度有关。在小场景中不产生任何明显散射的介质，在较大的尺度上也可能会有相当明显的散射现象。例如：当在房间内观察一杯水时，光在空气中的散射与在水中的吸收是几乎不可见的；然而在一个较大尺度的环境中，这两种效果可能都会十分显著，如图9.7所示。"}]},{"ID":"20240730141878-ge2dyh0","Type":"NodeParagraph","Properties":{"id":"20240730141878-ge2dyh0","updated":"20240730141878"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.7：左图中：在超过几米的范围内，水会对光产生强烈的吸收作用，尤其是红光，因此整体看起来会很蓝。右图中：光在没有严重空气污染或者雾的情况下，也会在数英里尺度的空气中发生散射。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611104004-20240730142820-z2437n3.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.7：左图中：在超过几米的范围内，水会对光产生强烈的吸收作用，尤其是红光，因此整体看起来会很蓝。右图中：光在没有严重空气污染或者雾的情况下，也会在数英里尺度的空气中发生散射。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141879-vi2gd85","Type":"NodeParagraph","Properties":{"id":"20240730141879-vi2gd85","updated":"20240730141879"},"Children":[{"Type":"NodeText","Data":"在一般情况下，介质的外观由散射作用和吸收作用的某种组合所决定，如图9.8所示。散射的程度决定了灰暗的程度，较高的散射会产生不透明的外观。除了一些比较罕见的情况之外（如图9.6中的乳白色玻璃），固体介质和液体介质中的粒子尺寸，往往大于光的波长，并且倾向于均匀散射所有可见波长的光，因此，物体的颜色通常都是由吸收作用的波长依赖性所引起的。而介质的亮度则是由光线散射和光线吸收这两种现象共同作用的结果。特别是白色，它是高散射和低吸收结合的结果。我们将在章节14.1中进行更详细的讨论。"}]},{"ID":"20240730141880-wo2i2xj","Type":"NodeParagraph","Properties":{"id":"20240730141880-wo2i2xj","updated":"20240730141880"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.8：具有不同吸收作用和散射 作用 组合的液体容器。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611104018-20240730142820-yan0clm.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.8：具有不同吸收作用和散射 作用 组合的液体容器。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141881-cr66mzd","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240730141881-cr66mzd","updated":"20240730141881"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"9.1.3 表面"}]},{"ID":"20240730141882-o3wb9q8","Type":"NodeParagraph","Properties":{"id":"20240730141882-o3wb9q8","updated":"20240730141882"},"Children":[{"Type":"NodeText","Data":"从光学角度来看，物体的表面（surface）是一个二维界面，它分隔了具有不同折射率的空间体积。在一般的渲染情况下，由空气组成的外部空间，其折射率约为1.003，为简单起见，通常假设空气的折射率为1；而内部空间的折射率则取决于构成物体的物质。"}]},{"ID":"20240730141883-79haeig","Type":"NodeParagraph","Properties":{"id":"20240730141883-79haeig","updated":"20240730141883"},"Children":[{"Type":"NodeText","Data":"当光波遇到一个表面的时候，该表面的两个因素会对结果产生重要的影响：两侧的物质和表面的几何形状。我们先关注两侧物质所带来的影响，因此假设此时的表面几何形状是一个完美的平面。我们将“外部”（入射方向或者入射波产生的那一侧）折射率表示为$ n_1  $，将“内部”（光波通过该表面后将发生传播的一侧）折射率表示为$n_2$。"}]},{"ID":"20240730141884-hgdc5z0","Type":"NodeParagraph","Properties":{"id":"20240730141884-hgdc5z0","updated":"20240730141884"},"Children":[{"Type":"NodeText","Data":"我们在前一小节中提到过，当光波遇到材料组成不连续或者密度不连续的时候（即两个区域的折射率不同时），它们就会发生散射。分离不同折射率物体的平面，是一种特殊类型的不连续，它会以一种特定的方式来对光进行散射。这个平面边界要求平行于表面的电场分量是连续的，换句话说，表面两侧的电场矢量，到表面平面上的投影必须相匹配。这有以下几个含义："}]},{"ID":"20240730141885-ne072gf","Type":"NodeList","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":4,"Marker":"MQ==","Num":1},"Properties":{"id":"20240730141885-ne072gf","updated":"20240730141885"},"Children":[{"ID":"20240730141886-afw0z4m","Type":"NodeListItem","Data":"1","ListData":{"Typ":1,"Tight":true,"Start":1,"Delimiter":46,"Padding":4,"Marker":"MQ==","Num":1},"Properties":{"id":"20240730141886-afw0z4m","updated":"20240730141886"},"Children":[{"ID":"20240730141887-q9hfe75","Type":"NodeParagraph","Properties":{"id":"20240730141887-q9hfe75","updated":"20240730141887"},"Children":[{"Type":"NodeText","Data":"在表面上的任何散射波，与入射波要么是同相位的，要么是$180 \\degree$反相位的。因此，在这个表面上的散射波，其峰值必须与入射波的峰值或者波谷相一致。这限制了散射波只能向两个可能的方向进行移动，一个继续向前进入表面，另一个则远离表面；前者被称为透射波（transmitted wave），后者被称为反射波（reflected wave）。"}]}]},{"ID":"20240730141888-arit5jg","Type":"NodeListItem","Data":"2","ListData":{"Typ":1,"Tight":true,"Start":2,"Delimiter":46,"Padding":4,"Marker":"Mg==","Num":2},"Properties":{"id":"20240730141888-arit5jg","updated":"20240730141888"},"Children":[{"ID":"20240730141889-589tu8o","Type":"NodeParagraph","Properties":{"id":"20240730141889-589tu8o","updated":"20240730141889"},"Children":[{"Type":"NodeText","Data":"散射波和入射波具有相同的频率。这里我们假设的是一个单色波，但是这个原理可以应用于任何波，其对应的单色分量会具有相同的频率。"}]}]},{"ID":"20240730141890-r0cxhig","Type":"NodeListItem","Data":"3","ListData":{"Typ":1,"Tight":true,"Start":3,"Delimiter":46,"Padding":4,"Marker":"Mw==","Num":3},"Properties":{"id":"20240730141890-r0cxhig","updated":"20240730141890"},"Children":[{"ID":"20240730141891-pr4ntvt","Type":"NodeParagraph","Properties":{"id":"20240730141891-pr4ntvt","updated":"20240730141891"},"Children":[{"Type":"NodeText","Data":"当光波从一个介质移动到另一个介质时，其相位速度（即波通过介质的速度）与相对折射率$(n_1/n_2)$成比例变化。由于光波的频率是固定的，因此波长也与相对折射率$(n_1/n_2)$成比例变化。"}]}]}]},{"ID":"20240730141892-l92ipd5","Type":"NodeParagraph","Properties":{"id":"20240730141892-l92ipd5","updated":"20240730141892"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.9：一个光波撞击一个平面，平面两侧物质的折射率分别为 n","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"_","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"1  和 n","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"_","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"2 。左侧图展示了入射波的侧视图，这个入射波从左上角进入，红色的强度代表了波的相位。表面下方的波间距与 (n","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"_","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"1/n","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"_","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"2) 成正比，本例中为0.5。相位沿着表面排列，因此间距的变化会弯曲（折射）透射波的方向。图中三角形的构造展示了Snell定律的推导过程。为了清晰起见，右上方的图显示了反射波的情况，它与入射波具有相同的波间距，因此其方向与表面法线具有相同的夹角。右下方展示了入射波、透射波和反射波方向的矢量图。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611104043-20240730142820-d8zmeyv.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.9：一个光波撞击一个平面，平面两侧物质的折射率分别为 n_1  和 n_2 。左侧图展示了入射波的侧视图，这个入射波从左上角进入，红色的强度代表了波的相位。表面下方的波间距与 (n_1/n_2) 成正比，本例中为0.5。相位沿着表面排列，因此间距的变化会弯曲（折射）透射波的方向。图中三角形的构造展示了Snell定律的推导过程。为了清晰起见，右上方的图显示了反射波的情况，它与入射波具有相同的波间距，因此其方向与表面法线具有相同的夹角。右下方展示了入射波、透射波和反射波方向的矢量图。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141893-ou0y1xx","Type":"NodeParagraph","Properties":{"id":"20240730141893-ou0y1xx","updated":"20240730141893"},"Children":[{"Type":"NodeText","Data":"最终结果如图9.9所示。反射波和入射波的方向，与表面法线之间具有相同的夹角$\\theta_i$；透射波的方向会以$\\theta_t$的角度进行弯曲（折射），它与$\\theta_{i}$的关系如下："}]},{"ID":"20240730141894-y5hba7k","Type":"NodeMathBlock","Properties":{"id":"20240730141894-y5hba7k","updated":"20240730141894"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"\\sin \\left(\\theta_{t}\\right)=\\frac{n_{1}}{n_{2}} \\sin \\left(\\theta_{i}\\right).\n\\tag{9.1}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730141895-4lfjfqf","Type":"NodeParagraph","Properties":{"id":"20240730141895-4lfjfqf","updated":"20240730141895"},"Children":[{"Type":"NodeText","Data":"这个折射方程被称为Snell定律（折射定律），它被用于全局折射效应，这将在章节14.5.2中进一步讨论。"}]},{"ID":"20240730141896-olqrm6r","Type":"NodeParagraph","Properties":{"id":"20240730141896-olqrm6r","updated":"20240730141896"},"Children":[{"Type":"NodeText","Data":"虽然折射现象通常会与玻璃、晶体等透明材质联系在一起，但是它也会发生在不透明物体的表面上；当不透明物体发生折射时，光会在物体的内部进行散射和吸收。光会与物体的介质相互作用，就像图9.8中的装有各种液体的容器一样。对于金属而言，其内部包含了许多自由电子（不与分子结合的电子），它们会“吸收”折射光的能量，并将其重定向到反射波中，这就是为什么金属会具有较高的吸收率和较高的反射率的原因。"}]},{"ID":"20240730141897-wp53q56","Type":"NodeParagraph","Properties":{"id":"20240730141897-wp53q56","updated":"20240730141897"},"Children":[{"Type":"NodeText","Data":"我们刚才所讨论的表面折射现象（反射和折射），需要折射率在小于单一波长的距离上发生突变。而折射率的逐渐变化并不会对光进行散射，而是会导致光路发生弯曲，就像折射时出现的不连续弯曲一样；当空气密度因温度不同而发生变化的时候，可以看到这种效应，例如海市蜃楼（mirage）和热变形（heat distortion，也叫做热浪），如图9.10所示。"}]},{"ID":"20240730141898-hugetj7","Type":"NodeParagraph","Properties":{"id":"20240730141898-hugetj7","updated":"20240730141898"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.10：一个由于折射率逐渐变化而导致光路弯曲的例子，图中所展示的情况是由温度变化引起的。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611104058-20240730142820-goeesmt.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.10：一个由于折射率逐渐变化而导致光路弯曲的例子，图中所展示的情况是由温度变化引起的。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141899-eqp0l0t","Type":"NodeParagraph","Properties":{"id":"20240730141899-eqp0l0t","updated":"20240730141899"},"Children":[{"Type":"NodeText","Data":"即使是一个具有明确边界的物体，如果它被浸没在一个具有相同折射率的物质中，那么也将没有可见的表面。因为在没有折射率变化的情况下，就不会发生反射现象和折射现象。图9.11展示了这样的一个例子。"}]},{"ID":"20240730141900-x9rgjdy","Type":"NodeParagraph","Properties":{"id":"20240730141900-x9rgjdy","updated":"20240730141900"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.11：玻璃杯里有很多装饰珠子，它的折射率与水的折射率是一样的。在水面以上，由于珠子的折射率与空气的折射率不同，因此有一个明显可见的表面。在水面以下，由于珠子表面两侧的折射率是相同的，因此这些表面是不可见的。由于这些珠子会吸收特定波长的光，因此我们能够看到这些珠子本身，并且它们会表现出不同的颜色。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611104114-20240730142820-eal7swi.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.11：玻璃杯里有很多装饰珠子，它的折射率与水的折射率是一样的。在水面以上，由于珠子的折射率与空气的折射率不同，因此有一个明显可见的表面。在水面以下，由于珠子表面两侧的折射率是相同的，因此这些表面是不可见的。由于这些珠子会吸收特定波长的光，因此我们能够看到这些珠子本身，并且它们会表现出不同的颜色。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141901-vgs29q5","Type":"NodeParagraph","Properties":{"id":"20240730141901-vgs29q5","updated":"20240730141901"},"Children":[{"Type":"NodeText","Data":"到目前为止，我们一直关注的都是表面两侧的物质对光的影响，现在我们将讨论影响表面外观的另一个重要因素：几何形状。严格地说，一个完美平坦的平面表面是不可能存在的，每个表面都具有某种程度的不规则性，即使该表面只由单个原子组成。然而，比波长小得多的不规则表面，对光的行为没有影响；而比波长大得多的不规则表面，虽然会使这个表面在宏观上看起来变得倾斜，但是并不会影响其微观局部的平坦性。只有位于1-100个波长范围内的不规则表面，才会导致这个表面与平面具有不同的外观表现，这种现象被称为衍射现象（diffraction），将在章节9.11中进一步讨论。"}]},{"ID":"20240730141902-m4t1h3x","Type":"NodeParagraph","Properties":{"id":"20240730141902-m4t1h3x","updated":"20240730141902"},"Children":[{"Type":"NodeText","Data":"在渲染中，我们通常会基于几何光学（geometrical optics），它忽略了光作为一种波所产生的效应，例如干涉和衍射。这相当于假设所有表面的不规则性，要么小于光的波长，要么比光的波长大得多（100倍以上）。在几何光学中，光会被建模为一条射线，而不是一种波，当一条射线与表面相交时，相交点的局部区域会被视为一个平面。图9.9右下角的图像，可以看作是反射现象和折射现象的几何光学表示；而图9.9其他部分所展示的，是光作为一种波所发生的现象。从这里开始，直到章节9.11为止，我们将一直会在几何光学的领域中进行讨论（会将光译作光线），章节9.11中将专门讨论基于波动光学的着色模型。"}]},{"ID":"20240730141903-mahtu97","Type":"NodeParagraph","Properties":{"id":"20240730141903-mahtu97","updated":"20240730141903"},"Children":[{"Type":"NodeText","Data":"正如我们前面所提到的，比波长大得多的表面不规则性，会改变表面的局部朝向。当这些不规则性太小以致于无法进行渲染的时候（小于一个像素），我们则将其称为微观几何图形（microgeometry，微表面）；表面的反射方向和折射方向取决于该表面的法线，而这些微表面会改变表面上不同点处的法线，从而改变光线的反射方向和折射方向。"}]},{"ID":"20240730141904-eob1ytb","Type":"NodeParagraph","Properties":{"id":"20240730141904-eob1ytb","updated":"20240730141904"},"Children":[{"Type":"NodeText","Data":"虽然不规则表面上的每个点，都只会在一个方向上反射光线，但是屏幕上的每个像素都覆盖了许多的表面点，这些点会在不同方向上反射光线，因此这个表面的外观，是由所有不同反射方向的光线的聚合结果所决定的。图9.12展示了两个在宏观尺度上具有相似形状，但是微观几何形状显著不同的表面，其外观也具有明显的差异。"}]},{"ID":"20240730141905-y65g5yb","Type":"NodeParagraph","Properties":{"id":"20240730141905-y65g5yb","updated":"20240730141905"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.12：左侧展示了两个表面的照片，右侧使用示意图的形式，展示了它们所对应的微观几何结构。上方的表面拥有略微粗糙的微观几何形状，入射光线击中了表面上不同的点，每个点的法线方向略有差异，并在一个狭窄的锥形方向上被反射，其宏观效果是具有轻微模糊的反射。下方表面具有更加粗糙的微观几何形状，入射光线照射到的表面点，具有明显不同的法线方向，反射光线会以一个较宽的锥体进行扩散，从而导致宏观的反射效果变得更加模糊。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611104132-20240730142820-awa3cwe.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.12：左侧展示了两个表面的照片，右侧使用示意图的形式，展示了它们所对应的微观几何结构。上方的表面拥有略微粗糙的微观几何形状，入射光线击中了表面上不同的点，每个点的法线方向略有差异，并在一个狭窄的锥形方向上被反射，其宏观效果是具有轻微模糊的反射。下方表面具有更加粗糙的微观几何形状，入射光线照射到的表面点，具有明显不同的法线方向，反射光线会以一个较宽的锥体进行扩散，从而导致宏观的反射效果变得更加模糊。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141906-lbjmybp","Type":"NodeParagraph","Properties":{"id":"20240730141906-lbjmybp","updated":"20240730141906"},"Children":[{"Type":"NodeText","Data":"在渲染中，我们并不会对微观几何形状进行明确的建模，而是会以一种统计的方式对其进行处理，将该表面视为一个具有微观结构法线的随机分布。因此，我们将表面建模为，会在一个连续方向上（译者注：一定的立体角范围内），对光线进行反射和折射。其中这个连续方向的宽度（锥形范围的大小，或者是立体角的大小），以及反射细节和折射细节的模糊程度，取决于微观几何法线的统计方差，即表面微尺度的粗糙度（roughness），如图9.13所示。"}]},{"ID":"20240730141907-le567hm","Type":"NodeParagraph","Properties":{"id":"20240730141907-le567hm","updated":"20240730141907"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.13：从宏观上看，表面可以被视为在多个方向上，对光线进行反射和折射。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611104146-20240730142820-dee0atv.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.13：从宏观上看，表面可以被视为在多个方向上，对光线进行反射和折射。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141908-jjks4f1","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240730141908-jjks4f1","updated":"20240730141908"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"9.1.4 次表面散射"}]},{"ID":"20240730141909-qqkm6b5","Type":"NodeParagraph","Properties":{"id":"20240730141909-qqkm6b5","updated":"20240730141909"},"Children":[{"Type":"NodeText","Data":"进入物体内部的折射光线，会继续与内部物质发生相互作用。前面我们提到，金属具有较高的吸收率和较高的反射率，即金属表面会反射大部分的入射光线，进入金属内部的折射光线也会被迅速吸收；相比之下，非金属物体则会表现出广泛的散射行为和吸收行为，这与我们在图9.8中所看到的液体容器类似。透明材料具有低散射和低吸收的特性，进入物体内部的任何折射光线，最终都会从物体中折射出来。我们在章节5.5中讨论过一些简单的透明物体渲染方法；有关透明物体的折射问题，将在章节14.5.2中进行讨论。在本小节中，我们将重点关注不透明的物体，在这些物体中，透射光线在经历多次散射和吸收之后，最终有一部分会从表面重新发射出来，并被人眼观察到，如图9.14所示。"}]},{"ID":"20240730141910-kvjtj3x","Type":"NodeParagraph","Properties":{"id":"20240730141910-kvjtj3x","updated":"20240730141910"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.14：折射光线在穿过物体时会被吸收。在这个例子中，大部分被吸收的都是波长较长的光线，留下的主要是波长较短的蓝光。另外，光线还会在物体内部的粒子中发生散射，最终有一些折射光线会散射出表面，例如图中以不同方向离开表面的蓝色箭头。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611104159-20240730142820-463sakl.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.14：折射光线在穿过物体时会被吸收。在这个例子中，大部分被吸收的都是波长较长的光线，留下的主要是波长较短的蓝光。另外，光线还会在物体内部的粒子中发生散射，最终有一些折射光线会散射出表面，例如图中以不同方向离开表面的蓝色箭头。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141911-r89tcm0","Type":"NodeParagraph","Properties":{"id":"20240730141911-r89tcm0","updated":"20240730141911"},"Children":[{"Type":"NodeText","Data":"这种次表面散射（subsurface scatter）的光线，会以相对于入射点的不同距离从表面射出，这个进出距离（entry-exit distances）的分布取决于材料中散射粒子的密度和性质，这些距离与着色尺度（像素的大小，以及着色样本之间的距离）之间的关系是很重要的。如果这个进出距离比着色尺度要小，那么可以假定它们为零，这样我们就可以将次表面散射与表面反射整合到同一个局部着色模型中，即某个着色点上的出射光线，只依赖于该点的入射光线。由于次表面散射与表面反射具有明显不同的外观表现，因此可以很容易地将它们划分为单独的着色选项，使用镜面项（specular term）控制表面反射现象，使用漫反射项（diffuse term）控制局部次表面散射（local subsurface scattering）现象。"}]},{"ID":"20240730141912-noj140g","Type":"NodeParagraph","Properties":{"id":"20240730141912-noj140g","updated":"20240730141912"},"Children":[{"Type":"NodeText","Data":"如果这个进出距离比着色尺度要大，那么就需要专门的渲染技术，来表现光线在某一点进入表面，并从另一点离开表面的视觉效果。章节14.6详细介绍了这些全局次表面散射（global subsurface scattering）技术。局部次表面散射和全局次表面散射之间的差异如图9.15所示。"}]},{"ID":"20240730141913-h9aem9d","Type":"NodeParagraph","Properties":{"id":"20240730141913-h9aem9d","updated":"20240730141913"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.15：左图中，我们渲染了一个具有次表面散射的材质，图中的黄色圆圈和紫色圆圈代表了两种不同大小的采样区域。其中黄色圆圈代表了单个着色样本所覆盖的区域，大于次表面散射的距离，因此我们可以在渲染中忽略这些距离所带来的影响，并在局部着色模型中将次表面散射项视为漫反射项，如右图所示。如果我们向着靠近表面的方向进行移动，单个着色样本所覆盖的区域会变小，如左图中的紫色圆圈，与着色样本所覆盖的区域相比，此时次表面散射的距离很大，无法忽视这些距离所带来的影响，因此需要使用全局的着色模型和光照技术，来从这些着色样本中生成逼真的图像。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611104212-20240730142820-cd5gxtx.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.15：左图中，我们渲染了一个具有次表面散射的材质，图中的黄色圆圈和紫色圆圈代表了两种不同大小的采样区域。其中黄色圆圈代表了单个着色样本所覆盖的区域，大于次表面散射的距离，因此我们可以在渲染中忽略这些距离所带来的影响，并在局部着色模型中将次表面散射项视为漫反射项，如右图所示。如果我们向着靠近表面的方向进行移动，单个着色样本所覆盖的区域会变小，如左图中的紫色圆圈，与着色样本所覆盖的区域相比，此时次表面散射的距离很大，无法忽视这些距离所带来的影响，因此需要使用全局的着色模型和光照技术，来从这些着色样本中生成逼真的图像。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141914-fe8oxkt","Type":"NodeParagraph","Properties":{"id":"20240730141914-fe8oxkt","updated":"20240730141914"},"Children":[{"Type":"NodeText","Data":"值得注意的是，局部次表面散射技术和全局次表面散射技术模拟的是完全相同的物理现象。每种情况下的最佳选择（即到底使用哪种模型和技术），不仅取决于材质的属性，还取决于观察的尺度。例如：当渲染一个孩子在玩塑料玩具的场景时，我们很可能需要使用全局次表面散射技术来准确地渲染孩子的皮肤，而对于塑料玩具而言，可能一个局部的漫反射着色模型就足够了。这是因为皮肤中的散射距离，要比在塑料中的散射距离大得多，但是如果相机足够远的话，皮肤的散射距离也可能会小于一个像素，此时局部的着色模型对于儿童和玩具而言都是十分准确的。相反，在一个极端的特写镜头中，塑料也可能会表现出明显的非局部次表面散射现象，这时候就需要全局次表面散射技术来对玩具进行准确地渲染。"}]},{"ID":"20240730141915-v847jgs","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240730141915-v847jgs","updated":"20240730141915"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"9.2 相机"}]},{"ID":"20240730141916-kh8f0pv","Type":"NodeParagraph","Properties":{"id":"20240730141916-kh8f0pv","updated":"20240730141916"},"Children":[{"Type":"NodeText","Data":"如章节8.1.1所述，在渲染的时候，我们会计算从表面着色点到相机位置的radiance。这模拟了一个简化了的成像系统，例如胶片相机、数码相机或者人眼。"}]},{"ID":"20240730141917-k9zbse8","Type":"NodeParagraph","Properties":{"id":"20240730141917-k9zbse8","updated":"20240730141917"},"Children":[{"Type":"NodeText","Data":"这类成像系统中，包含了一个由许多离散小传感器组成的传感器表面。例如：眼睛中的视杆细胞和视锥细胞、数码相机中的光电二极管（photodiode）、或者胶片中的染料颗粒，这些传感器可以检测到其表面上的irradiance，并生成一个颜色信号。这些irradiance传感器本身并不能产生图像，因为它们对来自所有入射方向的光线都进行了平均处理。因此，完整的成像系统还应当包括一个具有小孔（aperture，光圈）的不透光外壳，它对光线进入和撞击传感器的方向进行了限制；放置在光圈处的透镜会将光线进行聚焦，这样每个传感器就只能接收来自一小部分入射方向的光线（小孔成像原理）。外壳、光圈和透镜的综合作用，使得这些传感器具有了特定的方向性（directionally specific），即只会对分布在一小块区域和一小组入射方向上的光线进行平均。正如我们在章节8.1.1中所看到的，这些传感器量化了来自各个方向光流的表面密度，即测量了平均radiance，而不是测量平均irradiance；换句话说，传感器量化记录了单条光线的亮度和颜色。"}]},{"ID":"20240730141918-mb26u27","Type":"NodeParagraph","Properties":{"id":"20240730141918-mb26u27","updated":"20240730141918"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.16：每个相机成像模型中都包含了一个像素传感器阵列。图中的每根实线，都代表了传感器从场景中收集到的一组光线。每个子图中的窗口图像，展示了像素传感器上的单点样本所收集的光线。第一行图片展示了一个针孔相机模型；第二行图片展示了一个典型的渲染系统模型，即一个带有相机点 c 的针孔相机；第三行图片展示了一个更加物理正确的镜头相机，其焦点位于红色球体上，另外两个球体并不在焦点上。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611105017-20240730142820-ov1j6an.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.16：每个相机成像模型中都包含了一个像素传感器阵列。图中的每根实线，都代表了传感器从场景中收集到的一组光线。每个子图中的窗口图像，展示了像素传感器上的单点样本所收集的光线。第一行图片展示了一个针孔相机模型；第二行图片展示了一个典型的渲染系统模型，即一个带有相机点 c 的针孔相机；第三行图片展示了一个更加物理正确的镜头相机，其焦点位于红色球体上，另外两个球体并不在焦点上。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141919-tews0vw","Type":"NodeParagraph","Properties":{"id":"20240730141919-tews0vw","updated":"20240730141919"},"Children":[{"Type":"NodeText","Data":"在历史上，渲染模拟了一种特别简单的成像传感器，它被称为针孔相机（pinhole camera），如图9.16的第一行所示。针孔相机没有镜头，并且具有一个非常小的光圈（在理想的情况下，它是一个没有大小的数学抽象点）。这个小光圈对传感器进行了限制，即传感器表面上的每个点都只能收集一束光线，而一个单独传感器中包含了若干个这样的点，也就是说，每个小传感器都会收集一个锥形区域内的光线，这个圆锥的底（base）覆盖了传感器的表面，圆锥的顶点（apex）位于光圈处。图形渲染系统以一种略有不同（但是是等价的）的方式，对针孔相机进行了建模，如图9.16的第二行所示。针孔光圈的位置用点$c$进行表示，通常被称为“相机位置”或者“眼睛位置”。这个点也是透视变换的投影中心（章节4.7.2）。"}]},{"ID":"20240730141920-3p6sboc","Type":"NodeParagraph","Properties":{"id":"20240730141920-3p6sboc","updated":"20240730141920"},"Children":[{"Type":"NodeText","Data":"在渲染时，每个着色样本都对应了一条光线，即对应于传感器表面上的一个采样点。而抗锯齿的过程（章节5.4）则可以理解为，对每个离散传感器表面收集到的信号进行重建。然而，由于图形渲染并不会受到物理传感器的限制，因此我们可以对这个过程进行更加一般化的处理，即从离散的着色样本中，重建出连续的图像信号。"}]},{"ID":"20240730141921-th1i0oe","Type":"NodeParagraph","Properties":{"id":"20240730141921-th1i0oe","updated":"20240730141921"},"Children":[{"Type":"NodeText","Data":"虽然真正的针孔相机可以很容易地制造出来，但是对于大多数实践中所使用的相机，以及人眼来说，针孔相机都是一个糟糕的模型，其实用价值并不高。图9.16第三行展示了一个使用镜头的成像系统模型，这个模型中包含了一个镜头，这允许相机使用一个更大的光圈，大大增加了成像传感器所收集的光量。但是它也会导致相机的景深（depth of field）是有限的（章节12.4），太近或者太远的物体都会被模糊（大光圈的时候，景深效果尤其明显）。"}]},{"ID":"20240730141922-qq4a6xt","Type":"NodeParagraph","Properties":{"id":"20240730141922-qq4a6xt","updated":"20240730141922"},"Children":[{"Type":"NodeText","Data":"镜头除了会限制景深之外，还有一些其他的影响。传感器上的每个点（包括完美聚焦的点）都会接收一个锥形区域内的光线；而在理想化的模型中，每个着色样本都只会对应唯一的观察射线，这样处理有时候会引入数学奇异点（即无法定义的点）、数值不稳定性或者视觉瑕疵；当我们在渲染图像的时候，将真实的物理模型牢记于心，有助于我们识别和解决这些问题。"}]},{"ID":"20240730141923-o1aty0q","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240730141923-o1aty0q","updated":"20240730141923"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"9.3 The BRDF"}]},{"ID":"20240730141924-hj7sghy","Type":"NodeParagraph","Properties":{"id":"20240730141924-hj7sghy","updated":"20240730141924"},"Children":[{"Type":"NodeText","Data":"最终，基于物理的渲染可以归结为沿着一组观察射线，计算进入相机的radiance。这里我们使用章节8.1.1中所介绍的入射radiance的符号表示，对于一个给定的观察射线，我们需要计算的是$L_{i}(\\mathbf{c},-\\mathbf{v})$，其中$\\mathbf{c}$是相机的位置，$-\\mathbf{v}$是沿着观察射线的方向。这里我们使用$-\\mathbf{v}$是由于两个符号约定：第一，$L_{i}()$中的方向向量，总是指向远离给定点的方向，在这里就是指向远离相机位置的方向。第二，观察向量$\\mathbf{v}$总是会指向相机。"}]},{"ID":"20240730141925-9thdkct","Type":"NodeParagraph","Properties":{"id":"20240730141925-9thdkct","updated":"20240730141925"},"Children":[{"Type":"NodeText","Data":"在渲染中，场景通常会被建模为彼此之间具有介质的物体集合（“介质”一词实际上来自于拉丁语，它的意思是“在中间”）。通常我们所讨论的介质是适量且相对干净的空气，它并不会对光线的radiance产生明显地影响，因此在渲染中可以被忽略。但是有时候，光线所穿过的介质会通过吸收或者散射等方式，对光线的radiance产生明显影响，这样的介质被称为参与介质（participating media），因为它们参与了光线在场景中的传播过程。我们将在第14章中详细介绍有关参与介质的话题。而在本章节中，我们暂时假设没有参与介质的存在，因此进入相机的radiance，与其观察方向上离开最近物体表面的radiance是相等的，即："}]},{"ID":"20240730141926-g2o3e7y","Type":"NodeMathBlock","Properties":{"id":"20240730141926-g2o3e7y","updated":"20240730141926"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"L_{i}(\\mathbf{c},-\\mathbf{v})=L_{o}(\\mathbf{p}, \\mathbf{v})\n\\tag{9.2}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730141927-hf0lqfn","Type":"NodeParagraph","Properties":{"id":"20240730141927-hf0lqfn","updated":"20240730141927"},"Children":[{"Type":"NodeText","Data":"其中，$\\mathbf{p}$是观察射线与最近物体表面的交点。"}]},{"ID":"20240730141928-lcadjrx","Type":"NodeParagraph","Properties":{"id":"20240730141928-lcadjrx","updated":"20240730141928"},"Children":[{"Type":"NodeText","Data":"根据方程9.2，我们的新目标是计算$L_{o}(\\mathbf{p}, \\mathbf{v})$。我们在章节5.1中曾讨论过简单的着色模型，而这里的计算过程则是其物理版本。有时候一些表面也会直接发出radiance，但是更加常见的情况是，离开这个表面的radiance来自于其他地方，并通过章节9.1中所描述的物理作用，最终被反射到相机中。在本章节中，我们将不考虑透明物体（章节5.5和章节14.5.2）和全局次表面散射（章节14.6）的情况；换句话说，我们所关注的是局部反射现象，它将照射到当前着色点的光线，重新发射回外部，这些现象包括表面反射以及局部次表面散射，它们只依赖于入射光方向$\\mathbf{l}$和指向外部的观察方向$\\mathbf{v}$。双向反射分布函数（bidirectional reflectance distribution function，BRDF）描述了着色点表面的局部反射系数，记为$f(\\mathbf{l}, \\mathbf{v})$。"}]},{"ID":"20240730141929-s7pr1ax","Type":"NodeParagraph","Properties":{"id":"20240730141929-s7pr1ax","updated":"20240730141929"},"Children":[{"Type":"NodeText","Data":"在原始推导中"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"1277]，BRDF是针对均匀表面进行定义的。也就是说，我们会假设表面上各处的BRDF都是相同的。然而，对于现实世界中的物体（以及渲染场景中的物体）而言，很少会有表面具有完全相同的材质属性。即使是由单一材料组成的物体（例如银质雕像），其表面上也会有划痕、暗斑、污渍或者其他的一些变化，从而导致两个不同的着色点具有不同的视觉特性。从技术上来讲，根据空间位置捕获BRDF变化的函数，被称为空间变化的BRDF（spatially varying BRDF，SVBRDF）或者空间BRDF（spatial BRDF，SBRDF）。然而，这种情况在实践中非常普遍，因此通常还是会使用BRDF这个较短的术语来进行描述，我们会默认假定BRDF与表面位置有关。"}]},{"ID":"20240730141930-c4gayat","Type":"NodeParagraph","Properties":{"id":"20240730141930-c4gayat","updated":"20240730141930"},"Children":[{"Type":"NodeText","Data":"光线的入射方向和出射方向各有两个自由度。一种常用的参数化表示包括两个角度：相对于表面法线$\\mathbf{n}$的仰角$\\theta$，以及相对于表面法线$\\mathbf{n}$的方位角（即水平旋转）$\\phi$。在一般情况下，BRDF是一个包含四个标量变量的函数。各向同性（Isotropic）BRDF是一个重要的特例，当光线入射方向和出射方向围绕表面法线$\\mathbf{n}$旋转的时候，各项同性BRDF会保持不变，并保持它们之间的相对角度不变。图9.17展示了这两种情况下所使用的输入变量。各向同性BRDF是一个包含三个标量变量的函数，因为我们只需要光线绕表面法线$\\mathbf{n}$的旋转角度，或者相机的旋转角度$\\phi$即可。也就是说，如果将一个具有均匀各向同性材质的物体放置在转盘上，并旋转它的话，在给定的光线和相机条件下，这个物体表面在所有旋转角度上看起来都是相同的。"}]},{"ID":"20240730141931-zuivuo8","Type":"NodeParagraph","Properties":{"id":"20240730141931-zuivuo8","updated":"20240730141931"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.17：BRDF输入参数。方位角 \\phi ","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"_","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"i 和 \\phi","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"_","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"o 都是相对于给定切向量 \\mathbf{t} 定义的。而在各向同性BRDF中，我们只需要考虑相对方位角 \\phi 即可，不需要考虑参考切向量与 \\phi ","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"_","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"i 、 \\phi","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"_","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"o 。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611105126-20240730142820-prkdzjy.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.17：BRDF输入参数。方位角 \\phi _i 和 \\phi_o 都是相对于给定切向量 \\mathbf{t} 定义的。而在各向同性BRDF中，我们只需要考虑相对方位角 \\phi 即可，不需要考虑参考切向量与 \\phi _i 、 \\phi_o 。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141932-x30px6c","Type":"NodeParagraph","Properties":{"id":"20240730141932-x30px6c","updated":"20240730141932"},"Children":[{"Type":"NodeText","Data":"由于我们忽略了荧光（fluorescence）和磷光（phosphorescence）等现象，因此我们可以假设，给定波长的入射光会以相同的波长被反射出来。反射光的光量会根据其波长发生变化，可以使用以下两种方法来进行模拟：第一种是将波长视为BRDF的额外输入变量；第二种则是将BRDF视为会返回一个光谱分布的值。虽然第一种方法有时会用于离线渲染"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"660]，但是在实时渲染中，总是会使用第二种方法。由于实时渲染器一般将光谱分布表示为一个RGB三元组，这意味着BRDF会返回一个RGB值。"}]},{"ID":"20240730141933-dcjcy7j","Type":"NodeParagraph","Properties":{"id":"20240730141933-dcjcy7j","updated":"20240730141933"},"Children":[{"Type":"NodeText","Data":"为了计算着色点的出射光线$L_{o}(\\mathbf{p}, \\mathbf{v})$，我们将BRDF项合并到反射方程（reflectance equation）中："}]},{"ID":"20240730141934-fm5k7br","Type":"NodeMathBlock","Properties":{"id":"20240730141934-fm5k7br","updated":"20240730141934"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"L_{o}(\\mathbf{p}, \\mathbf{v})=\\int_{\\mathbf{l} \\in \\Omega} f(\\mathbf{l}, \\mathbf{v}) L_{i}(\\mathbf{p}, \\mathbf{l})(\\mathbf{n} \\cdot \\mathbf{l}) d \\mathbf{l}\n\\tag{9.3}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730141935-62ggcfk","Type":"NodeParagraph","Properties":{"id":"20240730141935-62ggcfk","updated":"20240730141935"},"Children":[{"Type":"NodeText","Data":"积分符号的下标$\\mathbf{l} \\in \\Omega$意味着是，我们对位于表面单位半球（以着色点为球心，以表面法线$\\mathbf{n}$为半球方向）上的入射光方向$\\mathbf{l}$进行积分。请注意，入射光方向$\\mathbf{l}$会在半球范围内进行连续扫描，也就是说，它并不是某个特定的“光线方向”。这个想法的核心是：来自任何入射方向的光线，都会（通常会）产生一些radiance。我们用$d\\mathbf{l}$来表示入射光方向$\\mathbf{l}$周围单位立体角的微分（有关立体角的内容在章节8.1.1讨论过）。"}]},{"ID":"20240730141936-lg6fjxk","Type":"NodeParagraph","Properties":{"id":"20240730141936-lg6fjxk","updated":"20240730141936"},"Children":[{"Type":"NodeText","Data":"总而言之，反射方程表明，出射的radiance等于入射radiance乘以BRDF项，再乘以表面法线$\\mathbf{n}$和入射光方向$\\mathbf{l}$点积的积分（其中入射光方向$\\mathbf{l}$来自半球范围$\\Omega$）。"}]},{"ID":"20240730141937-76n5b8g","Type":"NodeParagraph","Properties":{"id":"20240730141937-76n5b8g","updated":"20240730141937"},"Children":[{"Type":"NodeText","Data":"为了简化表述，在本章节的剩余部分中，我们将从$L_i()$，$L_o()$和反射方程中省略表面着色点$\\mathbf{p}$，即："}]},{"ID":"20240730141938-87uvysg","Type":"NodeMathBlock","Properties":{"id":"20240730141938-87uvysg","updated":"20240730141938"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"L_{o}(\\mathbf{v})=\\int_{\\mathbf{l} \\in \\Omega} f(\\mathbf{l}, \\mathbf{v}) L_{i}(\\mathbf{l})(\\mathbf{n} \\cdot \\mathbf{l}) d \\mathbf{l}\n\\tag{9.4}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730141939-lo5qc9v","Type":"NodeParagraph","Properties":{"id":"20240730141939-lo5qc9v","updated":"20240730141939"},"Children":[{"Type":"NodeText","Data":"在计算反射方程的时候，通常会使用球坐标$\\phi$和$\\theta$来对半球进行参数化。在这个参数化表示下，微分立体角$d\\mathbf{l}$就等于$\\sin \\theta_{i} d \\theta_{i} d \\phi_{i}$。利用这种球坐标系参数化，我们可以推导出方程9.4的二重积分形式："}]},{"ID":"20240730141940-3remhpd","Type":"NodeMathBlock","Properties":{"id":"20240730141940-3remhpd","updated":"20240730141940"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"L_{o}\\left(\\theta_{o}, \\phi_{o}\\right)=\\int_{\\phi_{i}=0}^{2 \\pi} \\int_{\\theta_{i}=0}^{\\pi / 2} f\\left(\\theta_{i}, \\phi_{i}, \\theta_{o}, \\phi_{o}\\right) L\\left(\\theta_{i}, \\phi_{i}\\right) \\cos \\theta_{i} \\sin \\theta_{i} d \\theta_{i} d \\phi_{i}\n\\tag{9.5}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730141941-880zf12","Type":"NodeParagraph","Properties":{"id":"20240730141941-880zf12","updated":"20240730141941"},"Children":[{"Type":"NodeText","Data":"回顾一下，方程9.4中的$(\\mathbf{n} \\cdot \\mathbf{l}) = \\cos \\theta_i$，有关$\\theta_{i}, \\phi_{i}, \\theta_{o}, \\phi_{o}$的几何意义如图9.17所示。"}]},{"ID":"20240730141942-ovw4i57","Type":"NodeParagraph","Properties":{"id":"20240730141942-ovw4i57","updated":"20240730141942"},"Children":[{"Type":"NodeText","Data":"在某些情况下，我们使用一些稍微不同的参数化表示会变得更加方便，即使用仰角的余弦值$\\mu_{i}=\\cos \\theta_{i} , \\mu_{o}=\\cos \\theta_{o}$，而不是仰角本身$\\theta_{i}, \\theta_{o}$。对于这种参数化表示，微分立体角$d\\mathbf{l}$就等于$d \\mu_{i} d \\phi_{i}$。使用$(\\mu,\\phi)$这种参数化，表示可推导出以下的积分形式:"}]},{"ID":"20240730141943-6i3cekn","Type":"NodeMathBlock","Properties":{"id":"20240730141943-6i3cekn","updated":"20240730141943"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"L_{o}\\left(\\mu_{o}, \\phi_{o}\\right)=\\int_{\\phi_{i}=0}^{2 \\pi} \\int_{\\mu_{i}=0}^{1} f\\left(\\mu_{i}, \\phi_{i}, \\mu_{o}, \\phi_{o}\\right) L\\left(\\mu_{i}, \\phi_{i}\\right) \\mu_{i} d \\mu_{i} d \\phi_{i}\n\\tag{9.6}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730141944-f2pck8r","Type":"NodeParagraph","Properties":{"id":"20240730141944-f2pck8r","updated":"20240730141944"},"Children":[{"Type":"NodeText","Data":"BRDF仅在光线方向和观察方向都位于表面上方时才有定义。对于光线方向在表面下方的情况，可以通过将BRDF乘以零，或者首先不计算这些方向的BRDF来避免这种情况。但是对表面下方的观察方向呢？换句话说就是，当点积$\\mathbf{n} \\cdot \\mathbf{v}$为负的时候会发生什么情况？从理论上来说，这种情况永远都不会发生，因为此时表面是背对相机的，是不可见的。然而，在实时应用中十分常见的顶点法线插值和法线映射等操作，会在实践中产生这样的情况。可以将$\\mathbf{n} \\cdot \\mathbf{v}$的值限制到0，或者使用$\\mathbf{n} \\cdot \\mathbf{v}$的绝对值，来避免BRDF对表面下方的观察方向进行计算，但是这两种方法都会产生一些瑕疵。寒霜引擎使用$\\mathbf{n} \\cdot \\mathbf{v}$的绝对值再加上一个很小的数字（0.0001），来避免发生除以0的情况"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"960]。另一种可能的方法是“soft clamp”，这意味着随着$\\mathbf{n} ,\\mathbf{v}$之间的夹角超过$90^{\\circ}$时，$\\mathbf{n} \\cdot \\mathbf{v}$的值会逐渐趋于0。"}]},{"ID":"20240730141945-w3yecht","Type":"NodeParagraph","Properties":{"id":"20240730141945-w3yecht","updated":"20240730141945"},"Children":[{"Type":"NodeText","Data":"物理定律对任何的BRDF都有两个约束。第一个约束是Helmholtz互易性（Helmholtz reciprocity），这意味着交换入射角和出射角后，其函数值相同，即："}]},{"ID":"20240730141946-5e6tha2","Type":"NodeMathBlock","Properties":{"id":"20240730141946-5e6tha2","updated":"20240730141946"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"f(\\mathbf{l}, \\mathbf{v})=f(\\mathbf{v}, \\mathbf{l})\n\\tag{9.7}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730141947-vf6lox1","Type":"NodeParagraph","Properties":{"id":"20240730141947-vf6lox1","updated":"20240730141947"},"Children":[{"Type":"NodeText","Data":"在实践中，用于渲染的BRDF经常会违反Helmholtz互易性，而且并不会出现明显的瑕疵，除非是一些特别需要Helmholtz互易性的离线渲染算法，例如双向路径跟踪（bidirectional path tracing）。然而，当在确定某种BRDF在物理上是否可信时，Helmholtz互易性是一个有效的鉴别工具。"}]},{"ID":"20240730141948-vi4sunm","Type":"NodeParagraph","Properties":{"id":"20240730141948-vi4sunm","updated":"20240730141948"},"Children":[{"Type":"NodeText","Data":"第二个约束是能量守恒（conservation of energy）——即出射的能量不能大于入射的能量（这里不包含自发光表面，它将作为一个特殊情况进行处理）。离线渲染算法（例如path tracing）需要能量守恒来保证收敛性；而对于实时渲染来说，我们并不需要严格保证能量守恒，但是近似的能量守恒还是很重要的。使用一个明显违背能量守恒的BRDF对表面进行渲染，它会看起来过亮，不太真实。"}]},{"ID":"20240730141949-jgyrkmq","Type":"NodeParagraph","Properties":{"id":"20240730141949-jgyrkmq","updated":"20240730141949"},"Children":[{"Type":"NodeText","Data":"定向半球反射率（directional-hemispherical reflectance）$R(\\mathbf{l})$是一个与BRDF有关的函数，它可以用来衡量BRDF的能量守恒程度。尽管它的名字有点令人生畏，但是定向半球反射率实际上是一个很简单的概念。对于一个给定方向的入射光线，$R(\\mathbf{l})$测量了这个入射光线被反射到半球方向内的数量。本质上，$R(\\mathbf{l})$测量了给定入射方向上的能量损失。这个函数的输入是入射方向$\\mathbf{l}$，$R(\\mathbf{l})$的定义如下："}]},{"ID":"20240730141950-gubo7po","Type":"NodeMathBlock","Properties":{"id":"20240730141950-gubo7po","updated":"20240730141950"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"R(\\mathbf{l})=\\int_{\\mathbf{v} \\in \\Omega} f(\\mathbf{l}, \\mathbf{v})(\\mathbf{n} \\cdot \\mathbf{v}) d \\mathbf{v}\n\\tag{9.8}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730141951-r9slko7","Type":"NodeParagraph","Properties":{"id":"20240730141951-r9slko7","updated":"20240730141951"},"Children":[{"Type":"NodeText","Data":"需要注意的是，这里的观察方向$\\mathbf{v}$，就像反射方程中的入射光方向$\\mathbf{l}$一样，它扫过了整个半球范围，并不是代表单一的观察方向。"}]},{"ID":"20240730141952-chx4txp","Type":"NodeParagraph","Properties":{"id":"20240730141952-chx4txp","updated":"20240730141952"},"Children":[{"Type":"NodeText","Data":"还有一个与$R(\\mathbf{l})$类似，但是某种意义上相反的函数——半球定向反射率$R(\\mathbf{v})$（hemispherical-directional reflectance），其定义与$R(\\mathbf{l})$类似："}]},{"ID":"20240730141953-jjl8xl8","Type":"NodeMathBlock","Properties":{"id":"20240730141953-jjl8xl8","updated":"20240730141953"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"R(\\mathbf{v})=\\int_{\\mathbf{l} \\in \\Omega} f(\\mathbf{l}, \\mathbf{v})(\\mathbf{n} \\cdot \\mathbf{l}) d \\mathbf{l} \\tag{9.9}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730141954-6tlllso","Type":"NodeParagraph","Properties":{"id":"20240730141954-6tlllso","updated":"20240730141954"},"Children":[{"Type":"NodeText","Data":"如果BRDF满足互易性的话（即交换入射方向和出射方向，结果不变），那么半球定向反射率和定向半球反射率实际上是相等的，可以使用同一个函数来计算其中的任意一个。在二者可以交换使用的时候，可以使用定向反照率（directional albedo）这个术语来作为两个反射率的统称。"}]},{"ID":"20240730141955-z6rsyq1","Type":"NodeParagraph","Properties":{"id":"20240730141955-z6rsyq1","updated":"20240730141955"},"Children":[{"Type":"NodeText","Data":"由于能量守恒，因此定向半球反射率$R(\\mathbf{l})$的值必须始终在$"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"[0,1]  $范围内。反射率为0代表着所有的入射光线都被吸收，或者以其他方式丢失；反射率为1代表着所有的入射光线都会被反射。在大多数情况下，$R(\\mathbf{l})$的值将介于这二者之间。与BRDF一样，$R(\\mathbf{l})$的值也会随着波长的变化而变化，因此$R(\\mathbf{l})$被表示为一个RGB向量，以便用于渲染。由于RGB的每个分量（红、绿、蓝）都被限制在$[0,1]$的范围内，因此$R(\\mathbf{l})$也可以被认为是一个颜色。需要注意的是，这个约束不适用于BRDF。BRDF作为一个分布函数，如果其描述的分布高度是不均匀的话，那么它在某些方向上，可以具有任意高的值（例如高光中心）。对BRDF能量守恒的要求是，对于所有可能的入射方向$\\mathbf{l}$，$R(\\mathbf{l})$都不大于1。"}]},{"ID":"20240730141956-njhwcbf","Type":"NodeParagraph","Properties":{"id":"20240730141956-njhwcbf","updated":"20240730141956"},"Children":[{"Type":"NodeText","Data":"最简单的BRDF是Lambertian，它对应于章节5.2中简要讨论的Lambertian着色模型。Lambertian BRDF具有一个恒定值，著名的、用于区分Lambertian着色模型的$ (\\mathbf{n} \\cdot \\mathbf{l})"},{"Type":"NodeSoftBreak","Data":"\n","Properties":{"id":""}},{"Type":"NodeText","Data":"$项并不是BRDF的一部分，而是方程9.4的一部分。尽管Lambertian BRDF很简单，但是它经常用于实时渲染中，以表示局部次表面散射（尽管它正在被更加精确的模型所取代，详见章节9.9）。Lambertian表面的定向半球反射率也是一个常数，将方程9.8中$f(\\mathbf{l}, \\mathbf{v})$项作为一个常数，可以计算得到定向半球反射率$R(\\mathbf{l})$，并将其作为BRDF:"}]},{"ID":"20240730141957-q1hqx45","Type":"NodeMathBlock","Properties":{"id":"20240730141957-q1hqx45","updated":"20240730141957"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"R(\\mathbf{l})=\\pi f(\\mathbf{l}, \\mathbf{v})\n\\tag{9.10}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730141958-j2mw24y","Type":"NodeParagraph","Properties":{"id":"20240730141958-j2mw24y","updated":"20240730141958"},"Children":[{"Type":"NodeText","Data":"Lambertian BRDF的恒定反射率通常被称为漫反射颜色（diffuse）$c_{diff}$，或者反照率（albedo）$\\rho$。在本章节中，为了强调它与次表面散射现象的联系，我们将这个量称为次表面反照率（subsurface albedo）$\\rho_{ss}$。有关次表面反照率的内容，将会在章节9.9.1中详细讨论。由方程9.10得到的BRDF可以推导出如下结果:"}]},{"ID":"20240730141959-tfu0wbt","Type":"NodeMathBlock","Properties":{"id":"20240730141959-tfu0wbt","updated":"20240730141959"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"f(\\mathbf{l}, \\mathbf{v})=\\frac{\\rho_{\\mathrm{ss}}}{\\pi} \\tag{9.11}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730141960-odxyjmd","Type":"NodeParagraph","Properties":{"id":"20240730141960-odxyjmd","updated":"20240730141960"},"Children":[{"Type":"NodeText","Data":"其中包含了$1/\\pi$项，这是因为对余弦项在整个半球范围内进行积分的结果是$\\pi$，这些项经常出现在BRDF中。"}]},{"ID":"20240730141961-oil03su","Type":"NodeBlockquote","Properties":{"id":"20240730141961-oil03su","updated":"20240730141961"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e ","Properties":{"id":""}},{"ID":"20240730141962-d8adigm","Type":"NodeParagraph","Properties":{"id":"20240730141962-d8adigm","updated":"20240730141962"},"Children":[{"Type":"NodeText","Data":"译者注：反照率albedo是一个行星物理学术语，用于描述天体的反射能力，其数学定义是反射辐射和入射辐射之比，是一个无量纲量。而反射率reflectance用于表示某一种波长光线的反射辐射和入射辐射之比。当只存在漫反射，不存在镜面反射时，albedo才等于diffuse，其取值范围在$[0,1]$之间。"}]}]},{"ID":"20240730141963-sbtxdql","Type":"NodeParagraph","Properties":{"id":"20240730141963-sbtxdql","updated":"20240730141963"},"Children":[{"Type":"NodeText","Data":"理解BRDF的一种方法是保持输入方向不变，将其可视化，如图9.18所示。对于给定的入射光方向，会在所有出射方向上展示BRDF的值。围绕着色点的半球部分对应了漫反射分量，因为radiance会在半球范围内被均匀反射。其中的椭球片对应了镜面波瓣（specular lobe），这个波瓣代表了入射光线的出射方向，波瓣的厚度、大小与反射的模糊程度相对应。根据互易性原则，这些BRDF的可视化也可以被认为是不同入射方向对单个出射方向的贡献大小。"}]},{"ID":"20240730141964-01apmyd","Type":"NodeParagraph","Properties":{"id":"20240730141964-01apmyd","updated":"20240730141964"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.18：BRDF的一些例子。图中右侧的绿色实线代表了入射光线的方向，中间的白色实线代表了表面法线，绿色虚线代表了理想状态下的反射方向。在第一行中，左侧展示了一个Lambertian BRDF（一个简单半球）；中间展示了在Lambertian项中添加了Blinn-Phong高光的结果；右侧展示了Cook-Torrance BRDF  ","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"285, 1779","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"]","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":" ，值得注意的是，镜面高光并不是最强的反射方向。在第二行中，左侧是Ward各向异性模型的特写，在这种情况下，反射方向是一个倾斜的镜面波瓣；中间展示了Hapke/Lommel-Seeliger“月面（lunar surface）”BRDF  ","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"664","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"]","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":" ，它具有强烈的后反射；右侧展示了 Lommel-Seeliger散射，尘埃表面会将光线散射到掠射角上（grazing angle）。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611105147-20240730142820-v93p5h0.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.18：BRDF的一些例子。图中右侧的绿色实线代表了入射光线的方向，中间的白色实线代表了表面法线，绿色虚线代表了理想状态下的反射方向。在第一行中，左侧展示了一个Lambertian BRDF（一个简单半球）；中间展示了在Lambertian项中添加了Blinn-Phong高光的结果；右侧展示了Cook-Torrance BRDF  [285, 1779] ，值得注意的是，镜面高光并不是最强的反射方向。在第二行中，左侧是Ward各向异性模型的特写，在这种情况下，反射方向是一个倾斜的镜面波瓣；中间展示了Hapke/Lommel-Seeliger“月面（lunar surface）”BRDF  [664] ，它具有强烈的后反射；右侧展示了 Lommel-Seeliger散射，尘埃表面会将光线散射到掠射角上（grazing angle）。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141965-pmda49n","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240730141965-pmda49n","updated":"20240730141965"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"9.4 光照（Illumination）"}]},{"ID":"20240730141966-p240l1h","Type":"NodeParagraph","Properties":{"id":"20240730141966-p240l1h","updated":"20240730141966"},"Children":[{"Type":"NodeText","Data":"反射方程（方程9.4）中的$L_i(\\mathbf{l})$项（入射radiance），代表了从场景其他部分照射到着色点表面的光线。全局光照（global illumination）算法通过模拟光线在场景中的传播和反射，来计算这个$L_i(\\mathbf{l})$项，这些算法会使用到渲染方程（rendering equation）"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"846]，其中反射方程就是渲染方程的一个特殊例子。有关全局光照的内容将在第11章进行讨论，而在本章节（第9章）和下一章（第10章）中，我们将关注局部光照（local illumination），它使用反射方程来计算每个表面点的局部着色情况。在这些局部光照算法中，$L_i(\\mathbf{l})$项是默认已知的，因此不需要进行计算。"}]},{"ID":"20240730141967-d0jhsav","Type":"NodeParagraph","Properties":{"id":"20240730141967-d0jhsav","updated":"20240730141967"},"Children":[{"Type":"NodeText","Data":"在现实场景中，$L_i(\\mathbf{l})$包括了来自各个方向的非零radiance，无论这些radiance是直接从光源发射出的，还是从其他表面反射出的。与章节5.2中所讨论的方向光和精确光源不同，现实世界的光源一个是覆盖了非零立体角的面光源（area light）。在本章节中，我们将假定使用有限形式的$L_i(\\mathbf{l})$，它仅由方向光和精确光源组成，而更加一般的光照环境将留到第10章进行讨论。有了这个限制前提，可以使得本章节的讨论更加集中有效。"}]},{"ID":"20240730141968-ojhx4oq","Type":"NodeParagraph","Properties":{"id":"20240730141968-ojhx4oq","updated":"20240730141968"},"Children":[{"Type":"NodeText","Data":"虽然方向光和精确光源都是非物理的抽象光源，但是它们可以作为对物理光源的近似。这样的推导其实是很重要的，因为这样做我们可以将这些光源合并到一个基于物理的渲染框架中，同时能够把握近似所带来的误差。"}]},{"ID":"20240730141969-zlf7c79","Type":"NodeParagraph","Properties":{"id":"20240730141969-zlf7c79","updated":"20240730141969"},"Children":[{"Type":"NodeText","Data":"假设现在我们取一个很小的、很远的面光源，并定义向量$\\mathbf{l}"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"em","TextMarkTextContent":"{c}$指向该面光源的几何中心；同时，我们将该面光源的颜色$\\mathbf{c}"},{"Type":"NodeText","Data":"{light}$定义为：从正对（$\\mathbf{n}=\\mathbf{l}_{c}$）该光源的白色Lambertian表面所反射出的radiance。这是一个很直观的定义，因为光线的颜色直接对应了它所产生的视觉效果。"}]},{"ID":"20240730141970-nvnj0vf","Type":"NodeParagraph","Properties":{"id":"20240730141970-nvnj0vf","updated":"20240730141970"},"Children":[{"Type":"NodeText","Data":"有了以上这些定义，我们可以推导出方向光的一种极限情况：即在保持光源颜色$\\mathbf{c}_{light}$不变的情况下，将面光源的大小缩小到零"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"758]。在这种情况下，反射方程（方程9.4）中的积分可以简化为一个BRDF计算，这个计算成本要低得多："}]},{"ID":"20240730141971-0mve4zg","Type":"NodeMathBlock","Properties":{"id":"20240730141971-0mve4zg","updated":"20240730141971"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"L_{o}(\\mathbf{v})=\\pi f\\left(\\mathbf{l}_{c}, \\mathbf{v}\\right) \\mathbf{c}_{\\text {light }}\\left(\\mathbf{n} \\cdot \\mathbf{l}_{c}\\right)\n\\tag{9.12}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730141972-jqcy3oo","Type":"NodeParagraph","Properties":{"id":"20240730141972-jqcy3oo","updated":"20240730141972"},"Children":[{"Type":"NodeText","Data":"上述方程中的$\\left(\\mathbf{n} \\cdot \\mathbf{l}_{c}\\right)$通常会被限制到0，从而避免表面下方的光线对这个着色点产生贡献，即："}]},{"ID":"20240730141973-htuuj7r","Type":"NodeMathBlock","Properties":{"id":"20240730141973-htuuj7r","updated":"20240730141973"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"L_{o}(\\mathbf{v})=\\pi f\\left(\\mathbf{l}_{c}, \\mathbf{v}\\right) \\mathbf{c}_{\\text {light }}\\left(\\mathbf{n} \\cdot \\mathbf{l}_{c}\\right)^{+}\n\\tag{9.13}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730141974-d8ltnf1","Type":"NodeParagraph","Properties":{"id":"20240730141974-d8ltnf1","updated":"20240730141974"},"Children":[{"Type":"NodeText","Data":"方程9.13中的符号$x^{+}$代表了将$x$限制到0，我们在章节1.2中讨论过。"}]},{"ID":"20240730141975-t0i4q9j","Type":"NodeParagraph","Properties":{"id":"20240730141975-t0i4q9j","updated":"20240730141975"},"Children":[{"Type":"NodeText","Data":"精确光源同样也可以这样进行处理，二者唯一的区别在于，面光源不需要距离着色点很远，同时$\\mathbf{c}_{light}$的值会随着到光源的距离，发生平方反比衰减，如方程5.11所示。当场景中存在多个光源的时候，我们可以多次计算方程9.12，并对结果求和，即："}]},{"ID":"20240730141976-6po46pm","Type":"NodeMathBlock","Properties":{"id":"20240730141976-6po46pm","updated":"20240730141976"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"L_{o}(\\mathbf{v})=\\pi \\sum_{i=1}^{n} f\\left(\\mathbf{l}_{c_{i}}, \\mathbf{v}\\right) \\mathbf{c}_{\\text {light }_{i}}\\left(\\mathbf{n} \\cdot \\mathbf{l}_{c_{i}}\\right)^{+}\n\\tag{9.14}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730141977-aa245ne","Type":"NodeParagraph","Properties":{"id":"20240730141977-aa245ne","updated":"20240730141977"},"Children":[{"Type":"NodeText","Data":"其中$\\mathbf{l}"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"em","TextMarkTextContent":"{c"},{"Type":"NodeText","Data":"{i}}$代表了第$i$个光源的方向，$\\mathbf{c}"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"em","TextMarkTextContent":"{\\text {light }"},{"Type":"NodeText","Data":"{i}}$代表了第$i$个光源的颜色。请注意方程9.14和方程5.6之间的相似性。"}]},{"ID":"20240730141978-v2obv1v","Type":"NodeParagraph","Properties":{"id":"20240730141978-v2obv1v","updated":"20240730141978"},"Children":[{"Type":"NodeText","Data":"方程9.14中的$\\pi$，会和BRDF中经常出现的$1/\\pi$相抵消（例如方程9.11）。这种抵消可以将除法操作移出着色器，并且使得着色方程更加易于阅读。然而，在将学术论文中的BRDF用于实时着色方程时，必须谨慎处理这一点，通常情况下，BRDF在使用之前需要乘以$\\pi$。"}]},{"ID":"20240730141979-czu5tjd","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240730141979-czu5tjd","updated":"20240730141979"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"9.5 菲涅尔反射"}]},{"ID":"20240730141980-fdsnipe","Type":"NodeParagraph","Properties":{"id":"20240730141980-fdsnipe","updated":"20240730141980"},"Children":[{"Type":"NodeText","Data":"在章节9.1中，我们从一个较高的层次讨论了光与物质的相互作用。在章节9.3中，我们介绍了如何使用数学形式，来表达这些相互作用的基本机制：BRDF和反射方程。现在我们准备开始深入研究一些特定的光学现象，并对这些现象进行量化描述，以便可以在着色模型中使用它们。我们将从章节9.1.3中首次讨论的平面反射开始。"}]},{"ID":"20240730141981-cwxi9zz","Type":"NodeParagraph","Properties":{"id":"20240730141981-cwxi9zz","updated":"20240730141981"},"Children":[{"Type":"NodeText","Data":"物体的表面是指周围介质（通常是空气）与内部物质之间的分界面，光与两种物质之间的平面分界面的相互作用，遵循菲涅尔方程（Fresnel equation），它是由 Augustin-Jean Fresnel（1788 - 1827）提出的。根据几何光学的假设，菲涅尔方程需要一个平面分界面才能生效；也就是说，我们会假设这个表面在1-100倍光线波长的范围内不存在任何不规则性。小于这个范围的不规则性对光线没有影响，而大于这个范围的不规则性，会明显改变表面的倾斜程度，但是并不影响表面局部的平坦性。"}]},{"ID":"20240730141982-rs9skey","Type":"NodeParagraph","Properties":{"id":"20240730141982-rs9skey","updated":"20240730141982"},"Children":[{"Type":"NodeText","Data":"照射到平面上的光线会分为反射和折射两个部分。反射光线的方向（$\\mathbf{r}_i$）与表面法线$\\mathbf{n}$之间的夹角，入射光线方向（$\\mathbf{l}$）和表面法线$\\mathbf{n}$之间的夹角，这两个夹角是完全相同的，记为$\\theta_i$。反射向量$\\mathbf{r}_i$可以由表面法线$\\mathbf{n}$和入射光方向$\\mathbf{l}$计算得出："}]},{"ID":"20240730141983-vk292u6","Type":"NodeMathBlock","Properties":{"id":"20240730141983-vk292u6","updated":"20240730141983"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"\\mathbf{r}_{i}=2(\\mathbf{n} \\cdot \\mathbf{l}) \\mathbf{n}-1 \\tag{9.15}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730141984-rde9o5u","Type":"NodeParagraph","Properties":{"id":"20240730141984-rde9o5u","updated":"20240730141984"},"Children":[{"Type":"NodeText","Data":"如图9.19所示。反射光的光量（入射光的一部分）由菲涅尔反射率（Fresnel reflectance）$F$来描述，它取决于入射角度$\\theta_i$。"}]},{"ID":"20240730141985-bz6jfui","Type":"NodeParagraph","Properties":{"id":"20240730141985-bz6jfui","updated":"20240730141985"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.19：平面反射的示意图。入射光 \\mathbf{l} 在表面法线 \\mathbf{n} 周围发生反射，从而生成反射光 \\mathbf{r}","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"_","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"i 。整个过程如下：首先将入射光 \\mathbf{l} 投影到表面法线 \\mathbf{n} 上，我们可以得到一个缩放过的法线 (\\mathbf{n} \\cdot \\mathbf{l}) \\mathbf{n} ；然后我们将入射光 \\mathbf{l} 取反，加上两个刚才的投影向量，最终可以获得反射向量 \\mathbf{r}","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"_","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"i 。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611105219-20240730142820-x71p17o.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.19：平面反射的示意图。入射光 \\mathbf{l} 在表面法线 \\mathbf{n} 周围发生反射，从而生成反射光 \\mathbf{r}_i 。整个过程如下：首先将入射光 \\mathbf{l} 投影到表面法线 \\mathbf{n} 上，我们可以得到一个缩放过的法线 (\\mathbf{n} \\cdot \\mathbf{l}) \\mathbf{n} ；然后我们将入射光 \\mathbf{l} 取反，加上两个刚才的投影向量，最终可以获得反射向量 \\mathbf{r}_i 。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141986-r5hsn00","Type":"NodeParagraph","Properties":{"id":"20240730141986-r5hsn00","updated":"20240730141986"},"Children":[{"Type":"NodeText","Data":"如章节9.1.3所讨论的，反射和折射会受到表面两侧物质折射率的影响，我们将继续使用前面讨论时所用到过的一些符号表示。$n_1$代表了表面“上方”物质的折射率，即入射光和反射光传播的那一侧；$n_2$代表了表面“下方”物质的折射率，即折射光传播的那一侧。"}]},{"ID":"20240730141987-cotwzps","Type":"NodeParagraph","Properties":{"id":"20240730141987-cotwzps","updated":"20240730141987"},"Children":[{"Type":"NodeText","Data":"菲涅尔方程描述了$F$对入射角度$\\theta_i$、折射率$n_1$，$n_2$的依赖关系，这些方程本身有些复杂，下面我们将描述菲涅尔反射的重要特征，而不是直接给出其数学表达式。"}]},{"ID":"20240730141988-ioengz0","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240730141988-ioengz0","updated":"20240730141988"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"9.5.1 外反射"}]},{"ID":"20240730141989-gmihui4","Type":"NodeParagraph","Properties":{"id":"20240730141989-gmihui4","updated":"20240730141989"},"Children":[{"Type":"NodeText","Data":"外反射（external reflection）是指$n_1 \u003c n_2$的情况，也就是说，光线是从折射率较低的那一侧表面发出来的。在大多数情况下，表面的这一侧都是空气，其折射率约为1.003。为了简单起见，我们假设$n_1 =1$。与外反射相反，光线从物体内部传播到空气中的反射过程被称为内反射（internal reflection），稍后将在章节9.5.3中进行讨论。 "},{"Type":"NodeHTMLEntity","Data":" ","HtmlEntityTokens":"JiN4MjA7","Properties":{"id":""}}]},{"ID":"20240730141990-ytd1y8l","Type":"NodeParagraph","Properties":{"id":"20240730141990-ytd1y8l","updated":"20240730141990"},"Children":[{"Type":"NodeText","Data":"对于一种给定的物质，菲涅尔方程可以被解释为一个仅依赖于入射光角度的反射率函数$F\\left(\\theta_{i}\\right)$。原则上来说，$F\\left(\\theta_{i}\\right)$的值会在可见光谱上连续变化，但是出于渲染目的，这个函数的输出会被视为一个$RGB$向量。函数$F\\left(\\theta_{i}\\right)$具有以下特征："}]},{"ID":"20240730141991-uom3u22","Type":"NodeList","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141991-uom3u22","updated":"20240730141991"},"Children":[{"ID":"20240730141992-uqhxzdq","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141992-uqhxzdq","updated":"20240730141992"},"Children":[{"ID":"20240730141993-v6amg48","Type":"NodeParagraph","Properties":{"id":"20240730141993-v6amg48","updated":"20240730141993"},"Children":[{"Type":"NodeText","Data":"当$\\theta_{i}=0^{\\circ}$，即当光线垂直于表面（$\\mathbf{l}=\\mathbf{n}$）时，$F\\left(\\theta_{i}\\right)$的值反映了物质本身的属性。这个特殊值$F_0$，可以被认为是物质特有的镜面颜色。我们将$\\theta_{i}=0^{\\circ}$的情况称为法线反射（normal incidence）（或者是法向入射，垂直入射等）。"}]}]},{"ID":"20240730141994-bipfqfr","Type":"NodeListItem","Data":"-","ListData":{"Tight":true,"BulletChar":45,"Padding":4,"Marker":"LQ==","Num":-1},"Properties":{"id":"20240730141994-bipfqfr","updated":"20240730141994"},"Children":[{"ID":"20240730141995-y1bi47c","Type":"NodeParagraph","Properties":{"id":"20240730141995-y1bi47c","updated":"20240730141995"},"Children":[{"Type":"NodeText","Data":"随着$\\theta_{i}$的不断增大，入射光线会以越来越大的掠射角度照射到表面上，$F\\left(\\theta_{i}\\right)$的值将不断增加，当$\\theta_{i}=90^{\\circ}$时，对于任何频率的入射光，$F\\left(\\theta_{i}\\right)$都会输出1（即白色）。"},{"Type":"NodeHTMLEntity","Data":" ","HtmlEntityTokens":"JiN4MjA7","Properties":{"id":""}}]}]}]},{"ID":"20240730141996-0dt7ter","Type":"NodeParagraph","Properties":{"id":"20240730141996-0dt7ter","updated":"20240730141996"},"Children":[{"Type":"NodeText","Data":"图9.20以几种不同的方式可视化展示了几种物质的$F\\left(\\theta_{i}\\right)$函数。这些曲线是高度非线性的——当$\\theta_{i}$较小的时候，它们几乎没有变化；直到$\\theta_{i}=90^{\\circ}$左右，函数值会迅速增长为1。大部分物质的$F\\left(\\theta_{i}\\right)$函数会从$F_0$单调增长到1，但是有些特殊物质（例如图9.20中的铝）在变白（1）之前会有轻微的下降。"}]},{"ID":"20240730141997-t1v662w","Type":"NodeParagraph","Properties":{"id":"20240730141997-t1v662w","updated":"20240730141997"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.20：三种物质外反射的菲涅尔反射率 F ，从左到右分别是：玻璃、铜、铝。第一行是 F 作为波长和入射角的函数的三维示意图。第二行展示了在不同入射角下， F 的光谱值转换为 RGB 颜色通道的曲线。其中玻璃的三个通道曲线是完全一致的，因为它的菲涅尔反射是无色的。在第三行中，RGB通道曲线是根据入射角的正弦值进行绘制的，以解释 图9.21 所示的透视缩减。第三行图片中 x 轴还展示了菲涅尔反射的 RGB 颜色。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611105235-20240730142820-g56ru0y.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.20：三种物质外反射的菲涅尔反射率 F ，从左到右分别是：玻璃、铜、铝。第一行是 F 作为波长和入射角的函数的三维示意图。第二行展示了在不同入射角下， F 的光谱值转换为 RGB 颜色通道的曲线。其中玻璃的三个通道曲线是完全一致的，因为它的菲涅尔反射是无色的。在第三行中，RGB通道曲线是根据入射角的正弦值进行绘制的，以解释 图9.21 所示的透视缩减。第三行图片中 x 轴还展示了菲涅尔反射的 RGB 颜色。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730141998-9exd3o7","Type":"NodeParagraph","Properties":{"id":"20240730141998-9exd3o7","updated":"20240730141998"},"Children":[{"Type":"NodeText","Data":"在镜面反射（mirror reflection）的情况下，光线的出射角与入射角完全相同，这意味着与表面呈掠射角度的入射光线（$\\theta_{i}$的值接近90◦），其出射光线也与表面呈掠射角度，并最终进入相机或者眼睛，因此反射率的增加主要会出现在物体的边缘处。此外，从相机的视角来看，表面反射率增加最剧烈的部分会被透视缩短（foreshortened），因此这部分所占用的像素数量相对较少。为了展示菲涅尔曲线的不同部分与其视觉突出程度（prominence）成比例，图9.22和图9.20的下半部分所展示的菲涅尔反射率曲线和色条，都是使用$\\sin \\left(\\theta_{i}\\right)$作为参数进行绘制的，而不是直接使用$\\theta_{i}$作为参数。图9.21则说明了为什么$\\sin \\left(\\theta_{i}\\right)$是一个更加合适的参数选择。"}]},{"ID":"20240730141999-eksp5ad","Type":"NodeParagraph","Properties":{"id":"20240730141999-eksp5ad","updated":"20240730141999"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.21：远离眼睛的斜面会被透视缩短。这种透视缩短与按照视角方向 \\mathbf{v} 和表面法线 \\mathbf{n} 之间夹角的正弦值，来对表面点进行投影是一致的（对于镜面反射而言，这个夹角与入射角相同）。因此，在 图9.20 和 图9.22 中，菲涅尔反射率曲线是根据入射角的正弦值进行绘制的。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611105259-20240730142820-foqj1i0.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.21：远离眼睛的斜面会被透视缩短。这种透视缩短与按照视角方向 \\mathbf{v} 和表面法线 \\mathbf{n} 之间夹角的正弦值，来对表面点进行投影是一致的（对于镜面反射而言，这个夹角与入射角相同）。因此，在 图9.20 和 图9.22 中，菲涅尔反射率曲线是根据入射角的正弦值进行绘制的。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730142000-42dz6xz","Type":"NodeParagraph","Properties":{"id":"20240730142000-42dz6xz","updated":"20240730142000"},"Children":[{"Type":"NodeText","Data":"从现在开始，为了强调所涉及的向量，我们使用符号$F(\\mathbf{n}, \\mathbf{l})$而不是$F\\left(\\theta_{i}\\right)$来表示菲涅尔函数。回想一下，$\\theta_{i}$是表面法线$\\mathbf{n}$和入射光方向$\\mathbf{l}$之间的夹角。当菲涅尔函数被整合为BRDF的一部分时，通常会使用一个不同的向量来代替表面法线$\\mathbf{n}$，详见章节9.8。"}]},{"ID":"20240730142001-b3xoh20","Type":"NodeParagraph","Properties":{"id":"20240730142001-b3xoh20","updated":"20240730142001"},"Children":[{"Type":"NodeText","Data":"在有关渲染的出版物中，在掠射角度处反射率剧烈增加的现象，通常被称为菲涅尔效应（Fresnel effect）(而在其他领域中，该术语则具有不同的含义，它与无线电波的传输有关）。我们可以通过一个简单的小实验，来亲眼看到菲涅尔效应。带上你的智能手机，坐在光线明亮的地方（比如电脑显示器前）。在不打开手机屏幕显示的情况下，首先将手机靠近胸口，低头看手机，并将手机略微倾斜，使得手机屏幕能够反射出显示器。此时手机屏幕上会有一个相对较弱的显示器反射，这是因为玻璃的法线入射反射率很低。现在将手机向上抬起，使其大致位于眼睛和显示器之间，并再次调整屏幕的角度，使其能够反射出显示器。现在显示器在手机屏幕上的反射，应当几乎与显示器本身一样明亮清晰。"}]},{"ID":"20240730142002-nojkwg9","Type":"NodeParagraph","Properties":{"id":"20240730142002-nojkwg9","updated":"20240730142002"},"Children":[{"Type":"NodeText","Data":"除了非常复杂之外，菲涅尔方程还有一些其他的特性，这些特性使得菲涅尔方程很难直接用于渲染。它需要在可见光谱上采样折射率值，这些值可能会是复数。图9.20中的曲线展示了一种基于特征高光颜色$F_0$的简化方法。Schlick "},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"1568]给出了菲涅尔反射率的近似值，如下所示："}]},{"ID":"20240730142003-ymgk88d","Type":"NodeMathBlock","Properties":{"id":"20240730142003-ymgk88d","updated":"20240730142003"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"F(\\mathbf{n}, \\mathbf{l}) \\approx F_{0}+\\left(1-F_{0}\\right)\\left(1-(\\mathbf{n} \\cdot \\mathbf{l})^{+}\\right)^{5}\n\\tag{9.16}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730142004-uovvjlp","Type":"NodeParagraph","Properties":{"id":"20240730142004-uovvjlp","updated":"20240730142004"},"Children":[{"Type":"NodeText","Data":"这个函数实际上就是在白色和$F_0$之间进行RGB插值，尽管它很简单，但是这个近似还是相当准确的。"}]},{"ID":"20240730142005-hyotzl2","Type":"NodeParagraph","Properties":{"id":"20240730142005-hyotzl2","updated":"20240730142005"},"Children":[{"Type":"NodeText","Data":"图9.22展示了几种偏离Schlick曲线的物质，它们（第二行）在变白之前会表现出明显的“下降”。事实上，之所以选择这些物质进行展示，就是因为它们在很大程度上偏离了Schlick近似。但是即使对于这些物质而言，Schlick近似所带来的误差也相当微小，如图中每个曲线下面的颜色条。在极少数情况下，我们可能需要精确模拟这些材料的菲涅尔反射，那么此时可以使用Gulbrandsen "},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"623]给出的另一种近似方法，这种近似方法可以精确近似金属的菲涅尔方程，但是计算开销要高于Schlick近似。一个更加简单的选择是对Schlick近似进行修改，使得它可以将最后一项提高到5次幂以上（方程9.18）。这种修改会改变过渡到白色的“速度”，从而使得近似更加精确。Lagarde "},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"959]对菲涅尔方程以及几种近似方法进行了总结。"}]},{"ID":"20240730142006-gyp3f3b","Type":"NodeParagraph","Properties":{"id":"20240730142006-gyp3f3b","updated":"20240730142006"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.22：展示了Schlick的菲涅耳反射率近似值，与六种物质外反射精确值之间的对比。前三种物质与 图9.20 中所展示的相同，从左到右分别是：玻璃、铜、铝；下面三种物质分别是：铬、铁和锌。每种物质都有一个RGB通道曲线图，其中实线代表了精确的菲涅尔方程，虚线代表了Schlick近似。每个曲线图下面有两个颜色条，其中上面的颜色条代表了精确菲涅耳方程的结果，下面的颜色条代表了Schlick近似的结果。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611105312-20240730142820-8g1ehp9.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.22：展示了Schlick的菲涅耳反射率近似值，与六种物质外反射精确值之间的对比。前三种物质与 图9.20 中所展示的相同，从左到右分别是：玻璃、铜、铝；下面三种物质分别是：铬、铁和锌。每种物质都有一个RGB通道曲线图，其中实线代表了精确的菲涅尔方程，虚线代表了Schlick近似。每个曲线图下面有两个颜色条，其中上面的颜色条代表了精确菲涅耳方程的结果，下面的颜色条代表了Schlick近似的结果。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730142007-02jb7ny","Type":"NodeParagraph","Properties":{"id":"20240730142007-02jb7ny","updated":"20240730142007"},"Children":[{"Type":"NodeText","Data":"当我们使用Schlick近似时，$F_0$是控制菲涅尔反射的唯一参数。这种方式十分方便，因为$F_0$在$[0,1]$中有一个定义良好的有效值范围，很容易使用标准的颜色选择界面进行设置，并且可以使用为颜色设计的纹理格式来进行纹理化操作。此外，还可以使用许多现实世界材料的属性来作为$F_0$的参考值。$F_0$也可以通过折射率计算得出，通常假设空气折射率的近似值$n_1 = 1$，用$n$代替$n_2$，来表示物体的折射率。简化之后可以获得如下方程："}]},{"ID":"20240730142008-7tllxop","Type":"NodeMathBlock","Properties":{"id":"20240730142008-7tllxop","updated":"20240730142008"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"F_{0}=\\left(\\frac{n-1}{n+1}\\right)^{2}\n\\tag{9.17}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730142009-hbz7097","Type":"NodeParagraph","Properties":{"id":"20240730142009-hbz7097","updated":"20240730142009"},"Children":[{"Type":"NodeText","Data":"如果使用复数结果的话，这个方程甚至适用于复数折射率（例如金属的折射率）。在可见光谱中折射率变化较大的情况下，计算$F_0$的精确RGB值，需要首先计算密集采样波长下的$F_0$，然后再使用章节8.1.3种所描述的方法，将得到的光谱矢量转换为RGB值。"}]},{"ID":"20240730142010-16zkk76","Type":"NodeParagraph","Properties":{"id":"20240730142010-16zkk76","updated":"20240730142010"},"Children":[{"Type":"NodeText","Data":"在一些应用中"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"732, 947]使用了Schlick近似的更一般形式："}]},{"ID":"20240730142011-h8z673o","Type":"NodeMathBlock","Properties":{"id":"20240730142011-h8z673o","updated":"20240730142011"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"F(\\mathbf{n}, \\mathbf{l}) \\approx F_{0}+\\left(F_{90}-F_{0}\\right)\\left(1-(\\mathbf{n} \\cdot \\mathbf{l})^{+}\\right)^{\\frac{1}{p}}\n\\tag{9.18}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730142012-5xldiuz","Type":"NodeParagraph","Properties":{"id":"20240730142012-5xldiuz","updated":"20240730142012"},"Children":[{"Type":"NodeText","Data":"这个方程可以让我们控制菲涅尔曲线在$90^{\\circ}$时所过渡到的颜色，以及过渡的“速度”。使用这种更加一般的形式，通常是为了增加艺术可控性，但是在某些情况下，它也可以对现实进行更加精确的近似。上面我们提到，修改幂次可以使得某些材质更加接近现实。此外，对于一些材质而言，菲涅耳方程无法很好地描述它们，而将$F_{90}$设置为白色以外的颜色，则可以帮助对它们的近似，例如被细尘覆盖的表面，这些细尘颗粒的大小与单个光波的大小相当。"}]},{"ID":"20240730142013-r1p7s3n","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240730142013-r1p7s3n","updated":"20240730142013"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"9.5.2 典型的菲涅尔反射值"}]},{"ID":"20240730142014-jrz9jk1","Type":"NodeParagraph","Properties":{"id":"20240730142014-jrz9jk1","updated":"20240730142014"},"Children":[{"Type":"NodeText","Data":"物质根据其光学特性可以分为三大类，它们分别是电介质（dielectric），也就是绝缘体（insulator）；金属（metal），它们是导体（conductor）；半导体（semiconductor），它的性质介于电介质和金属之间。"}]},{"ID":"20240730142015-n9x197z","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240730142015-n9x197z","updated":"20240730142015"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"电介质的菲涅尔反射率"}]},{"ID":"20240730142016-68948q8","Type":"NodeParagraph","Properties":{"id":"20240730142016-68948q8","updated":"20240730142016"},"Children":[{"Type":"NodeText","Data":"我们日常生活中遇到的大多数材料都是电介质——玻璃、皮肤、木材、头发、皮革、塑料、石头和混凝土等等。水也是电介质，这可能会让你感到惊讶，因为我们知道，日常生活中的水是可以导电的，但是实际上纯水是不导电的，这种导电性是由于水中含有的各种杂质所产生的。电介质具有相当低的$F_0$值，通常为0.06或者更低。法线反射时的低反射率，会使得菲涅尔效应在电介质中尤为明显。电介质的光学特性在可见光谱上的变化很小，从而会导致无色的反射率值。几种常见电介质的$F_0$值如表9.1所示，表中的数值都是标量而不是RGB值，这是因为这些材质的RGB通道并没有显著的差异。为了方便起见，表9.1中包含了线性值，以及用sRGB转换函数编码的8 bit值（通常在纹理绘制应用中会使用这种形式）。"}]},{"ID":"20240730142017-iissu6g","Type":"NodeParagraph","Properties":{"id":"20240730142017-iissu6g","updated":"20240730142017"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"表9.1：各种电介质的外反射 F","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"_","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"0 值。每个值都以线性值、纹理值（非线性编码的8 bit无符号整数）和色板的形式给出。如果给定的 F","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"_","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"0 值是一个范围，那么色板展示是该范围的中间颜色。回想一下，这些都是镜面颜色，例如：宝石通常具有十分鲜艳的颜色，但是这些颜色是由于物质内部的光线吸收而产生的，与菲涅尔反射无关。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611105336-20240730142820-w70cm4u.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"表9.1：各种电介质的外反射 F_0 值。每个值都以线性值、纹理值（非线性编码的8 bit无符号整数）和色板的形式给出。如果给定的 F_0 值是一个范围，那么色板展示是该范围的中间颜色。回想一下，这些都是镜面颜色，例如：宝石通常具有十分鲜艳的颜色，但是这些颜色是由于物质内部的光线吸收而产生的，与菲涅尔反射无关。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730142018-k1ujs7n","Type":"NodeParagraph","Properties":{"id":"20240730142018-k1ujs7n","updated":"20240730142018"},"Children":[{"Type":"NodeText","Data":"其他电介质的$F_0$值可以通过查看表中的类似物质推断出来。对于未知的电介质而言，0.04是一个合理的默认值（译者注：metallic工作流中，非金属的$F_0$值一般为0.04），这与大多数常见材料的$F_0$值相差不大。"}]},{"ID":"20240730142019-5svzl9g","Type":"NodeParagraph","Properties":{"id":"20240730142019-5svzl9g","updated":"20240730142019"},"Children":[{"Type":"NodeText","Data":"一旦光线进入了电介质内部，那么它就有可能会被进一步散射或者吸收。章节9.9将详细讨论这个过程的模型。如果物体的材质是透明的，光线将继续传播，直到“从内部”照射到物体表面，我们将在章节9.5.3中进行详细讨论。"}]},{"ID":"20240730142020-melwy5c","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240730142020-melwy5c","updated":"20240730142020"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"金属的菲涅尔反射率"}]},{"ID":"20240730142021-ni6a1a6","Type":"NodeParagraph","Properties":{"id":"20240730142021-ni6a1a6","updated":"20240730142021"},"Children":[{"Type":"NodeText","Data":"金属的$F_0$值普遍很高，几乎都在0.5以上。一些金属的光学特性会在可见光谱上发生较大的变化，从而会产生彩色的反射值。几种金属的$F_0$值如表9.2所示。"}]},{"ID":"20240730142022-i6kusls","Type":"NodeParagraph","Properties":{"id":"20240730142022-i6kusls","updated":"20240730142022"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"表9.2：各种金属（和一种合金）的外反射 F","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"_","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"0 值，按照反射亮度的顺序进行排序。黄金的实际红色分量略微超出了sRGB色域，图中展示的是clamp后的值。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611105352-20240730142820-tpztxy4.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"表9.2：各种金属（和一种合金）的外反射 F_0 值，按照反射亮度的顺序进行排序。黄金的实际红色分量略微超出了sRGB色域，图中展示的是clamp后的值。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730142023-3iody2q","Type":"NodeParagraph","Properties":{"id":"20240730142023-3iody2q","updated":"20240730142023"},"Children":[{"Type":"NodeText","Data":"与表9.1类似，表9.2中包含了线性值以及用于纹理的8 bit sRGB编码值。然而不同之处在于，这里我们给出了RGB各个分量的详细数值，因为许多金属都具有彩色的菲涅尔反射。这些RGB值是使用sRGB原色（与Rec. 709，电影电视行业所使用的一种色域）和白点定义的。黄金的$F_0$值有些不太寻常，它有着非常强烈的反射颜色，其红色通道值略高于1（刚刚超出sRGB/Rec.709色域），其蓝色通道值则特别低（表9.2中唯一一个显著低于0.5的）。黄金也是最亮的金属之一，从它在表中的位置可以看出，因为表格是按照亮度进行排序的。黄金明亮且强烈的反射率，可能有助于其在历史上独特的文化意义和经济意义。"}]},{"ID":"20240730142024-puoh19v","Type":"NodeParagraph","Properties":{"id":"20240730142024-puoh19v","updated":"20240730142024"},"Children":[{"Type":"NodeText","Data":"回顾一下，金属会立即吸收任何透射光线，因此它们并不会表现出任何的次表面散射或者透明度。金属的所有可见颜色都来自于其$F_0$值。"}]},{"ID":"20240730142025-rr6aucf","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240730142025-rr6aucf","updated":"20240730142025"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"半导体的菲涅尔反射值"}]},{"ID":"20240730142026-75bblip","Type":"NodeParagraph","Properties":{"id":"20240730142026-75bblip","updated":"20240730142026"},"Children":[{"Type":"NodeText","Data":"正如人们所料，半导体的$F_0$值介于最亮的电介质和最暗的金属之间，如表9.3所示。在实践中我们很少需要渲染这样的物质，因为大多数渲染场景中并没有散落着的晶体硅块。出于实践目的，应当避免使用0.2-0.45之间的$F_0$值，除非您有意尝试建模一个奇异的或者非真实的材质。"}]},{"ID":"20240730142027-mg2jzdz","Type":"NodeParagraph","Properties":{"id":"20240730142027-mg2jzdz","updated":"20240730142027"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"表9.3：图中展示了代表性半导体（晶体形式的硅）的 F","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"_","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"0 值，以及与明亮的电介质（金刚石）和较暗的金属（钛）的对比。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611105412-20240730142820-wrd3146.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"表9.3：图中展示了代表性半导体（晶体形式的硅）的 F_0 值，以及与明亮的电介质（金刚石）和较暗的金属（钛）的对比。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730142028-ms3onxp","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240730142028-ms3onxp","updated":"20240730142028"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"水中的菲涅尔反射率"}]},{"ID":"20240730142029-l31ww49","Type":"NodeParagraph","Properties":{"id":"20240730142029-l31ww49","updated":"20240730142029"},"Children":[{"Type":"NodeText","Data":"在我们有关外反射的讨论中，我们假设要渲染的表面被空气包围。如果实际情况不是这样的话，那么反射率就会改变，因为它取决于表面两侧折射率的比值。如果我们不能假设$n_1 = 1$的话，则需要将方程9.17中的$n$替换为相对折射率$n_1/n_2$。即下面这个更加一般化的方程："}]},{"ID":"20240730142030-nqqe7nu","Type":"NodeMathBlock","Properties":{"id":"20240730142030-nqqe7nu","updated":"20240730142030"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"F_{0}=\\left(\\frac{n_{1}-n_{2}}{n_{1}+n_{2}}\\right)^{2}\n\\tag{9.19}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730142031-a98bwzj","Type":"NodeParagraph","Properties":{"id":"20240730142031-a98bwzj","updated":"20240730142031"},"Children":[{"Type":"NodeText","Data":"$n_1 \\ne 1$最常见的情况就是水下场景，由于水的折射率大约是空气的1.33倍，因此水下的$F_0$值是完全不同的，电介质的这种效应要比金属更强，如表9.4所示。"}]},{"ID":"20240730142032-kbda00s","Type":"NodeParagraph","Properties":{"id":"20240730142032-kbda00s","updated":"20240730142032"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"表9.4：各种物质在空气和水中的 F","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"_","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"0 值的比较。正如 方程9.19 所期望的那样，折射率接近水的电介质所受到的影响最大。相比之下，金属几乎没有受到什么影响。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611105427-20240730142820-nknewf9.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"表9.4：各种物质在空气和水中的 F_0 值的比较。正如 方程9.19 所期望的那样，折射率接近水的电介质所受到的影响最大。相比之下，金属几乎没有受到什么影响。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730142033-o2xvy1x","Type":"NodeHeading","HeadingLevel":4,"Properties":{"id":"20240730142033-o2xvy1x","updated":"20240730142033"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"#### ","Properties":{"id":""}},{"Type":"NodeText","Data":"参数化的菲涅尔值"}]},{"ID":"20240730142034-ut6lvtl","Type":"NodeParagraph","Properties":{"id":"20240730142034-ut6lvtl","updated":"20240730142034"},"Children":[{"Type":"NodeText","Data":"一个常用的参数化是将镜面颜色（specular color）$F_0$和漫反射颜色（diffuse color）$\\rho_{ss}$结合在一起（漫反射颜色将在章节9.9中进一步讨论）。这种参数化利用了以下的观察结果：金属材质没有漫反射颜色，而电介质可能存在的$F_0$值是一个有限集合。这种参数化表示包含一个$RGB$表面颜色$\\mathbf{c}"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"em","TextMarkTextContent":"{surf}$和一个标量参数$m$，这个参数被称为“metallic”或者“metalness”，即金属度。如果$m=1$，则说明该材质是金属，则将$\\mathbf{c}"},{"Type":"NodeText","Data":"{surf}$设置为$F_0$，$\\rho_{ss}$设置为黑色；如果$m=0$，则说明该材质是非金属，则将介电值（常数，或者由其他附加参数进行控制）设置为$F_0$，$\\mathbf{c}"},{"Type":"NodeTextMark","Properties":{"id":""},"TextMarkType":"em","TextMarkTextContent":"{surf}$设置为$\\rho"},{"Type":"NodeText","Data":"{ss}$。"}]},{"ID":"20240730142035-acu0loe","Type":"NodeParagraph","Properties":{"id":"20240730142035-acu0loe","updated":"20240730142035"},"Children":[{"Type":"NodeText","Data":"这个“金属度”参数最初是作为布朗大学（Brown University）"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"1713]使用的早期着色模型中的一部分出现的；而目前形式的参数化，则首次被皮克斯（Pixar）用于电影《机器人总动员（Wall-E）》"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"1669]。对于迪士尼动画电影《无敌破坏王（Wreck-It Ralph）》系列中使用的迪士尼原则着色模型，Burley添加了一个额外的标量“镜面（specular）”参数，来将电介质的$F_0$值控制在一个有限的范围内"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"214]。虚幻引擎"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"861]同样使用了这种形式的参数化，而寒霜引擎所使用的形式则有一些不同，它允许电介质使用较大范围的$F_0$值"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"960]。游戏《使命召唤：无限战争》则使用了一种变体，它将这些金属度参数和镜面参数打包成一个单一的值"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"384]，从而节省了内存空间。"}]},{"ID":"20240730142036-yjmi2ox","Type":"NodeParagraph","Properties":{"id":"20240730142036-yjmi2ox","updated":"20240730142036"},"Children":[{"Type":"NodeText","Data":"对于那些使用这种金属度参数化，而不是直接使用$F_0$和$\\rho_{ss}$的渲染程序，其动机包括方便用户使用，节省纹理存储空间或者G-buffer存储空间等。在游戏《使命召唤：无限战争》中，这种参数化以一种独特的方式进行使用。艺术家为$F_0$和$\\rho_{ss}$绘制纹理，程序会自动执行一种压缩方法，将其转换为金属度参数化形式。"}]},{"ID":"20240730142037-atb8h6n","Type":"NodeParagraph","Properties":{"id":"20240730142037-atb8h6n","updated":"20240730142037"},"Children":[{"Type":"NodeText","Data":"使用这种金属度参数化有一些缺点，即它无法表示某些特殊类型的材质，例如一个具有彩色$F_0$值的金属，其表面涂有一层电介质，在金属和电介质之间的边界上，可能会出现瑕疵"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"960, 1163]。"}]},{"ID":"20240730142038-wcjjidk","Type":"NodeParagraph","Properties":{"id":"20240730142038-wcjjidk","updated":"20240730142038"},"Children":[{"Type":"NodeText","Data":"一些实时应用程序使用了另一种参数化技巧，它基于这样的一个事实：除了特殊的抗反射涂层（anti-reflective coating）之外，没有任何材料的$F_0$值低于0.02。这个技巧可以用来抑制表面上某些代表空腔或者空洞的镜面高光。$F_0$低于0.02的值被用来“关闭”菲涅尔的边缘增亮效果，而不是使用单独的镜面遮挡纹理进行控制。这种技术最初是由Schuler "},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"1586]提出的，它现在被应用于虚幻引擎"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"861]和寒霜引擎"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"960]中。"}]},{"ID":"20240730142039-rdx3mmp","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20240730142039-rdx3mmp","updated":"20240730142039"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"### ","Properties":{"id":""}},{"Type":"NodeText","Data":"9.5.3 内反射"}]},{"ID":"20240730142040-3110fe0","Type":"NodeParagraph","Properties":{"id":"20240730142040-3110fe0","updated":"20240730142040"},"Children":[{"Type":"NodeText","Data":"虽然外反射在渲染中更加常见，但是内反射有时候也会很重要。当$n_1 \u003e n_2$的时候，就会发生内反射，也就是说，当光线在透明物体的内部传播，并“从内部”打到物体表面上时，就会发生内反射，如图9.23所示。"}]},{"ID":"20240730142041-y0u3am5","Type":"NodeParagraph","Properties":{"id":"20240730142041-y0u3am5","updated":"20240730142041"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.23：平面上的内反射，其中 n","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"_","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"1 \u003e n","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"_","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"2","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611105451-20240730142820-qbzbxcv.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.23：平面上的内反射，其中 n_1 \u003e n_2","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730142042-wklgg2m","Type":"NodeParagraph","Properties":{"id":"20240730142042-wklgg2m","updated":"20240730142042"},"Children":[{"Type":"NodeText","Data":"Snell定律表明，对于内反射，有$\\sin \\theta_{t}\u003e\\sin \\theta_{i}$；由于$\\theta_{t},\\theta_{i}$都在$0^{\\circ}$-$90^{\\circ}$之间，因此也意味着$\\theta_{t}\u003e\\theta_{i}$，如图9.23所示。而在外反射的情况下，角度大小的情况正好相反（可以与图9.9进行比较），二者之间的不同之处是理解内反射和外反射差异的关键所在。在外反射中，对于0-1之间的任意一个$\\sin \\theta_{i}$，都存在一个有效的（较小的）$\\sin \\theta_{t}$值。但是内反射则不是这样的，在内反射中存在一个临界角$\\theta_{c}$，对于大于这个临界角的入射角$\\theta_{i}$，根据Snell定律我们能推导出表明$\\sin \\theta_{t}\u003e1$，即$\\theta_{t}\u003e 90^{\\circ}$，这是不可能发生的。在这种情况下，$\\theta_{t}$实际上是不存在的，即当$\\theta_{i}\u003e\\theta_{c}$的时候，不会发生光线透射，入射光将会被全部反射。这种现象被称为全内反射（total internal reflection）。"}]},{"ID":"20240730142043-2qxc52x","Type":"NodeParagraph","Properties":{"id":"20240730142043-2qxc52x","updated":"20240730142043"},"Children":[{"Type":"NodeText","Data":"菲涅尔方程是对称的，也就是说入射向量和透射向量是可以相互交换的，并且反射率保持不变。结合Snell定律，这种对称性意味着，内反射的$F\\left(\\theta_{i}\\right)$曲线将类似于外反射曲线的“压缩”版本。即内外反射的$F_0$的值是相同的，但是内反射曲线会在临界角$\\theta_{c}$处就提前达到完美反射，而外反射曲线则会在$90^{\\circ}$处才达到完美反射，如图9.24所示。从曲线中我们还可以看出，内反射的平均反射率更高，这就是为什么在水下看到的气泡，会具有高度反射的银色外观的原因。"}]},{"ID":"20240730142044-5esnuba","Type":"NodeParagraph","Properties":{"id":"20240730142044-5esnuba","updated":"20240730142044"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.24：玻璃-空气界面内外反射率曲线的比较。在临界角 \\theta","Properties":{"id":""}},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"_","Properties":{"id":""}}]},{"Type":"NodeLinkText","Data":"{c} 处，内反射率曲线趋于1.0。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611105507-20240730142820-yzslg5r.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.24：玻璃-空气界面内外反射率曲线的比较。在临界角 \\theta_{c} 处，内反射率曲线趋于1.0。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730142045-8kyd33w","Type":"NodeParagraph","Properties":{"id":"20240730142045-8kyd33w","updated":"20240730142045"},"Children":[{"Type":"NodeText","Data":"内反射只会发生在电介质中，因为金属和半导体会迅速吸收在其内部传播的任何光线"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"285, 286]。由于电介质的折射率都在实数范围内，因此通过折射率或者$F_0$来计算内反射临界角是很简单的："}]},{"ID":"20240730142046-1s6d62i","Type":"NodeMathBlock","Properties":{"id":"20240730142046-1s6d62i","updated":"20240730142046"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"\\sin \\theta_{c}=\\frac{n_{2}}{n_{1}}=\\frac{1-\\sqrt{F_{0}}}{1+\\sqrt{F_{0}}}\n\\tag{9.20}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730142047-ayve0id","Type":"NodeParagraph","Properties":{"id":"20240730142047-ayve0id","updated":"20240730142047"},"Children":[{"Type":"NodeText","Data":"方程9.16展示的Schlick近似，对于外反射而言是正确的，通过使用透射角$\\theta_{t}$来代替入射角$\\theta_{i}$，它也可以用于内反射中。如果此时已经有了透射方向$\\mathbf{t}$（例如：用于渲染折射，详见章节14.5.2），那么可以用它来计算透射角$\\theta_{t}$。或者可以使用Snell定律，利用入射角$\\theta_{i}$来计算透射角$\\theta_{t}$，但是这个计算成本会很高，并且需要两侧物质的折射率参数，而折射率可能是无法获得的。"}]},{"ID":"20240730142048-s2tplcl","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240730142048-s2tplcl","updated":"20240730142048"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"9.6 微观几何（Microgeometry）"}]},{"ID":"20240730142049-198rd5n","Type":"NodeParagraph","Properties":{"id":"20240730142049-198rd5n","updated":"20240730142049"},"Children":[{"Type":"NodeText","Data":"我们在章节9.1.3中讨论过，比单个像素小得多的不规则表面无法被显式建模，因此BRDF会转而对它们的总体效应进行统计建模。目前，我们的讨论仍然停留在几何光学领域，它假设这些不规则表面要么小于光的波长（即对光的行为没有影响），要么比光的波长大得多。而有关“波动光学”领域中的不规则表面（大约1-100波长大小）的影响，将在章节9.11中进行讨论。"}]},{"ID":"20240730142050-gc33j9v","Type":"NodeParagraph","Properties":{"id":"20240730142050-gc33j9v","updated":"20240730142050"},"Children":[{"Type":"NodeText","Data":"每个可见的表面点上都包含了许多微表面法线（microsurface normal），这些法线将入射光向着不同方向进行反射。由于单个微表面的朝向在某种程度上来说是随机的，因此将它们建模为某种统计分布是十分有道理的。对于大多数表面而言，其微观几何的表面法线是一个连续分布，而在宏观的表面法线处则存在一个很强的峰值。这种分布的“紧密程度”是由表面粗糙度所决定的。表面越粗糙，微观几何表面的法线分布就会越“分散”。"}]},{"ID":"20240730142051-msehmqb","Type":"NodeParagraph","Properties":{"id":"20240730142051-msehmqb","updated":"20240730142051"},"Children":[{"Type":"NodeText","Data":"增加微观尺度的粗糙度，其宏观的视觉效果就是反射的环境细节会变得更加模糊。在一个小且明亮的光源下，这种模糊会导致范围更宽、颜色更暗的高光。而那些来自粗糙表面的反射光线则会更暗，因为光线会被发散到了一个更宽的锥形方向上。这一现象可以在图9.12中看到。"}]},{"ID":"20240730142052-ai066if","Type":"NodeParagraph","Properties":{"id":"20240730142052-ai066if","updated":"20240730142052"},"Children":[{"Type":"NodeText","Data":"图9.25展示了单个微观尺度表面细节的聚合反射，是如何产生宏观可见反射的。这一组图像展示了一个由单一光源照亮的曲面，每个曲面上的凸起大小逐渐减小，直到最后一张图像中的表面凸起比单个像素还要小得多。许多个微小高光以一种统计模式，最终聚合成了宏观的高光。例如：外围单个高光的相对稀疏程度在聚合之后，就变成了远离高光中心点的相对暗度。"}]},{"ID":"20240730142053-tia0r3r","Type":"NodeParagraph","Properties":{"id":"20240730142053-tia0r3r","updated":"20240730142053"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.25：从可见的宏观表面细节逐渐过渡到微观尺度。图像序列按照从上到下，从左到右排布。每个图像中的表面形状和光源都是固定的，只有表面细节的尺度发生了变化。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611105530-20240730142820-uc3trvj.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.25：从可见的宏观表面细节逐渐过渡到微观尺度。图像序列按照从上到下，从左到右排布。每个图像中的表面形状和光源都是固定的，只有表面细节的尺度发生了变化。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730142054-dhg2v29","Type":"NodeParagraph","Properties":{"id":"20240730142054-dhg2v29","updated":"20240730142054"},"Children":[{"Type":"NodeText","Data":"对于大多数表面而言，微尺度表面法线的分布是各向同性的，这意味着它是旋转对称的，不具备任何固有的方向属性。而有一些表面则具有各向异性（anisotropic）的微观结构，这样的表面具有各向异性的表面法线分布，这会导致反射和高光的定向模糊，如图9.26所示。"}]},{"ID":"20240730142055-ev4ypv0","Type":"NodeParagraph","Properties":{"id":"20240730142055-ev4ypv0","updated":"20240730142055"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.26：左边是一个各向异性的表面（拉丝金属），请注意反射的定向模糊。右图是一个相似表面的显微照片，请注意表面细节的方向性。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611105543-20240730142820-vhgis7l.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.26：左边是一个各向异性的表面（拉丝金属），请注意反射的定向模糊。右图是一个相似表面的显微照片，请注意表面细节的方向性。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730142056-nfvqujh","Type":"NodeParagraph","Properties":{"id":"20240730142056-nfvqujh","updated":"20240730142056"},"Children":[{"Type":"NodeText","Data":"有一些表面具有高度结构化的微观几何形状，这产生了各种微观尺度的法线分布和表面外观。纤维织物就是一个常见的例子——天鹅绒和绸缎的独特外观，就是由它们的微观几何结构所决定的"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"78]。有关纤维织物的模型，将在章节9.10中进行讨论。"}]},{"ID":"20240730142057-ea05dyz","Type":"NodeParagraph","Properties":{"id":"20240730142057-ea05dyz","updated":"20240730142057"},"Children":[{"Type":"NodeText","Data":"虽然多重表面法线是微观几何对反射率的主要影响因素，但是其他影响因素有时候也很重要。其中遮蔽（shadowing）是指部分微尺度表面细节对光源的遮挡，使得光线无法照射到另一部分表面上，如图9.27左侧所示。而遮挡（masking）是指微尺度表面细节对相机的遮挡，使得相机无法看见一些表面，如图9.27中间所示。（译者注：后文中就不翻译shadowing和masking了，容易混淆）"}]},{"ID":"20240730142058-rcp57ix","Type":"NodeParagraph","Properties":{"id":"20240730142058-rcp57ix","updated":"20240730142058"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.27：微观结构的几何效应。左侧：黑色虚线箭头代表了被其他微观几何遮蔽（遮挡了光线）的区域。中间：红色虚线箭头表示被其他微观几何遮挡（遮挡相机视线）的区域。右侧：展示了光线在微尺度结构之间的相互反射。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611105603-20240730142820-trxxnzc.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.27：微观结构的几何效应。左侧：黑色虚线箭头代表了被其他微观几何遮蔽（遮挡了光线）的区域。中间：红色虚线箭头表示被其他微观几何遮挡（遮挡相机视线）的区域。右侧：展示了光线在微尺度结构之间的相互反射。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730142059-4jvatsv","Type":"NodeParagraph","Properties":{"id":"20240730142059-4jvatsv","updated":"20240730142059"},"Children":[{"Type":"NodeText","Data":"如果微观几何的高度与表面法线之间存在相关性的话，那么shadowing和masking就能够有效地改变表面的法线分布。例如：想象这样的一个表面，该表面上凸起的部分因为风化或者其他过程而变得十分光滑，而凹陷的部分仍然十分粗糙。在掠射视角下，表面的凹陷部分往往会被shadowing或者masking，从而生成一个十分光滑的表面。如图9.28所示。"}]},{"ID":"20240730142060-njwoztk","Type":"NodeParagraph","Properties":{"id":"20240730142060-njwoztk","updated":"20240730142060"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.28：图示的微观几何在高度和表面法线之间具有很强的相关性，其中凸起的区域是光滑的，而凹陷的区域是粗糙的。在上面的图像中，光线以接近宏观表面法线的角度照射到表面上。在这个入射角度上，许多入射光线都可以到达粗糙的凹坑，这些光线会在不同的方向上散射。而在下面的图像中，光线以一个掠射角度照射到表面上。Shadowing遮蔽了大部分凹坑，因此只有很少的光线能够照射到它们，大多数光线都被表面的光滑部分反射回来。在这种情况下，表面粗糙度很大程度上取决于光线的入射角度。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611105618-20240730142820-h0f6ely.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.28：图示的微观几何在高度和表面法线之间具有很强的相关性，其中凸起的区域是光滑的，而凹陷的区域是粗糙的。在上面的图像中，光线以接近宏观表面法线的角度照射到表面上。在这个入射角度上，许多入射光线都可以到达粗糙的凹坑，这些光线会在不同的方向上散射。而在下面的图像中，光线以一个掠射角度照射到表面上。Shadowing遮蔽了大部分凹坑，因此只有很少的光线能够照射到它们，大多数光线都被表面的光滑部分反射回来。在这种情况下，表面粗糙度很大程度上取决于光线的入射角度。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730142353-tj6kip7","Type":"NodeParagraph","Properties":{"id":"20240730142353-tj6kip7","updated":"20240730142353"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.49：左侧：圆柱体使用原始的法线贴图进行渲染。中间：使用了一个分辨率低得多的法线贴图进行渲染，这个法线贴图中包含了平均化和重新归一化的法线，如 图9.50 左下角所示。右侧：圆柱体以相同的低分辨率法线贴图进行渲染，但同时使用了法线和光泽度值合适的理想NDF，如 图9.50 右下角所示。右图明显更好地再现了原貌，而且这个表面在低分辨率下渲染时也不容易出现瑕疵。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611110406-20240730142820-tz1581k.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.49：左侧：圆柱体使用原始的法线贴图进行渲染。中间：使用了一个分辨率低得多的法线贴图进行渲染，这个法线贴图中包含了平均化和重新归一化的法线，如 图9.50 左下角所示。右侧：圆柱体以相同的低分辨率法线贴图进行渲染，但同时使用了法线和光泽度值合适的理想NDF，如 图9.50 右下角所示。右图明显更好地再现了原貌，而且这个表面在低分辨率下渲染时也不容易出现瑕疵。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730142354-6ewkehc","Type":"NodeParagraph","Properties":{"id":"20240730142354-6ewkehc","updated":"20240730142354"},"Children":[{"Type":"NodeText","Data":"根据图9.49所给定的观察尺度，将圆柱体建模为光滑网格（宏观尺度），并使用法线贴图（细观尺度）来表示凸起是较为合适的，同时使用了具有固定粗糙度$\\alpha_b$的Beckmann NDF来模拟微观尺度上的法线分布。这种组合表示方法在这个尺度上对圆柱体的外观进行了很好地模拟。但是，当观察尺度发生改变时会发生什么呢?"}]},{"ID":"20240730142355-houlfml","Type":"NodeParagraph","Properties":{"id":"20240730142355-houlfml","updated":"20240730142355"},"Children":[{"Type":"NodeText","Data":"如图9.50所示，第一行展示了表面的其中一小部分，这部分表面被四个法线贴图的纹素所覆盖。假设我们按照这样的一个比例来渲染表面，使得法线贴图中的每个纹素刚好被一个画面像素所覆盖。对于法线贴图中的每个纹素而言，图中的红色箭头代表了法线（法线分布的平均值），它被Beckmann NDF（黑色箭头）所包围。法线和NDF隐式表达了表面的微观几何结构，如图9.50第一行表面的横截面所示。中间的主要突起代表了法线贴图所定义的凸起，而周围的小摆动则代表了微观尺度的表面结构。法线贴图中的每个纹素，结合对应的粗糙度，可以被看作是，在这个纹素所覆盖的表面上收集到的法线分布。"}]},{"ID":"20240730142356-2nsycrj","Type":"NodeParagraph","Properties":{"id":"20240730142356-2nsycrj","updated":"20240730142356"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.50：展示了 图9.49 中的部分表面。第一行显示了法线分布（其中的红色箭头代表了平均法线）和隐含的微观几何结构。第二行展示了将上述四个NDF平均为一个NDF的三种mipmap方法。其中左边的是 ground truth（将法线分布进行平均）；中间是对均值（法线）和方差（粗糙度）进行分别平均后的结果；右边使用了一个平均NDF来对NDF进行拟合。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611110422-20240730142820-fg7k08h.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.50：展示了 图9.49 中的部分表面。第一行显示了法线分布（其中的红色箭头代表了平均法线）和隐含的微观几何结构。第二行展示了将上述四个NDF平均为一个NDF的三种mipmap方法。其中左边的是 ground truth（将法线分布进行平均）；中间是对均值（法线）和方差（粗糙度）进行分别平均后的结果；右边使用了一个平均NDF来对NDF进行拟合。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730142357-ia15ps6","Type":"NodeParagraph","Properties":{"id":"20240730142357-ia15ps6","updated":"20240730142357"},"Children":[{"Type":"NodeText","Data":"现在我们假设相机到物体的距离变远了，此时屏幕上的一个像素只能覆盖四个法线贴图的纹素。在这个分辨率下，一个理想的表面表达方式应当是：能够准确表示该区域内所有法线的分布。这个分布可以通过计算上层mipmap中的，四个对应纹素的NDF的平均值来获得。图9.50左下角展示了这种理想的法线分布。这个平均后的法线结果如果用于渲染的话，可以最准确地代表在较低分辨率下的表面外观。"}]},{"ID":"20240730142358-ii264t4","Type":"NodeParagraph","Properties":{"id":"20240730142358-ii264t4","updated":"20240730142358"},"Children":[{"Type":"NodeText","Data":"图9.50底部中间的图展示了分别对法线（法线分布的平均值）和粗糙度（对应了法线分布的扩散角度）进行平均的结果。最终的结果具有正确的平均法线分布（红色箭头），但是法线分布太窄了，这个误差会使得表面看起来过于光滑。更加严重的是，由于NDF太窄，因此将很容易造成瑕疵（闪烁高光）。"}]},{"ID":"20240730142359-qrw41se","Type":"NodeParagraph","Properties":{"id":"20240730142359-qrw41se","updated":"20240730142359"},"Children":[{"Type":"NodeText","Data":"我们无法直接使用Beckmann NDF来表示理想的法线分布。但是如果我们额外使用一个粗糙度图的话，那么Beckmann粗糙度$\\alpha_a$就可以在不同的纹素之间发生变化。想象一下，对于每个理想的NDF，我们都要找到与其最匹配的定向Beckmann波瓣，无论是在方向上还是总体扩散角度上。我们将Beckmann波瓣的中心方向（即法线分布的平均值）存储在法线贴图中，将粗糙度值存储在粗糙度贴图中。最终结果如图9.50右下角所示，这个NDF更加接近理想中的情况。与简单的平均方法（图9.50底部中间的图）相比，使用这种方法可以更加真实地表示圆柱体的外观，如图9.49所示。"}]},{"ID":"20240730142360-m6mkh73","Type":"NodeParagraph","Properties":{"id":"20240730142360-m6mkh73","updated":"20240730142360"},"Children":[{"Type":"NodeText","Data":"为了获得最佳的效果，应当对法线分布应用过滤操作（例如mipmap），而不是对法线或者粗糙度值单独应用过滤操作，这样做意味着，需要使用一种稍微不同的方式来思考NDF和法线之间的关系。通常来说，NDF定义在由法线贴图的逐像素法线所确定的局部切线空间中，然而，在过滤不同法线的NDF时，可以将法线贴图和粗糙度贴图的组合，看作是定义在底层几何表面的切线空间中的倾斜NDF，这样来进行思考是十分有帮助的。"}]},{"ID":"20240730142361-hj96wp7","Type":"NodeParagraph","Properties":{"id":"20240730142361-hj96wp7","updated":"20240730142361"},"Children":[{"Type":"NodeText","Data":"早期解决NDF过滤问题的尝试"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"91, 284, 658]是通过使用数值优化方法，来将一个或者多个NDF波瓣拟合到平均分布中。这种方法存在健壮性和速度上的问题，目前已经使用得不多了。相反，目前所使用的大部分技术，都是通过计算法线分布的方差来实现的。Toksvig "},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"1774]观察到了这样一个事实：如果对法线进行平均化的而不是重新归一化的话，那么法线的平均长度与法线分布的宽度成反比。也就是说，原始法线分布的扩散角度越大，平均后得到的法线就越短。据此，他提出了一种基于法线长度来修改NDF粗糙度参数的方法，并使用修正后的粗糙度参数来重新计算BRDF，从而对过滤后的法线扩散效果进行近似。"}]},{"ID":"20240730142362-q5f690p","Type":"NodeParagraph","Properties":{"id":"20240730142362-q5f690p","updated":"20240730142362"},"Children":[{"Type":"NodeText","Data":"Toksvig的原始方程是用于Blinn-Phong NDF的，其数学形式如下："}]},{"ID":"20240730142363-39axwpl","Type":"NodeMathBlock","Properties":{"id":"20240730142363-39axwpl","updated":"20240730142363"},"Children":[{"Type":"NodeMathBlockOpenMarker","Properties":{"id":""}},{"Type":"NodeMathBlockContent","Data":"\\alpha_{p}^{\\prime}=\\frac{\\|\\overline{\\mathbf{n}}\\| \\alpha_{p}}{\\|\\overline{\\mathbf{n}}\\|+\\alpha_{p}(1-\\|\\overline{\\mathbf{n}}\\|)}\n\\tag{9.76}","Properties":{"id":""}},{"Type":"NodeMathBlockCloseMarker","Properties":{"id":""}}]},{"ID":"20240730142364-jj6ak8q","Type":"NodeParagraph","Properties":{"id":"20240730142364-jj6ak8q","updated":"20240730142364"},"Children":[{"Type":"NodeText","Data":"其中$\\alpha_{p}$是原始的粗糙度值，$\\alpha_{p}^{\\prime}$是修正后的粗糙度值；$"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"|","Properties":{"id":""}}]},{"Type":"NodeText","Data":"\\overline{\\mathbf{n}}"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"|","Properties":{"id":""}}]},{"Type":"NodeText","Data":"$是平均法线的长度。这个方程也可以使用等效替换$\\alpha_{p}=2 \\alpha_{b}^{-2}-2$（来自Walter等人"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"1833]）来得到Beckmann NDF，因为这两个NDF的形状十分类似。使用GGX分布的方法就不太直接了，因为GGX和Blinn-Phong（以及Beckmann）之间并没有明确的等价关系。一种方法是强行让$\\alpha_g$和$\\alpha_b$相等，这样做的结果是，虽然高光中心的值是相同的，但是高光的外观却大不相同。更加麻烦的是，GGX分布中并没有定义法线分布的方差，因此在与GGX分布一起使用的时候，这种基于方差的技术并没有扎实的理论基础。尽管有这些理论上的困难，但是在GGX分布中使用方程9.76的情况是相当普遍的，通常是令$\\alpha_{p}=2 \\alpha_{g}^{-2}-2$，这样做在实践中还是相当有效的。"}]},{"ID":"20240730142365-k38m12w","Type":"NodeParagraph","Properties":{"id":"20240730142365-k38m12w","updated":"20240730142365"},"Children":[{"Type":"NodeText","Data":"Toksvig方法的优点是在GPU纹理过滤中引入了法线方差，它也适用于最简单的法线mipmap方案（即对法线进行不归一化的线性平均）。这个特性对于那些动态生成的法线贴图（例如水面波纹）而言特别有用，因为对于这些法线贴图而言，它们的mipmap必须在运行过程中生成。但是这个方法对于静态的法线贴图而言并不是很好，因为它无法与常见的法线贴图压缩算法一起使用，原因在于这些压缩算法都要求法线是单位长度的。而Toksvig的方法依赖于平均法线的长度，这个长度是会发生变化的，因此使用这种方法的法线贴图必须要保持未压缩状态。但是即使这样，存储变短的法线也会导致精度问题。"}]},{"ID":"20240730142366-veekd1v","Type":"NodeParagraph","Properties":{"id":"20240730142366-veekd1v","updated":"20240730142366"},"Children":[{"Type":"NodeText","Data":"Olano与Baker的LEAN映射技术"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"1320]基于的是法线分布协方差矩阵的映射，与Toksvig的方法一样，它可以很好地兼容GPU纹理过滤和线性mipmap，同时它还支持各向异性的法线分布。与Toksvig的方法类似，LEAN映射技术可以很好地处理动态生成的法线，但是为了避免精度不足的问题，因此在处理静态法线的时候需要大量的存储空间。Hery等人"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"731, 732]独立提出了一种类似的技术，并在皮克斯动画电影中被用于渲染亚像素级别的细节，例如金属薄片（metal flakes）和小划痕等。CLEAN映射"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"93]是LEAN映射的一个简化变体，它不支持各向异性的法线，但好处是降低了存储空间。LEADR映射"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"395, 396]对LEAN映射进行了扩展，同时也考虑了位移映射（displacement mapping）的可见性影响。"}]},{"ID":"20240730142367-5aq30q4","Type":"NodeParagraph","Properties":{"id":"20240730142367-5aq30q4","updated":"20240730142367"},"Children":[{"Type":"NodeText","Data":"实时图形应用中所使用的大多数法线贴图都是静态的，并不是动态生成的，对于这种贴图而言，通常会使用方差映射技术。这些技术会在生成法线贴图mipmap的时候，会计算法线平均化所带来的方差损失。Hill指出"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"739]，Toksvig技术、LEAN映射和CLEAN映射等技术，都可以使用这种方法来预先计算方差，从而消除这些技术在原始形式下的许多缺点。在某些情况下，预计算出来的方差值会单独存储在方差纹理以及它的mipmap中。通常，这些值会用于修改现有粗糙度贴图的mipmap。例如：游戏《使命召唤：黑色行动》"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"998]中的方差映射技术便采用了这种方法。修正后的粗糙度值是通过将原始粗糙度值转换为方差，并加入法线贴图的方差，最终转换回粗糙度计算而来的。在游戏《教团：1886》中，Neubelt和Pettineo "},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"1266, 1267]以一种类似方法使用了Han "},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"658]提出的技术，他们将法线贴图中存储的NDF与BRDF镜面项的NDF进行卷积，并将结果转换为粗糙度，最终将其存储在粗糙度贴图中。"}]},{"ID":"20240730142368-b5at88z","Type":"NodeParagraph","Properties":{"id":"20240730142368-b5at88z","updated":"20240730142368"},"Children":[{"Type":"NodeText","Data":"还可以通过使用一些额外的存储空间来进一步改善结果，即在纹理空间的$xy$方向上分别计算方差，并将其存储在一个各向异性的粗糙度贴图中"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"384, 740, 1823]。这项技术本身局限于轴向的各向异性，这在一些人造表面中是很常见的，但是在自然形成表面中就不太常见了。还可以通过再多存储一个值，从而支持定向的各向异性（oriented anisotropy）"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"740]。"}]},{"ID":"20240730142369-i65bwpc","Type":"NodeParagraph","Properties":{"id":"20240730142369-i65bwpc","updated":"20240730142369"},"Children":[{"Type":"NodeText","Data":"与原始形式的Toksvig、LEAN映射和CLEAN映射不同，方差映射技术并没有考虑由于GPU纹理过滤所引入的方差。为了弥补这一点，在方差映射的实现中通常会使用一个较小的滤波器"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"740, 998]，对法线贴图的顶级mip进行卷积。当组合多个法线贴图的时候（例如细节法线贴图）"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"106]，需要注意对法线贴图的方差进行正确组合"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"740, 960]。"}]},{"ID":"20240730142370-pxu3q9s","Type":"NodeParagraph","Properties":{"id":"20240730142370-pxu3q9s","updated":"20240730142370"},"Children":[{"Type":"NodeText","Data":"模型的高曲率几何结构（高频信息）或者法线贴图会引入法线方差，前面我们所讨论的这些技术并不能缓解这种由方差所带来的的画面瑕疵，但是也有一些方法可以解决这些问题。如果在几何体上存在着唯一的纹理映射的话（通常是角色模型，较少与环境有关），那么模型的几何曲率可以被“烘焙”到粗糙度贴图中"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"740]。曲率还可以使用像素着色器中的导数指令来实时计算得出"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"740, 857, 1229, 1589, 1775, 1823]。如果可以使用法线缓冲的话，那么这种计算可以在几何体的渲染阶段中进行，或者是在处理后阶段中进行。"}]},{"ID":"20240730142371-z009e90","Type":"NodeParagraph","Properties":{"id":"20240730142371-z009e90","updated":"20240730142371"},"Children":[{"Type":"NodeText","Data":"到目前为止，我们所讨论的方法主要集中在镜面反射上，但是法线方差同样也会影响到漫反射的着色。考虑法线方差对$\\mathbf{n} \\cdot \\mathbf{l}$项的影响，可以帮助提高漫反射着色和镜面反射着色结果的准确性，因为二者在反射率积分中都会乘上这一项"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"740]。"}]},{"ID":"20240730142372-vtrvwbw","Type":"NodeParagraph","Properties":{"id":"20240730142372-vtrvwbw","updated":"20240730142372"},"Children":[{"Type":"NodeText","Data":"方差映射技术将法线分布近似为光滑的高斯波瓣，如果每个像素中包含数十万个凸起的话，那么这种近似是合理的，因为它们可以被很平滑的平均。但是在大部分情况下，一个像素只能覆盖几百个或者几千个凸起，这会导致表面具有“闪闪发光（sparkly）”的材质外观，我们可以在图9.25中看到这样的例子，它包含了一系列图像，不同图像中球体上的凸起会逐渐减小。其中右下角图像中球体的凸起非常小，它们被平均后形成了十分平滑的高光；但是对于左下角和底部中心的图像而言，虽然球体的凸起小于一个像素，但是还不足以被很平滑地平均，不足以产生平滑的高光。如果这些小球动起来的话，那么充满噪声的高光会表现为一帧一帧的不断闪烁。"}]},{"ID":"20240730142373-h9mp4ol","Type":"NodeParagraph","Properties":{"id":"20240730142373-h9mp4ol","updated":"20240730142373"},"Children":[{"Type":"NodeText","Data":"如果我们将这样一个曲面的NDF渲染出来的话，那么它看起来会像图9.51左侧那样。当球体运动起来的时候，半向量$\\mathbf{h}$会在NDF上不断移动，穿过明亮和黑暗的区域，从而导致“闪闪发光”的外观。如果我们在这样的表面上使用方差映射技术，那么它会用一个类似于图9.51右侧的平滑NDF，来对左侧的NDF进行近似，从而失去闪烁细节。"}]},{"ID":"20240730142374-f2ho2r6","Type":"NodeParagraph","Properties":{"id":"20240730142374-f2ho2r6","updated":"20240730142374"},"Children":[{"Type":"NodeImage","Properties":{"id":""},"Children":[{"Type":"NodeBang","Data":"!","Properties":{"id":""}},{"Type":"NodeOpenBracket","Data":"[","Properties":{"id":""}},{"Type":"NodeLinkText","Data":"图9.51：左侧是随机凹凸表面上的一小块区域（包含几十个凸起）的NDF，右边则是一个大致具有相同宽度的Beckmann NDF波瓣。","Properties":{"id":""}},{"Type":"NodeCloseBracket","Data":"]","Properties":{"id":""}},{"Type":"NodeOpenParen","Data":"(","Properties":{"id":""}},{"Type":"NodeLinkDest","Data":"assets/20230611110442-20240730142820-oha42xx.png","Properties":{"id":""}},{"Type":"NodeLinkSpace","Data":" ","Properties":{"id":""}},{"Type":"NodeLinkTitle","Data":"图9.51：左侧是随机凹凸表面上的一小块区域（包含几十个凸起）的NDF，右边则是一个大致具有相同宽度的Beckmann NDF波瓣。","Properties":{"id":""}},{"Type":"NodeCloseParen","Data":")","Properties":{"id":""}}]}]},{"ID":"20240730142375-wn5ly12","Type":"NodeParagraph","Properties":{"id":"20240730142375-wn5ly12","updated":"20240730142375"},"Children":[{"Type":"NodeText","Data":"在电影行业中，这个问题通常会使用大幅的超采样来解决，但是这在实时渲染应用中是不可行的，甚至在离线渲染中也是不可取的。但是已经出现了一些用于解决这个问题的技术，其中有一些并不适合实时渲染使用，但是却为未来可能出现的技术提供了研究方向"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"84, 810, 1941, 1942]。在这些方法中，有两种实现是用于实时渲染的。Wang和Bowles "},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"187, 1837]提出了一种技术，用于在游戏《迪士尼无限3.0（Disney Infinity 3.0）》中渲染闪闪发光的雪花。这个技术的目的是产生一种看似闪亮的外观，而不是真的去模拟特定的NDF，它适用于具有稀疏闪光的材质，例如雪花等。Zirr和Kaplanyan "},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"1974]的技术模拟了多个尺度上的法线分布，它可以用于更加广泛的材质外观，并且在空间上和时间上都是稳定的，"}]},{"ID":"20240730142376-vvuc9kz","Type":"NodeParagraph","Properties":{"id":"20240730142376-vvuc9kz","updated":"20240730142376"},"Children":[{"Type":"NodeText","Data":"在本小节中，我们没有足够的篇幅来囊括所有有关材质过滤的文献，因此在这里我们将着重提及一些值得注意的参考文献。Bruneton等人"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"204]提出了一种用于渲染海洋表面的技术，它支持环境光照，其中方差处理的尺度可以从几何到BRDF。Schilling "},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"1565]讨论了一种类似于方差映射的技术，该技术支持环境贴图的各向异性着色。Bruneton和Neyret "},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"205]则对该领域的早期工作进行了全面概述。"}]},{"ID":"20240730142377-iwcj42p","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240730142377-iwcj42p","updated":"20240730142377"},"Children":[{"Type":"NodeHeadingC8hMarker","Data":"## ","Properties":{"id":""}},{"Type":"NodeText","Data":"补充阅读和资源"}]},{"ID":"20240730142378-y1d35k0","Type":"NodeParagraph","Properties":{"id":"20240730142378-y1d35k0","updated":"20240730142378"},"Children":[{"Type":"NodeText","Data":"McGuire的《Graphics Codex》"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"1188]和Glassner的《数字图像合成原理》"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"543, 544]对于本章节中所涉及的许多主题而言，都是一个非常好的参考资料。虽然Dutre的《Global Illumination Compendium》"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"399]中的一些部分有点过时（尤其是BRDF模型部分），但是它是渲染数学非常好的参考资料（例如球形积分和半球积分）。其中Glassner和Dutre的参考资料都可以在网上免费获取。"}]},{"ID":"20240730142379-l0ldmiq","Type":"NodeParagraph","Properties":{"id":"20240730142379-l0ldmiq","updated":"20240730142379"},"Children":[{"Type":"NodeText","Data":"对于想要更多了解光和物质相互作用的读者，我们非常推荐Feynman的讲座"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"469]（可以在网上找到），其中的内容对于对于我们在撰写这一章的物理部分而言十分宝贵。另一个十分有用的参考资料是Fowles的《Introduction to Modern Optics》"},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"492]，这是一个是简短易懂的入门文章。Born和Wolf "},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"177]的《Principles of Optics》是一本更“重”（字面意思上也是）书，它包含了对光学的深入讲解。Nassau "},{"Type":"NodeBackslash","Properties":{"id":""},"Children":[{"Type":"NodeBackslashContent","Data":"[","Properties":{"id":""}}]},{"Type":"NodeText","Data":"1262]的《Physics and Chemistry of Color》描述了物体颜色背后的物理现象，非常彻底且详细。"}]}]}