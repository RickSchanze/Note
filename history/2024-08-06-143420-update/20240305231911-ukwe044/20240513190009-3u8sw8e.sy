{"ID":"20240513190009-3u8sw8e","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240513190009-3u8sw8e","title":"Chapter7 阴影 Shadows","type":"doc","updated":"20240806142608"},"Children":[{"ID":"20240513190806-a2y1swn","Type":"NodeParagraph","Properties":{"id":"20240513190806-a2y1swn","updated":"20240513190814"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240513190806-zoiwpoh.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"阴影相关的术语：光源（light source），遮挡物（occluder），接收物（receiver），阴影（shadow），本影（umbra）和半影（penumbra）。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240513190814-xofi6wj","Type":"NodeParagraph","Properties":{"id":"20240513190814-xofi6wj","updated":"20240513190847"},"Children":[{"Type":"NodeText","Data":"上面的图像列出了使用的相关区域："}]},{"ID":"20240513190848-rlrl0kz","Type":"NodeList","ListData":{},"Properties":{"id":"20240513190848-rlrl0kz","updated":"20240806142608"},"Children":[{"ID":"20240513190848-bqi2ie0","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513190848-bqi2ie0","updated":"20240513190848"},"Children":[{"ID":"20240513190848-rqn5dxp","Type":"NodeParagraph","Properties":{"id":"20240513190848-rqn5dxp","updated":"20240513190913"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"遮挡物"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（occluder）是指向接收物（receiver）投射阴影的物体。"}]},{"ID":"20240513190907-nncjzsm","Type":"NodeParagraph","Properties":{"id":"20240513190907-nncjzsm","updated":"20240513190928"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"精确光源"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（定点光源），即那些没有面积的光源，"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"只会产生完全被阴影覆盖的区域（本影）"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"，这样的阴影有时候会被称为"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"硬阴影"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（hard shadow）。"}]},{"ID":"20240513190933-rh6g355","Type":"NodeParagraph","Properties":{"id":"20240513190933-rh6g355","updated":"20240513190945"},"Children":[{"Type":"NodeText","Data":"如果使用了面光源或者体积光源，那么则会产生"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"软阴影"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（soft shadow）。"}]}]},{"ID":"20240513190908-5s1s9oj","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513190908-5s1s9oj"},"Children":[{"ID":"20240513190908-7lsgjai","Type":"NodeParagraph","Properties":{"id":"20240513190908-7lsgjai","updated":"20240513190953"},"Children":[{"Type":"NodeText","Data":"每个阴影都有一个完全被阴影覆盖的区域，称为"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"本影"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（umbra）"}]}]},{"ID":"20240513190955-gnhihlw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513190955-gnhihlw","updated":"20240806142608"},"Children":[{"ID":"20240513190955-vytru2f","Type":"NodeParagraph","Properties":{"id":"20240513190955-vytru2f","updated":"20240806142608"},"Children":[{"Type":"NodeText","Data":"以及一个部分被阴影覆盖的区域，称为"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"半影"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（penumbra）。"}]}]}]},{"ID":"20240513190914-rcpdwy1","Type":"NodeParagraph","Properties":{"id":"20240513190914-rcpdwy1","updated":"20240513191023"},"Children":[{"Type":"NodeText","Data":"一个正确渲染的软阴影应当有这样的现象，即"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"遮挡物越靠近接收物，阴影的边缘就会越清晰"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240513191024-jn6f2wi","Type":"NodeParagraph","Properties":{"id":"20240513191024-jn6f2wi","updated":"20240513191114"},"Children":[{"Type":"NodeText","Data":"软阴影的本影区域并不等同于由精确光源所产生的硬阴影；相反，软阴影的本影区域会随着光源的变大而减小。"}]},{"ID":"20240513191201-lx0ao90","Type":"NodeParagraph","Properties":{"id":"20240513191201-lx0ao90","updated":"20240513191213"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"20230611111328"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/20230611111328-20240513191201-3crh343.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"图中包含了硬阴影和软阴影。当遮挡物靠近接收物的时候，箱子所产生的阴影是尖锐的。人所产生的阴影在接触点（脚部）附近是尖锐的，随着与遮挡物之间的距离逐渐增加，阴影边缘也逐渐软化。远处的树枝也会产生柔和的阴影效果。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240513191402-yyakt5v","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240513191402-yyakt5v","updated":"20240515093928"},"Children":[{"Type":"NodeText","Data":"7.1 平面阴影"}]},{"ID":"20240513191410-si12xo9","Type":"NodeParagraph","Properties":{"id":"20240513191410-si12xo9","updated":"20240513191424"},"Children":[{"Type":"NodeText","Data":"最简单的情况是在屏幕上投射阴影。"}]},{"ID":"20240513191424-v6lscd4","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240513191424-v6lscd4","updated":"20240515093928"},"Children":[{"Type":"NodeText","Data":"7.1.1 投影阴影"}]},{"ID":"20240513191433-ixzzspf","Type":"NodeParagraph","Properties":{"id":"20240513191433-ixzzspf","updated":"20240513191458"},"Children":[{"Type":"NodeText","Data":"此方法中，物体被渲染两次，第二次用于创建阴影。"}]},{"ID":"20240513191459-31rr14p","Type":"NodeParagraph","Properties":{"id":"20240513191459-31rr14p","updated":"20240513191536"},"Children":[{"Type":"NodeText","Data":"考虑图7.3中的情况，光源位于点"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\mathbf{l}"},{"Type":"NodeText","Data":"，待投影的顶点位于点"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\mathbf{v}"},{"Type":"NodeText","Data":"，投影后平面上对应的顶点位于点"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\mathbf{p}"},{"Type":"NodeText","Data":"。这里我们先推导一个特殊情况，即阴影平面位于y = 0时的投影矩阵，然后再将这个结果推广到任意平面上。"}]},{"ID":"20240513191541-dj5md68","Type":"NodeParagraph","Properties":{"id":"20240513191541-dj5md68","updated":"20240513191542"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240513191541-1b5y9iu.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240513191551-ioht49l","Type":"NodeParagraph","Properties":{"id":"20240513191551-ioht49l","updated":"20240513191601"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"左图：位于点 "},{"Type":"NodeTextMark","TextMarkType":"code inline-math","TextMarkInlineMathContent":"\\mathbf{l}"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":" 的光源，在平面 "},{"Type":"NodeTextMark","TextMarkType":"code inline-math","TextMarkInlineMathContent":"y = 0"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":" 上投下阴影。顶点"},{"Type":"NodeTextMark","TextMarkType":"code inline-math","TextMarkInlineMathContent":" \\mathbf{v}"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":" 被投影到平面上，所产生的投影点被记作点 "},{"Type":"NodeTextMark","TextMarkType":"code inline-math","TextMarkInlineMathContent":"\\mathbf{p}"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":" ，可以利用相似三角形来推导投影矩阵。右图：阴影投射到任意平面"},{"Type":"NodeTextMark","TextMarkType":"code inline-math","TextMarkInlineMathContent":" π: \\mathbf{n}·x + d = 0"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":" 上。"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240513191602-41rxrqg","Type":"NodeParagraph","Properties":{"id":"20240513191602-41rxrqg","updated":"20240513191804"},"Children":[{"Type":"NodeText","Data":"可以推导出"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"x"},{"Type":"NodeText","Data":"坐标上的投影操作："}]},{"ID":"20240513191804-sxqk9t2","Type":"NodeMathBlock","Properties":{"id":"20240513191804-sxqk9t2","updated":"20240513191810"},"Children":[{"Type":"NodeMathBlockOpenMarker"},{"Type":"NodeMathBlockContent","Data":"\\frac{p_{x}-l_{x}}{v_{x}-l_{x}}=\\frac{l_{y}}{l_{y}-v_{y}} \\quad \\Longleftrightarrow \\quad p_{x}=\\frac{l_{y} v_{x}-l_{x} v_{y}}{l_{y}-v_{y}}.\n\\tag{7.1}"},{"Type":"NodeMathBlockCloseMarker"}]},{"ID":"20240513191823-jixwb8y","Type":"NodeParagraph","Properties":{"id":"20240513191823-jixwb8y","updated":"20240513191837"},"Children":[{"Type":"NodeText","Data":"同理，z坐标为"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"p_{z}=\\left(l_{y} v_{z}-l_{z} v_{y}\\right) /\\left(l_{y}-v_{y}\\right)"},{"Type":"NodeText","Data":"，由于投影平面位于y=0处，因此投影后顶点的y坐标为0。然后我们可以将这些方程转换为投影矩阵"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\mathbf{M}"},{"Type":"NodeText","Data":"："}]},{"ID":"20240513191823-rvej6jv","Type":"NodeMathBlock","Properties":{"id":"20240513191823-rvej6jv","updated":"20240513191850"},"Children":[{"Type":"NodeMathBlockOpenMarker"},{"Type":"NodeMathBlockContent","Data":"\\mathbf{M}=\\left(\\begin{array}{cccc}l_{y} \u0026 -l_{x} \u0026 0 \u0026 0 \\\\ 0 \u0026 0 \u0026 0 \u0026 0 \\\\ 0 \u0026 -l_{z} \u0026 l_{y} \u0026 0 \\\\ 0 \u0026 -1 \u0026 0 \u0026 l_{y}\\end{array}\\right) \\tag{7.2}"},{"Type":"NodeMathBlockCloseMarker"}]},{"ID":"20240513191823-b0znxdh","Type":"NodeParagraph","Properties":{"id":"20240513191823-b0znxdh","updated":"20240513191847"},"Children":[{"Type":"NodeText","Data":"我们可以很容易验证"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\mathbf{Mv = p}"},{"Type":"NodeText","Data":"，这意味着矩阵"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\mathbf{M}"},{"Type":"NodeText","Data":"确实是个投影矩阵。"}]},{"ID":"20240513191847-8opb4x4","Type":"NodeParagraph","Properties":{"id":"20240513191847-8opb4x4","updated":"20240513192109"},"Children":[{"Type":"NodeText","Data":"在一般情况下，阴影投射到的平面并不是y = 0，而是任意平面π: "},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\mathbf{n}·x + d = 0"},{"Type":"NodeText","Data":"，图7.3右侧展示了这种一般情况。我们的目标是找到一个矩阵，来将点"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\mathbf{v}"},{"Type":"NodeText","Data":"投影到点"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\mathbf{p}"},{"Type":"NodeText","Data":"。为了实现这个目的，我们让光线从点"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\mathbf{l}"},{"Type":"NodeText","Data":"发出，经过点"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\mathbf{v}"},{"Type":"NodeText","Data":"，最终与与平面"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"π"},{"Type":"NodeText","Data":"相交，这样我们就获得了投影点"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\mathbf{p}"},{"Type":"NodeText","Data":"，这个过程的数学形式如下："}]},{"ID":"20240513192109-j4rfhox","Type":"NodeMathBlock","Properties":{"id":"20240513192109-j4rfhox","updated":"20240513192116"},"Children":[{"Type":"NodeMathBlockOpenMarker"},{"Type":"NodeMathBlockContent","Data":"\\mathbf{p}=\\mathbf{l}-\\frac{d+\\mathbf{n} \\cdot \\mathbf{l}}{\\mathbf{n} \\cdot(\\mathbf{v}-\\mathbf{l})}(\\mathbf{v}-\\mathbf{l}).\n\\tag{7.3}"},{"Type":"NodeMathBlockCloseMarker"}]},{"ID":"20240513192117-3geqv27","Type":"NodeParagraph","Properties":{"id":"20240513192117-3geqv27","updated":"20240513192129"},"Children":[{"Type":"NodeText","Data":"对应投影矩阵为："}]},{"ID":"20240513192130-b3new3z","Type":"NodeMathBlock","Properties":{"id":"20240513192130-b3new3z","updated":"20240513194015"},"Children":[{"Type":"NodeMathBlockOpenMarker"},{"Type":"NodeMathBlockContent","Data":"\\mathbf{M}=\\left(\\begin{array}{cccc}\\mathbf{n} \\cdot \\mathbf{1}+d-l_{x} n_{x} \u0026 -l_{x} n_{y} \u0026 -l_{x} n_{z} \u0026 -l_{x} d \\\\ -l_{y} n_{x} \u0026 \\mathbf{n} \\cdot \\mathbf{1}+d-l_{y} n_{y} \u0026 -l_{y} n_{z} \u0026 -l_{y} d \\\\ -l_{z} n_{x} \u0026 -l_{z} n_{y} \u0026 \\mathbf{n} \\cdot \\mathbf{1}+d-l_{z} n_{z} \u0026 -l_{z} d \\\\ -n_{x} \u0026 -n_{y} \u0026 -n_{z} \u0026 \\mathbf{n} \\cdot \\mathbf{l}\\end{array}\\right)\n\\tag{7.4}"},{"Type":"NodeMathBlockCloseMarker"}]},{"ID":"20240513192133-32h9ifu","Type":"NodeBlockquote","Properties":{"id":"20240513192133-32h9ifu","updated":"20240513194109"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240513193715-ue40gdh","Type":"NodeParagraph","Properties":{"id":"20240513193715-ue40gdh","updated":"20240513193758"},"Children":[{"Type":"NodeText","Data":"首先平面方程为"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"π: \\mathbf{n}·x + d = 0"},{"Type":"NodeText","Data":"，则"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"p"},{"Type":"NodeText","Data":"在平面上满足："}]},{"ID":"20240513193754-11d7qs4","Type":"NodeMathBlock","Properties":{"id":"20240513193754-11d7qs4","updated":"20240513194019"},"Children":[{"Type":"NodeMathBlockOpenMarker"},{"Type":"NodeMathBlockContent","Data":"π: \\mathbf{n}·p + d = 0 \\tag{1}"},{"Type":"NodeMathBlockCloseMarker"}]},{"ID":"20240513193806-831ali5","Type":"NodeParagraph","Properties":{"id":"20240513193806-831ali5","updated":"20240513193824"},"Children":[{"Type":"NodeText","Data":"又"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"p"},{"Type":"NodeText","Data":"在光源到阴影线上，满足："}]},{"ID":"20240513193824-dfuhykq","Type":"NodeMathBlock","Properties":{"id":"20240513193824-dfuhykq","updated":"20240513194107"},"Children":[{"Type":"NodeMathBlockOpenMarker"},{"Type":"NodeMathBlockContent","Data":"p=\\vec{l}+x\\cdot(\\vec{v}-\\vec{l}) \\tag{2}"},{"Type":"NodeMathBlockCloseMarker"}]},{"ID":"20240513194026-c5cva6i","Type":"NodeParagraph","Properties":{"id":"20240513194026-c5cva6i","updated":"20240513194109"},"Children":[{"Type":"NodeText","Data":"将2代入1可算出x，将d代入2可算出p"}]}]},{"ID":"20240513194116-nco5dyb","Type":"NodeParagraph","Properties":{"id":"20240513194116-nco5dyb","updated":"20240513194206"},"Children":[{"Type":"NodeText","Data":"想要渲染平面阴影效果，只需要将这个矩阵应用到要在平面"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"π"},{"Type":"NodeText","Data":"上投射阴影的物体上，然后再将投影后的物体渲染为深色，并且不接收光照即可。"}]},{"ID":"20240513194206-ye9txm3","Type":"NodeParagraph","Properties":{"id":"20240513194206-ye9txm3","updated":"20240513194306"},"Children":[{"Type":"NodeText","Data":"在实践中，我们还必须采取一些措施，来"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"避免让投影后的三角形被渲染到投影表面之下"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。一种可行的方法是"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"对投影平面进行一些偏移，使得投影后的三角形总是会渲染在投影平面的前面"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240513194253-ic3vh8h","Type":"NodeParagraph","Properties":{"id":"20240513194253-ic3vh8h","updated":"20240513194330"},"Children":[{"Type":"NodeText","Data":"一种更加稳妥安全的方法是，"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"先绘制投影平面，然后在关闭z-buffer的情况下，再去绘制投影后的三角形，然后再像往常一样渲染剩余的几何图形"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240513194331-8vmb158","Type":"NodeParagraph","Properties":{"id":"20240513194331-8vmb158","updated":"20240513194408"},"Children":[{"Type":"NodeText","Data":"如果投影平面存在边界，例如它是一个矩形，那么阴影可能会落在矩形范围之外，这看起来会很奇怪。为了解决这个问题，我们可以使用一个"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"模板缓冲区"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（stencil buffer），"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"首先将接收物分别绘制到屏幕和模板缓冲区上，然后关闭z-buffer，使用模板缓冲区作为遮罩，只在有颜色的地方绘制投影后的三角形，最后再正常渲染场景的剩余部分"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240513194408-qikgpr4","Type":"NodeParagraph","Properties":{"id":"20240513194408-qikgpr4","updated":"20240513194457"},"Children":[{"Type":"NodeText","Data":"另一种阴影算法是将三角形渲染到一个纹理中，然后再将其应用到投影平面上。这个纹理其实是一种"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"光照贴图"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（light map），它可以调节底层表面的强度（Ref 11.5.1）。"}]},{"ID":"20240513194453-nesxror","Type":"NodeList","ListData":{},"Properties":{"id":"20240513194453-nesxror","updated":"20240513194504"},"Children":[{"ID":"20240513194458-xcl3nit","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513194458-xcl3nit","updated":"20240513194504"},"Children":[{"ID":"20240513194458-anicgg0","Type":"NodeParagraph","Properties":{"id":"20240513194458-anicgg0","updated":"20240513194504"},"Children":[{"Type":"NodeText","Data":"这种技术的一个缺点在于，纹理可能会被放大，使得单个纹素会覆盖多个屏幕像素，从而产生一些阴影锯齿。"}]}]}]},{"ID":"20240513194859-n2f9kcn","Type":"NodeParagraph","Properties":{"id":"20240513194859-n2f9kcn","updated":"20240513194859"},"Children":[{"Type":"NodeText","Data":"如果画面中的阴影情况没有发生变化的话，即光源和遮挡物之间没有发生相对移动，那么这个纹理便可以重复使用。"}]},{"ID":"20240513194913-4fgh4lq","Type":"NodeParagraph","Properties":{"id":"20240513194913-4fgh4lq","updated":"20240513194922"},"Children":[{"Type":"NodeText","Data":"所有的遮挡物必须位于光源和地面接收物之间。如果光源位于遮挡物下方，那么则会出现"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"反阴影"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（antishadow）现象，因为遮挡物上的每个顶点，都会通过光源所在的位置进行投影。"}]},{"ID":"20240513194928-zt0bodf","Type":"NodeParagraph","Properties":{"id":"20240513194928-zt0bodf","updated":"20240513194933"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240513194928-k96zdz4.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"图7.4：左图展示了一个正确的阴影效果；右图中则出现了一个错误的反阴影效果，因为光源低于在物体最顶端的顶点。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240513194933-f4emko8","Type":"NodeParagraph","Properties":{"id":"20240513194933-f4emko8","updated":"20240513194941"},"Children":[{"Type":"NodeText","Data":"我们可以对生成的阴影三角形进行显式剔除和修剪，从而避免上述的诸多瑕疵。"}]},{"ID":"20240513194942-xhzf51o","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240513194942-xhzf51o","updated":"20240515093928"},"Children":[{"Type":"NodeText","Data":"7.1.2 软阴影"}]},{"ID":"20240513194950-g3zhym1","Type":"NodeParagraph","Properties":{"id":"20240513194950-g3zhym1","updated":"20240513195039"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"当光源具有大小和面积时，便会形成软阴影。"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"}]},{"ID":"20240513195039-rwsgvwc","Type":"NodeList","ListData":{},"Properties":{"id":"20240513195039-rwsgvwc","updated":"20240513195138"},"Children":[{"ID":"20240513195045-0xgihr7","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513195045-0xgihr7","updated":"20240513195045"},"Children":[{"ID":"20240513195045-rkd7ltm","Type":"NodeParagraph","Properties":{"id":"20240513195045-rkd7ltm","updated":"20240513195105"},"Children":[{"Type":"NodeText","Data":"一种对面光源进行近似的方法是，在其表面上放置几个精确光源，来模拟对面光源的采样。对于每个精确光源，都会单独计算它的光照效果，将其存储在一张图像中，再将图像累积到缓冲区中；这些图像的平均值就是一幅带有软阴影的图像。"}]},{"ID":"20240513195106-0xaxf8e","Type":"NodeParagraph","Properties":{"id":"20240513195106-0xaxf8e","updated":"20240513195115"},"Children":[{"Type":"NodeText","Data":"但是这种方法效率实在是太低了。"}]}]},{"ID":"20240513195116-vpuwvdt","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513195116-vpuwvdt","updated":"20240513195138"},"Children":[{"ID":"20240513195116-2bv05ut","Type":"NodeParagraph","Properties":{"id":"20240513195116-2bv05ut","updated":"20240513195138"},"Children":[{"Type":"NodeText","Data":"还有一种"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"基于视锥体的方法来生成阴影"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"，这个方法的核心思路是将光源作为一个观察者，将地面作为视锥体的远裁剪平面；这个视锥体足够宽，可以讲所有的遮挡物包含在内。"}]}]}]},{"ID":"20240513195224-xdstvhb","Type":"NodeParagraph","Properties":{"id":"20240513195224-xdstvhb","updated":"20240513195235"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240513195224-we2c2y3.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"图7.5：左图使用了Heckbert和Herf的方法进行渲染，一共包含256个pass。右图是Haines的单pass方法，但是在Haines的方法中，本影的范围太大了，尤其是在门口和窗户附近。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240513195235-88ddaeh","Type":"NodeParagraph","Properties":{"id":"20240513195235-88ddaeh","updated":"20240513195319"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"通过生成一系列地面纹理，并将其累积叠加在一起，便可以形成一个包含软阴影的纹理。"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"我们在面光源表面上进行采样，将每个采样点作为一个精确光源，并在每个光源位置上渲染代表地面的图像，然后将遮挡物投影到该图像上。"}]},{"ID":"20240513195338-zkqycxv","Type":"NodeParagraph","Properties":{"id":"20240513195338-zkqycxv","updated":"20240513195404"},"Children":[{"Type":"NodeText","Data":"它存在一个问题：它看起来像是几个来自精确光源的阴影相互重叠在一起，而不是面光源自然形成的软阴影。而且对于"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"n"},{"Type":"NodeText","Data":"个阴影pass，它只能生成"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"n + 1"},{"Type":"NodeText","Data":"个不同的阴影；虽然可以使用大量pass来得到更加准确的结果，但是计算开销实在过高。"}]},{"ID":"20240513195408-xgxf0m0","Type":"NodeList","ListData":{},"Properties":{"id":"20240513195408-xgxf0m0","updated":"20240513195430"},"Children":[{"ID":"20240513195410-1shklxp","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513195410-1shklxp","updated":"20240513195430"},"Children":[{"ID":"20240513195410-4fygw6r","Type":"NodeParagraph","Properties":{"id":"20240513195410-4fygw6r","updated":"20240513195422"},"Children":[{"Type":"NodeText","Data":"更高效的方法是使用卷积。"}]},{"ID":"20240513195430-aara9fe","Type":"NodeParagraph","Properties":{"id":"20240513195430-aara9fe","updated":"20240513195430"},"Children":[{"Type":"NodeText","Data":"在某些情况下，对单个精确光源生成的硬阴影进行模糊，效果就足够了，并且可以生成半透明的纹理，从而与场景中的其他内容进行合成，如图7.6所示。"}]}]}]},{"ID":"20240513195433-j4zikxo","Type":"NodeParagraph","Properties":{"id":"20240513195433-j4zikxo","updated":"20240515082517"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240513195433-w3b58mb.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"图7.6：下落阴影（drop shadow）。从上方对遮挡物进行渲染，然后再对图像进行模糊处理，最后应用在地平面上，从而形成了 图中的阴影纹理 。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240513195442-57z6t7g","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240513195442-57z6t7g","updated":"20240515093928"},"Children":[{"Type":"NodeText","Data":"7.2 曲面上的阴影"}]},{"ID":"20240513195629-r0cwhln","Type":"NodeParagraph","Properties":{"id":"20240513195629-r0cwhln","updated":"20240513195705"},"Children":[{"Type":"NodeText","Data":"将平面阴影的思想方法扩展到曲面上："},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"将生成的阴影图像作为一个投影纹理"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240513195705-2q6mi1u","Type":"NodeParagraph","Properties":{"id":"20240513195705-2q6mi1u","updated":"20240513195713"},"Children":[{"Type":"NodeText","Data":"可以从光源的角度来理解阴影，凡是可以被光源看见的物体都会被照亮，而光源看不到的区域就是阴影区域。"}]},{"ID":"20240513195715-ub085qc","Type":"NodeParagraph","Properties":{"id":"20240513195715-ub085qc","updated":"20240513195842"},"Children":[{"Type":"NodeText","Data":"在本小节的方法中，这些阴影图像是由光源渲染形成的，就像放映机中的一帧底片一样。"}]},{"ID":"20240513195852-wfelojl","Type":"NodeParagraph","Properties":{"id":"20240513195852-wfelojl","updated":"20240513195852"},"Children":[{"Type":"NodeText","Data":"在渲染的时候，投影后的阴影纹理会对接收物的表面进行修改，它也可以与其他的阴影方法结合使用，有时候，它主要是用于帮助感知物体的位置。"}]},{"ID":"20240513195853-rq03c1i","Type":"NodeBlockquote","Properties":{"id":"20240513195853-rq03c1i","updated":"20240513195905"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240513195853-o2kchfu","Type":"NodeParagraph","Properties":{"id":"20240513195853-o2kchfu","updated":"20240513195905"},"Children":[{"Type":"NodeText","Data":"例如：在一个平台跳跃游戏中，即使角色完全处于阴影中，其下方可能总是会存在一个下落阴影，这个阴影主要是用来帮助玩家感知角色的位置。"}]}]},{"ID":"20240513195918-dv1mpft","Type":"NodeParagraph","Properties":{"id":"20240513195918-dv1mpft","updated":"20240513195918"},"Children":[{"Type":"NodeText","Data":"当然，纹理投影方法存在着一些严重的缺陷。"}]},{"ID":"20240513195919-m6qfa09","Type":"NodeList","ListData":{},"Properties":{"id":"20240513195919-m6qfa09","updated":"20240513195947"},"Children":[{"ID":"20240513195919-46u3let","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513195919-46u3let","updated":"20240513195919"},"Children":[{"ID":"20240513195919-cwcml2t","Type":"NodeParagraph","Properties":{"id":"20240513195919-cwcml2t","updated":"20240513195924"},"Children":[{"Type":"NodeText","Data":"首先，应用程序必须识别出哪些物体是遮挡物，哪些物体是阴影的接收物。"}]}]},{"ID":"20240513195925-84yd8we","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513195925-84yd8we"},"Children":[{"ID":"20240513195925-nlk6xp7","Type":"NodeParagraph","Properties":{"id":"20240513195925-nlk6xp7","updated":"20240513195933"},"Children":[{"Type":"NodeText","Data":"同时，应用程序必须保证接收物要比遮挡物到光源的距离更远，否则阴影便会“向后投射”，即上一节中提到的反阴影现象。"}]}]},{"ID":"20240513195942-ognzric","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513195942-ognzric","updated":"20240513195947"},"Children":[{"ID":"20240513195942-1p8n8rw","Type":"NodeParagraph","Properties":{"id":"20240513195942-1p8n8rw","updated":"20240513195947"},"Children":[{"Type":"NodeText","Data":"此外，这里的遮挡物是无法遮挡自己的，也就是说无法产生自阴影效果。"}]}]}]},{"ID":"20240513195949-h0btrtd","Type":"NodeParagraph","Properties":{"id":"20240513195949-h0btrtd","updated":"20240513200005"},"Children":[{"Type":"NodeText","Data":"接下来会介绍正确的阴影生成算法。"}]},{"ID":"20240513200006-bjtwm7r","Type":"NodeParagraph","Properties":{"id":"20240513200006-bjtwm7r","updated":"20240513200014"},"Children":[{"Type":"NodeText","Data":"值得注意的是，各种光源的照明模式可以通过使用预先创建的投影纹理来进行定义。"}]},{"ID":"20240513200015-enm3cww","Type":"NodeBlockquote","Properties":{"id":"20240513200015-enm3cww","updated":"20240513200048"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240513200015-37ktxsy","Type":"NodeParagraph","Properties":{"id":"20240513200015-37ktxsy","updated":"20240513200048"},"Children":[{"Type":"NodeText","Data":"例如聚光灯的投影纹理是一个简单的正方形，里面有一个圆来定义光源的照明范围。可以使用由水平线构成的投影纹理，来生成百叶窗（venetian blind）效果。这种类型的纹理被称为"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"光线衰减遮罩"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（light attenuation mask）、"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"cookie纹理"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"或者"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"gobo贴图"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]}]},{"ID":"20240513200050-2mwrmti","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240513200050-2mwrmti","updated":"20240515093928"},"Children":[{"Type":"NodeText","Data":"7.3 阴影体算法"}]},{"ID":"20240513200116-bmych5w","Type":"NodeParagraph","Properties":{"id":"20240513200116-bmych5w","updated":"20240513200251"},"Children":[{"Type":"NodeText","Data":"这是一种基于基于Crow的阴影体（shadow volume）思想，该方法巧妙地利用了模板缓冲区，可以在任意物体上投射阴影。该方法并不是基于图像的（与下一小节中所描述shadow map算法不同），因此它避免了采样的问题，可以在各处产生正确且锐利的阴影效果。"}]},{"ID":"20240513200300-xufqyyg","Type":"NodeParagraph","Properties":{"id":"20240513200300-xufqyyg","updated":"20240513200312"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"由于该算法的计算成本难以预测，因此现在已经很少使用阴影体算法了"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240513200307-xmqmp7j","Type":"NodeParagraph","Properties":{"id":"20240513200307-xmqmp7j","updated":"20240513200414"},"Children":[{"Type":"NodeText","Data":"首先，让我们想象一个点和一个三角形，将这个点和三角形的顶点相连接，并延伸到无穷远处，这样就形成了一个底面无穷远的三面金字塔。位于三角形下方的部分（即不包括这个点的部分），是一个被截断的无限金字塔；而位于三角形上方的部分，则只是一个简单的金字塔，如图7.7所示。现在我们假设这个点实际上是一个点光源，任何位于截断金字塔内部（在三角形下方）的物体都处于阴影中，这个空间便被称为shadow volume，一般叫做"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"阴影体或者阴影锥"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240513200402-h84yyk1","Type":"NodeParagraph","Properties":{"id":"20240513200402-h84yyk1","updated":"20240513200408"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240513200402-535v39y.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"图7.7：左图：点光源发出的光线穿过三角形的顶点，并向远处延伸，形成一个无限的金字塔。右图：上半部分是一个金字塔，下半部分是一个被截断的无限金字塔，又被称为阴影体（shadow volume）。所有位于阴影体内部的几何体都处于阴影中。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240513200414-e0uwq93","Type":"NodeParagraph","Properties":{"id":"20240513200414-e0uwq93","updated":"20240513200546"},"Children":[{"Type":"NodeText","Data":"假设我们现在正在观察某个场景，沿着从眼睛发出并穿过一个像素的光线，直到这个光线击中了要显示在屏幕上的场景物体。在光线从发出到与场景物体相交的过程中，每当光线穿过了阴影体的正面（即面向观察者的一面）时，我们就让计数器加1；也就是说，"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"每当光线进入阴影区域时，计数器就会增加"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。以同样的方式，每当光线穿过截断金字塔的背面时，我们便将相同的计数器减1，这代表了"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"光线从阴影区域中射出"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240513200546-uub79rr","Type":"NodeParagraph","Properties":{"id":"20240513200546-uub79rr","updated":"20240513200555"},"Children":[{"Type":"NodeText","Data":"我们会一直持续这个过程，增加或者减少计数器的值，直到光线击中了场景中的物体。此时，如果计数器大于0，则说明该像素位于阴影中；如果计数器小于0，则说明该像素位于阴影之外。"}]},{"ID":"20240513200720-r8mw2jf","Type":"NodeParagraph","Properties":{"id":"20240513200720-r8mw2jf","updated":"20240513200725"},"Children":[{"Type":"NodeText","Data":"使用射线来完成这件事是很耗时的，有一个更加聪明的解决方案，即使用模板缓冲区，模板缓冲区可以帮助我们完成这个计数过程。"}]},{"ID":"20240513200725-4awvgld","Type":"NodeList","ListData":{},"Properties":{"id":"20240513200725-4awvgld","updated":"20240513201010"},"Children":[{"ID":"20240513200726-yhqrmfa","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513200726-yhqrmfa","updated":"20240513200726"},"Children":[{"ID":"20240513200726-45m9482","Type":"NodeParagraph","Properties":{"id":"20240513200726-45m9482","updated":"20240513200730"},"Children":[{"Type":"NodeText","Data":"第一步，清空模板缓冲区。"}]}]},{"ID":"20240513200731-2h0qo0t","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513200731-2h0qo0t"},"Children":[{"ID":"20240513200731-lklgtdn","Type":"NodeParagraph","Properties":{"id":"20240513200731-lklgtdn","updated":"20240513200735"},"Children":[{"Type":"NodeText","Data":"第二步，将场景中使用无光材质的物体渲染到帧缓冲中，并将着色结果写入颜色缓冲区中，将深度信息写入到z-buffer中。"}]}]},{"ID":"20240513200830-859g5yv","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513200830-859g5yv"},"Children":[{"ID":"20240513200830-qkr1zwx","Type":"NodeParagraph","Properties":{"id":"20240513200830-qkr1zwx","updated":"20240513200839"},"Children":[{"Type":"NodeText","Data":"第三步，关闭对z-buffer和颜色缓冲的更新（当然我们仍然会使用z-buffer来进行深度测试），然后我们绘制阴影体的正面三角形。"}]},{"ID":"20240513200855-6iiy6p2","Type":"NodeParagraph","Properties":{"id":"20240513200855-6iiy6p2","updated":"20240513200855"},"Children":[{"Type":"NodeText","Data":"在这个过程中，我们将模板操作被设置为：在绘制三角形的地方，模板缓冲区中对应位置上的值加1。"}]}]},{"ID":"20240513200857-7lcae8b","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513200857-7lcae8b"},"Children":[{"ID":"20240513200857-c79oid6","Type":"NodeParagraph","Properties":{"id":"20240513200857-c79oid6","updated":"20240513200902"},"Children":[{"Type":"NodeText","Data":"第四步，使用模板缓冲区来执行另一个pass，这次我们只绘制阴影体的背面三角形。"}]},{"ID":"20240513200911-l88obe0","Type":"NodeParagraph","Properties":{"id":"20240513200911-l88obe0","updated":"20240513200917"},"Children":[{"Type":"NodeText","Data":"在这个pass中，我们将模板操作被设置为：在绘制三角形的地方，模板缓冲区中对应位置上的值减1。只有当阴影体各个表面上的像素可以被相机看见时（即没有被其他几何图形遮挡），模板缓冲区中的值才会增加和减少。"}]},{"ID":"20240513201002-4e0gd3n","Type":"NodeParagraph","Properties":{"id":"20240513201002-4e0gd3n","updated":"20240513201002"},"Children":[{"Type":"NodeText","Data":"在这个pass完成之后，模板缓冲区中保存了屏幕上每个像素的阴影状态（即是否位于阴影区域中）。"}]}]},{"ID":"20240513201003-3fkue4p","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513201003-3fkue4p","updated":"20240513201010"},"Children":[{"ID":"20240513201003-rjorhtv","Type":"NodeParagraph","Properties":{"id":"20240513201003-rjorhtv","updated":"20240513201010"},"Children":[{"Type":"NodeText","Data":"最后，我们再次渲染整个场景，这次只会渲染使用受光材质的物体，并且渲染的结果只会显示在模板缓冲区中值为0的地方，值为0代表了光线离开阴影体与它进入阴影体的次数相等，也就是说，这个像素位置位于阴影之外，它会被光源照亮。"}]}]}]},{"ID":"20240513201043-2b254ag","Type":"NodeParagraph","Properties":{"id":"20240513201043-2b254ag","updated":"20240513201044"},"Children":[{"Type":"NodeText","Data":"这种计数方法是阴影体算法背后的基本思想。"}]},{"ID":"20240513201100-mve7fob","Type":"NodeParagraph","Properties":{"id":"20240513201100-mve7fob","updated":"20240513201214"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"20230611111532"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/20230611111532-20240513201100-bgis5s3.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"阴影体算法。左图中的角色投射了一个影子，右边展示了这个模型所产生的阴影体三角形。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240513201215-oly7jnk","Type":"NodeParagraph","Properties":{"id":"20240513201215-oly7jnk","updated":"20240513201220"},"Children":[{"Type":"NodeText","Data":"但是："}]},{"ID":"20240513201110-b4mywq8","Type":"NodeList","ListData":{},"Properties":{"id":"20240513201110-b4mywq8","updated":"20240513201606"},"Children":[{"ID":"20240513201149-lr12odx","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513201149-lr12odx","updated":"20240513201149"},"Children":[{"ID":"20240513201149-t49tasy","Type":"NodeParagraph","Properties":{"id":"20240513201149-t49tasy","updated":"20240513201316"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"这会导致大量的过度绘制（overdraw）"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。一个由1000个三角形组成的球体，会创建3000个四边形，并且每个四边形都可能会横跨整个屏幕。（一个三角形会创建三个四边形，对应截断金字塔的四个面）。"}]},{"ID":"20240513201323-2ng5h9w","Type":"NodeParagraph","Properties":{"id":"20240513201323-2ng5h9w","updated":"20240513201333"},"Children":[{"Type":"NodeText","Data":"一种解决方案是，只沿着物体的轮廓边缘来绘制这些四边形。"}]}]},{"ID":"20240513201333-zretzsk","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513201333-zretzsk","updated":"20240513201606"},"Children":[{"ID":"20240513201333-niia4vt","Type":"NodeParagraph","Properties":{"id":"20240513201333-niia4vt","updated":"20240513201606"},"Children":[{"Type":"NodeText","Data":"极端的不稳定性。（计算开销不稳定，如果相机和光源位于同一位置。那么所形成的四边形不会覆盖屏幕上任何像素。如果相机恰好移动到阴影中，阴影体会覆盖整个像素带来巨大开销）。"}]}]}]},{"ID":"20240513201212-40nw9gw","Type":"NodeParagraph","Properties":{"id":"20240513201212-40nw9gw","updated":"20240513201416"},"Children":[{"Type":"NodeText","Data":"由于上述的这些原因，"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"如今的应用程序在很大程度上都放弃了阴影体算法"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240513201416-yq2dxid","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240513201416-yq2dxid","updated":"20240515093928"},"Children":[{"Type":"NodeText","Data":"7.4 阴影贴图"}]},{"ID":"20240513201434-q8lwwag","Type":"NodeParagraph","Properties":{"id":"20240513201434-q8lwwag","updated":"20240513201647"},"Children":[{"Type":"NodeText","Data":"阴影贴图的思想是：其核心想法是从光源的位置出发，使用z-buffer来渲染整个场景，然后再生成阴影效果。能够被光源“看见”的任何物体都会被照亮，光源“看不见”的物体则都处于阴影中。"}]},{"ID":"20240513201656-efecrtf","Type":"NodeParagraph","Properties":{"id":"20240513201656-efecrtf","updated":"20240513201703"},"Children":[{"Type":"NodeText","Data":"实际上在图像渲染的时候，我们最终只需要这个z-buffer即可，即我们只需要场景的深度信息；因此在这个特殊的场景渲染中，我们可以关闭光照、纹理等选项，也不用向颜色缓冲写入任何值。"}]},{"ID":"20240513201745-xw18nr6","Type":"NodeParagraph","Properties":{"id":"20240513201745-xw18nr6","updated":"20240513201748"},"Children":[{"Type":"NodeText","Data":"在从光源视角渲染整个场景之后，z-buffer中的每个像素现在代表了最靠近光源的物体深度值。我们将这个z-buffer中的内容叫做阴影贴图。"}]},{"ID":"20240513201758-r4ey473","Type":"NodeParagraph","Properties":{"id":"20240513201758-r4ey473","updated":"20240513201758"},"Children":[{"Type":"NodeText","Data":"为了使用这个阴影贴图来生成阴影效果，我们会从相机的位置来对场景进行第二次渲染。在渲染每个图元的时候，对于该图元所覆盖的每个像素位置，我们都会将其与阴影贴图进行深度比较：如果着色点比阴影贴图中对应位置到光源的距离更远，则说明该点位于阴影中，否则该点不在阴影中。"}]},{"ID":"20240513201804-f4jn2k2","Type":"NodeParagraph","Properties":{"id":"20240513201804-f4jn2k2","updated":"20240513201805"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240513201804-aiwhyu3.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240513201814-ekrbw67","Type":"NodeParagraph","Properties":{"id":"20240513201814-ekrbw67","updated":"20240513201921"},"Children":[{"Type":"NodeText","Data":"阴影映射。左上角：通过存储视图中的表面深度，来构建阴影贴图。右上角：眼睛正看向场景中的两个位置，其中在点 "},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\mathbf{v}_a"},{"Type":"NodeText","Data":" 看到了球体，而这个点可以在阴影贴图的纹素 a 处找到，存储在纹素 a 处深度值大于点 "},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\mathbf{v}_a"},{"Type":"NodeText","Data":" 到光源的距离，因此点 "},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\mathbf{v}_a"},{"Type":"NodeText","Data":" 会被照亮。而对于矩形表面上的点 "},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\mathbf{v}_b"},{"Type":"NodeText","Data":" ，其相对于光源的深度要大于存储在纹素  b 处的深度值，因此点 "},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\mathbf{v}_b "},{"Type":"NodeText","Data":"位于阴影中。左下角：光源视角下的场景深度图，颜色越白，代表深度值越大。右下角：使用阴影贴图进行渲染的场景。"}]},{"ID":"20240513201822-38fnpr0","Type":"NodeParagraph","Properties":{"id":"20240513201822-38fnpr0","updated":"20240513202207"},"Children":[{"Type":"NodeText","Data":"并不是场景中的所有物体都需要被渲染到光源的视野中。"}]},{"ID":"20240513202208-z46ni8j","Type":"NodeList","ListData":{},"Properties":{"id":"20240513202208-z46ni8j","updated":"20240513202231"},"Children":[{"ID":"20240513202209-rhmr3jv","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513202209-rhmr3jv","updated":"20240513202209"},"Children":[{"ID":"20240513202209-uqc5i99","Type":"NodeParagraph","Properties":{"id":"20240513202209-uqc5i99","updated":"20240513202215"},"Children":[{"Type":"NodeText","Data":"首先，只有能够投射阴影的物体才需要进行渲染，我们将其称为shadow caster（遮挡物，能够投射出阴影的物体）"}]}]},{"ID":"20240513202225-d84t30k","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513202225-d84t30k","updated":"20240513202231"},"Children":[{"ID":"20240513202225-xgrqh5s","Type":"NodeParagraph","Properties":{"id":"20240513202225-xgrqh5s","updated":"20240513202231"},"Children":[{"Type":"NodeText","Data":"shadow caster是指那些位于光源视锥体内部的物体，这个视锥体可以通过一些方法来进行扩张或者收缩，这使得我们可以安全地忽略掉场景中的一些shadow caster"}]}]}]},{"ID":"20240513202307-dr29c79","Type":"NodeParagraph","Properties":{"id":"20240513202307-dr29c79","updated":"20240513202314"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240513202307-ngmt7k4.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"图7.11：左侧：光源的视野内包含相机的截锥体。中间：对光源的远裁剪平面进行了调整，使得光源视锥体只包含相机可见的阴影接收物，即将作为shadow caster的蓝色三角剔除在外；同时还对近裁剪平面进行了调整，从而提高z-buffer的有效精度。右侧：光源视锥体的两侧进行收缩，只包含相机可见的阴影接收物，将绿色胶囊剔除在外。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240513202314-rav4ni0","Type":"NodeParagraph","Properties":{"id":"20240513202314-rav4ni0","updated":"20240513202406"},"Children":[{"Type":"NodeText","Data":"阴影贴图的一个缺点是："},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"阴影质量取决于阴影贴图的分辨率（单位为像素）以及z-buffer的数值精度"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240513202421-t4dg7xl","Type":"NodeParagraph","Properties":{"id":"20240513202421-t4dg7xl","updated":"20240513202421"},"Children":[{"Type":"NodeText","Data":"由于在进行深度比较的时候，需要对阴影贴图进行采样，因此该算法容易受到锯齿问题的影响，尤其是在物体之间的接触点附近。"}]},{"ID":"20240513202423-3x4zfz8","Type":"NodeParagraph","Properties":{"id":"20240513202423-3x4zfz8","updated":"20240513202435"},"Children":[{"Type":"NodeText","Data":"一个常见的问题是"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"自阴影锯齿"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（self-shadow aliasing），即一个三角形错误地对自身投射阴影，这个现象通常会被称为“表面痤疮（surface acne）”或者“阴影痤疮（shadow acne）”。"}]},{"ID":"20240513202438-d8973bh","Type":"NodeParagraph","Properties":{"id":"20240513202438-d8973bh","updated":"20240513202450"},"Children":[{"Type":"NodeText","Data":"产生这种现象的原因主要有两个："}]},{"ID":"20240513202450-w19cybu","Type":"NodeList","ListData":{},"Properties":{"id":"20240513202450-w19cybu","updated":"20240513202550"},"Children":[{"ID":"20240513202451-c3eavi1","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513202451-c3eavi1","updated":"20240513202451"},"Children":[{"ID":"20240513202451-7jvjpey","Type":"NodeParagraph","Properties":{"id":"20240513202451-7jvjpey","updated":"20240513202455"},"Children":[{"Type":"NodeText","Data":"处理器精度的数值限制"}]}]},{"ID":"20240513202456-6pyazaw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240513202456-6pyazaw","updated":"20240513202550"},"Children":[{"ID":"20240513202456-wmchcj0","Type":"NodeParagraph","Properties":{"id":"20240513202456-wmchcj0","updated":"20240513202502"},"Children":[{"Type":"NodeText","Data":"几何上的，由于受到阴影贴图分辨率的限制，因此一个点状样本的值会被用来代表一个小范围区域的深度。"}]},{"ID":"20240513202532-10ke94y","Type":"NodeParagraph","Properties":{"id":"20240513202532-10ke94y","updated":"20240513202535"},"Children":[{"Type":"NodeText","Data":"也就是说，为光源生成的样本，几乎永远不会与屏幕样本位于相同的位置（例如：像素通常会在屏幕样本的中心进行采样）。"}]},{"ID":"20240513202546-aupsla1","Type":"NodeParagraph","Properties":{"id":"20240513202546-aupsla1","updated":"20240513202550"},"Children":[{"Type":"NodeText","Data":"当光源的存储深度值与观察表面的深度值进行比较时，光源的值可能会略低于表面的值，从而导致自阴影现象的发生。"}]}]}]},{"ID":"20240513202628-l54cyta","Type":"NodeParagraph","Properties":{"id":"20240513202628-l54cyta","updated":"20240513202635"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240513202628-w1xtoj7.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"图7.12：阴影映射的偏移瑕疵。左图中所设置的偏移量太小，因此发生了自阴影现象。右图中所设置的偏移量太大，导致鞋子没有投射出与自身相接触阴影。同时阴影贴图的分辨率也太低，使得阴影具有块状外观。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240513202636-vl2vxvg","Type":"NodeParagraph","Properties":{"id":"20240513202636-vl2vxvg","updated":"20240513202708"},"Children":[{"Type":"NodeText","Data":"一种帮助避免（但并不总是能消除）各种阴影贴图瑕疵的常见方法是"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"引入偏移量因子"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240513202708-c1ith27","Type":"NodeParagraph","Properties":{"id":"20240513202708-c1ith27","updated":"20240513202718"},"Children":[{"Type":"NodeText","Data":"当对阴影贴图中检索到的深度，与待测位置的深度进行比较时，可以从接收物的深度中减去一个很小的偏移量。"}]},{"ID":"20240513202729-c7zlcm7","Type":"NodeParagraph","Properties":{"id":"20240513202729-c7zlcm7","updated":"20240513202744"},"Children":[{"Type":"NodeText","Data":"使用接收物相对于光源的角度，来对偏移量进行修正，从而避免这个问题，即"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"表面相对于光源的倾斜角度越大，所应用的偏移量也就越大"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240513202744-eqrpbgh","Type":"NodeParagraph","Properties":{"id":"20240513202744-eqrpbgh","updated":"20240513202811"},"Children":[{"Type":"NodeText","Data":"这种偏移量称为斜率修正的偏移（slope scale bias）。这两种偏移量都可以通过使用相应的命令（例如OpenGL的"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"glPolygonOffset"},{"Type":"NodeText","Data":"​），来让每个多边形稍稍远离光源。"}]},{"ID":"20240513202757-77cgnfl","Type":"NodeParagraph","Properties":{"id":"20240513202757-77cgnfl","updated":"20240513202831"},"Children":[{"Type":"NodeText","Data":"请注意，当表面正对光源的时候，并不会因斜率修正偏移而向后移动，即此时的斜率修正偏移为0。因此，"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"为了避免可能的精度误差，我们会将斜率修正偏移与一个恒定偏移结合在一起使用"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240513202831-19id5u9","Type":"NodeParagraph","Properties":{"id":"20240513202831-19id5u9","updated":"20240513202837"},"Children":[{"Type":"NodeText","Data":"斜率修正偏移也经常会被clamp到某些最大值，因为当表面和光源呈掠射夹角时（接近90度），此时的正切值会很大。"}]},{"ID":"20240513202841-k8ah4ss","Type":"NodeParagraph","Properties":{"id":"20240513202841-k8ah4ss","updated":"20240513202845"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240513202841-9eec5mu.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"图7.13：阴影偏移。表面正上方有一个光源，这个表面会被渲染到一个阴影贴图中，图中的灰色竖线代表了阴影贴图的像素中心，阴影贴图会在 × 位置处记录遮挡深度。我们想要知道，表面上的这三点是否会被光源照亮，最近的阴影贴图深度值会使用相同颜色的 × 进行表示。左图中，如果没有添加偏移，那么蓝色和橙色样本将会被错误地认为处于阴影中，因为与对应的阴影贴图深度相比，它们距离光源更远。在中间，从每个样本中都减去了恒定的深度偏移，使得每个样本都更加靠近光源，但是此时蓝色样本仍然会被认为处于阴影中，因为它距离光源还是要更远一点。右图中，在构建阴影贴图的时候，会根据每个多边形的斜率，对其偏移量进行修正，然后再让其按照偏移量稍稍靠近光源（样本），这样所有的样本深度都要比阴影贴图中的深度更加靠近光源，因此它们都会被光源照亮。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240513202846-blyv6lu","Type":"NodeParagraph","Properties":{"id":"20240513202846-blyv6lu","updated":"20240513205045"},"Children":[{"Type":"NodeText","Data":"法线补偿偏移（normal offset bias），它将接收物的世界空间位置，沿着其表面法线的方向稍稍移动一点，移动的距离与光源方向和表面法线之间夹角的正弦值成正比。"}]},{"ID":"20240513205045-2f01r36","Type":"NodeParagraph","Properties":{"id":"20240513205045-2f01r36","updated":"20240513205115"},"Children":[{"Type":"NodeText","Data":"这个操作不仅改变了样本的深度值，还改变了它在阴影贴图上进行深度测试的xy坐标。当"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"光线与表面之间的角度更加接近掠射角度时，这个偏移量就会增加，因为此时我们希望样本距离表面足够远，从而避免自阴影现象"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240513205116-7z1gxyx","Type":"NodeParagraph","Properties":{"id":"20240513205116-7z1gxyx","updated":"20240513205135"},"Children":[{"Type":"NodeText","Data":"这种方法可以理解为将样本移动到阴影接收物上方的“虚拟表面”上。"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"这个偏移量是一个世界空间下的距离"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"，因此建议可以根据阴影贴图的深度范围，来对这个偏移量进行缩放。"}]},{"ID":"20240513205133-mjql9t5","Type":"NodeParagraph","Properties":{"id":"20240513205133-mjql9t5","updated":"20240513205201"},"Children":[{"Type":"NodeText","Data":"此外还有沿相机观察方向偏移的方法等。"}]},{"ID":"20240513205201-3zs7xke","Type":"NodeParagraph","Properties":{"id":"20240513205201-3zs7xke","updated":"20240513205250"},"Children":[{"Type":"NodeText","Data":"过大偏移量会导致漏光或Peter Panning问题（物体看起来像浮在表面上）。这是因为物体接触点下方区域被前向偏移太多没有接收到阴影。"}]},{"ID":"20240513205251-2hg1isa","Type":"NodeParagraph","Properties":{"id":"20240513205251-2hg1isa","updated":"20240513205332"},"Children":[{"Type":"NodeText","Data":"避免自引用的另一种方法是只将物体背面渲染到阴影贴图，称为第二深度阴影映射。它在许多情况下都表现良好，尤其是对于那些无法手动调整偏移量的渲染系统。"}]},{"ID":"20240513205339-xmf6otd","Type":"NodeParagraph","Properties":{"id":"20240513205339-xmf6otd","updated":"20240513205339"},"Children":[{"Type":"NodeText","Data":"但是当物体是双面渲染的、非常薄的、或者是相互接触时，这种方法就会出现问题。"}]},{"ID":"20240513205355-xp9fhoz","Type":"NodeBlockquote","Properties":{"id":"20240513205355-xp9fhoz","updated":"20240513205523"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240513205357-l6cfqo6","Type":"NodeParagraph","Properties":{"id":"20240513205357-l6cfqo6","updated":"20240513205405"},"Children":[{"Type":"NodeText","Data":"如果一个模型是双面渲染的，也就是说其网格两侧都是可见的（例如：一个棕榈叶或者一张纸），那么此时就可能会发生自阴影现象，因为背面和正面位于相同的位置。"}]},{"ID":"20240513205406-ldal3g5","Type":"NodeParagraph","Properties":{"id":"20240513205406-ldal3g5","updated":"20240513205414"},"Children":[{"Type":"NodeText","Data":"同样地，如果不进行偏移，那么在模型轮廓边缘处，或者很薄的物体附近也可能会出现问题，因为在这些地方，模型的背面和正面靠得很近。"}]},{"ID":"20240513205441-rqi1mgz","Type":"NodeParagraph","Properties":{"id":"20240513205441-rqi1mgz","updated":"20240513205523"},"Children":[{"Type":"NodeText","Data":"具体选择哪种方案可以视情况而定。例如使用正面深度生成太阳阴影，使用背面深度生成室内灯光阴影。"}]}]},{"ID":"20240513205432-jzrn63m","Type":"NodeParagraph","Properties":{"id":"20240513205432-jzrn63m","updated":"20240513205535"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240513205432-x2cvrkt.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"图7.14：位于正上方的光源所生成的阴影贴图。左图：使用红色标记了面对光源的表面，它们将被记录到阴影贴图中。这些表面可能会错误地对自身投射阴影（即“阴影痤疮”），所以需要向远离光源的方向进行偏移。在中间：只有背面的三角形表面会被渲染到阴影贴图中。如果将遮挡物向下（远离光源）进行偏移，可能会让光线泄漏到靠近位置a的地面上；如果将遮挡物向上（靠近光源）进行偏移，可能会导致在轮廓边界b附近，被错误地被认为处于阴影中，但是实际上这些地方应当会被照亮。右图：在阴影贴图上每个位置上，会在最近的正面三角形与背面三角形的中点处，形成一个中间表面。但是这样可能会在点c附近发生漏光（这也可能发生在第二深度阴影贴映射中），因为最近的阴影贴图样本，可能位于该位置（点c）左侧的中间表面上，该点会更加靠近光源。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240513205526-vt0emle","Type":"NodeParagraph","Properties":{"id":"20240513205526-vt0emle","updated":"20240513205656"},"Children":[{"Type":"NodeText","Data":"需要注意的是，对于阴影映射而言，能够投射阴影的物体必须是“水密的（watertight）”（或者被称为流形manifold、封闭closed、或者固体solid，详见章节16.3.3），或者换句话说，它"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"必须能够将自己的正面和背面都渲染到阴影贴图中，否则这个物体可能无法投射一个完整的阴影"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240513205657-fax0qv7","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20240513205657-fax0qv7","updated":"20240515093928"},"Children":[{"Type":"NodeText","Data":"7.4.1 分辨率增强"}]},{"ID":"20240514172239-9hv6q75","Type":"NodeParagraph","Properties":{"id":"20240514172239-9hv6q75","updated":"20240514172250"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240514172239-j3lhs83.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"左边的图像是使用标准的阴影映射生成的；右边的图像则使用了LiSPSM。上图还展示了每个阴影贴图纹素在地面上的投影。这两个阴影贴图具有相同的分辨率，不同之处在于，LiSPSM对光源矩阵进行了修改，在更靠近观察者的地方提供了更高的采样率。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240514172250-6jczrmo","Type":"NodeParagraph","Properties":{"id":"20240514172250-6jczrmo","updated":"20240514172436"},"Children":[{"Type":"NodeText","Data":"如果相机在光源位置那么阴影纹素可以与屏幕空间像素完美对应，但是一旦光源有所改变，阴影贴图一个纹素占据的屏幕像素比例就会改变，此时会产生一些瑕疵和锯齿。"}]},{"ID":"20240514172437-3rr6kev","Type":"NodeParagraph","Properties":{"id":"20240514172437-3rr6kev","updated":"20240514172532"},"Children":[{"Type":"NodeText","Data":"上图左边阴影是块状的而且轮廓也不清晰，这是因为阴影贴图中每个纹素都关联了大量前景像素，这种不匹配现象称为"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"透视走样"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240514172532-z0vn69h","Type":"NodeParagraph","Properties":{"id":"20240514172532-z0vn69h","updated":"20240514172645"},"Children":[{"Type":"NodeText","Data":"当一个表面几乎与光线平行，且它刚好面向观察者时，单个阴影贴图的纹素也会覆盖大量像素，此问题称为"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"投影走样"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"，如下图："}]},{"ID":"20240514172648-fnr8kwx","Type":"NodeParagraph","Properties":{"id":"20240514172648-fnr8kwx","updated":"20240514172652"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240514172648-74q6tg8.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"图7.16：左图中的光源几乎位于正上方，阴影的边缘有点粗糙，因为与相机的视图分辨率相比，阴影贴图的分辨率比较低。右图中的光线以掠射角度照射到物体上，每个阴影贴图中的纹素，在水平方向上都会覆盖相当多的屏幕像素，所以会产生更加锯齿状的阴影边缘。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240514172652-dpxun8w","Type":"NodeParagraph","Properties":{"id":"20240514172652-dpxun8w","updated":"20240514173058"},"Children":[{"Type":"NodeText","Data":"可以使用另一种方法来创建光源的采样模式，使其更加接近相机的采样模式，这是通过改变场景向光源的投影方式来实现的。"}]},{"ID":"20240514173107-w9wkouf","Type":"NodeParagraph","Properties":{"id":"20240514173107-w9wkouf","updated":"20240514173117"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240514173107-w1cbcjc.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"对于位于正上方的光源，左图中地面上的采样率和眼睛的采样率不匹配。在右图中，通过改变光源的观察方向和投影窗口，使得采样率发生偏移，在左侧靠近眼睛的地方，拥有更高密度的纹素。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240514173118-q7gqerk","Type":"NodeParagraph","Properties":{"id":"20240514173118-q7gqerk","updated":"20240514173224"},"Children":[{"Type":"NodeText","Data":"将光源的观察视图映射到人眼的观察视图，大概有22个自由度，由此引申出来好几种不同的算法，包括透视阴影贴图（perspective shadow map，PSM）、梯形阴影贴图（trapezoidal shadow maps，TSM）和光源空间透视阴影贴图（light space perspective shadow map，LiSPSM）。这类技术被统称为"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"透视变形"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（perspective warping）方法。"}]},{"ID":"20240514173217-w30dohd","Type":"NodeParagraph","Properties":{"id":"20240514173217-w30dohd","updated":"20240514173230"},"Children":[{"Type":"NodeText","Data":"这些矩阵扭曲（matrix-warping）算法的一个优点是，除了对光源的投影矩阵进行修改之外，不需要进行其他额外的工作。"}]},{"ID":"20240514173306-4ptnda7","Type":"NodeParagraph","Properties":{"id":"20240514173306-4ptnda7","updated":"20240514173311"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"当光源方向垂直于观察方向时（例如头顶上的光源），这些方案的效果最好"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"，因为在这种情况下，在对光源的透视变换进行修正之后，可以在靠近眼睛的地方放置更多的样本。"}]},{"ID":"20240514173311-yz76twq","Type":"NodeParagraph","Properties":{"id":"20240514173311-yz76twq","updated":"20240514173346"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"当光源位于相机前方并且指向相机的时候，这些矩阵扭曲技术就会失效。"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"这种情况被称为"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"视锥决斗"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（dueling frusta），因为光源的视锥体和相机的视锥体相对；"}]},{"ID":"20240514173336-gs4zig6","Type":"NodeParagraph","Properties":{"id":"20240514173336-gs4zig6","updated":"20240514173448"},"Children":[{"Type":"NodeText","Data":"此外还会出现阴影质量突变等问题，这系列问题使这种方法不再受欢迎。"}]},{"ID":"20240514173448-sup2hgd","Type":"NodeParagraph","Properties":{"id":"20240514173448-sup2hgd","updated":"20240514173619"},"Children":[{"Type":"NodeText","Data":"另一个想法是在靠近观察者位置上添加更多样本。"}]},{"ID":"20240514173654-twxae76","Type":"NodeBlockquote","Properties":{"id":"20240514173654-twxae76","updated":"20240514173929"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240514173906-d6ezavf","Type":"NodeParagraph","Properties":{"id":"20240514173906-d6ezavf","updated":"20240514173906"},"Children":[{"Type":"NodeText","Data":"Blow实现了一个系统，其想法是："},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"生成一组固定数量的阴影贴图（它们的分辨率可能是不同的）来覆盖场景中的不同区域"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240514173910-sk0hh7w","Type":"NodeList","ListData":{},"Properties":{"id":"20240514173910-sk0hh7w","updated":"20240514173911"},"Children":[{"ID":"20240514173911-2wwxh41","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240514173911-2wwxh41","updated":"20240514173911"},"Children":[{"ID":"20240514173911-f1d2bxc","Type":"NodeParagraph","Properties":{"id":"20240514173911-f1d2bxc","updated":"20240514173912"},"Children":[{"Type":"NodeText","Data":"在Blow的方案中，生成了四张阴影贴图，它们嵌套在了观察者周围；通过这种方式，位于观察者附近的物体就可以获得更高分辨率的阴影贴图，而位于远处的物体则会获得较低分辨率的阴影贴图。"}]}]}]},{"ID":"20240514173921-yz629w4","Type":"NodeParagraph","Properties":{"id":"20240514173921-yz629w4","updated":"20240514173921"},"Children":[{"Type":"NodeText","Data":"Forsyth提出了类似的想法："},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"为不同集合的可见物体，生成不同的阴影贴图"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240514173921-lwx4oh9","Type":"NodeList","ListData":{},"Properties":{"id":"20240514173921-lwx4oh9","updated":"20240514173921"},"Children":[{"ID":"20240514173921-relhj7y","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240514173921-relhj7y","updated":"20240514173921"},"Children":[{"ID":"20240514173921-5byv4vf","Type":"NodeParagraph","Properties":{"id":"20240514173921-5byv4vf","updated":"20240514173921"},"Children":[{"Type":"NodeText","Data":"这种方法中，不需要对跨越两个阴影贴图边界的物体过渡问题进行处理，因为每个物体有且只有一个与其关联的阴影贴图。"}]}]}]},{"ID":"20240514173921-pt7wdnh","Type":"NodeParagraph","Properties":{"id":"20240514173921-pt7wdnh","updated":"20240514173921"},"Children":[{"Type":"NodeText","Data":"Flagship将两种理念融合：第一个阴影贴图用于观察者附近的动态物体，第二个阴影贴图用于观察者附近的静态对象，第三个阴影贴图用于整个场景中的静态物体。每帧只需要重新生成第一个阴影贴图即可，另外两个阴影贴图只需要生成一次，因为它们所包含的光源和几何物体都是静态的。"}]},{"ID":"20240514173921-0nrjn35","Type":"NodeParagraph","Properties":{"id":"20240514173921-0nrjn35","updated":"20240514173929"},"Children":[{"Type":"NodeText","Data":"上述渲染系统都很老了。但是提出了"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"为不同情况和物体生成多个阴影贴图的"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"想法。"}]}]},{"ID":"20240514173939-p8wug09","Type":"NodeParagraph","Properties":{"id":"20240514173939-p8wug09","updated":"20240514173955"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"20230611111808"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/20230611111808-20240514173939-xl7wap1.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"图7.18：左图中，相机的视锥体被划分成了四个区域。右图中，为每个划分后的视锥体区域创建了对应的包围盒，图中的方向光会生成四个阴影贴图，每个包围盒决定了该阴影贴图的渲染范围。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240514173955-uo6og8c","Type":"NodeParagraph","Properties":{"id":"20240514173955-uo6og8c","updated":"20240514174054"},"Children":[{"Type":"NodeText","Data":"2006年Engel 、Lloyd等人、Zhang等人，根据这个相同的基本思想，独立进行了各自的研究；这个想法是在观察方向的垂直方向上，将视锥体划分成若干个区域，如上图。"}]},{"ID":"20240514174132-7arha90","Type":"NodeParagraph","Properties":{"id":"20240514174132-7arha90","updated":"20240514174201"},"Children":[{"Type":"NodeText","Data":"随着深度（距离相机的距离）的增加，每个视锥体区域的深度范围大约是前一个区域的2到3倍[430, 1962]。"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"对于每个划分后的视锥体区域，光源都可以生成一个紧密包裹该区域的视锥体，然后根据这个视锥体来生成阴影贴图"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。通过使用纹理图集（texture atlas）或者纹理数组（texture array），可以将不同区域的阴影贴图打包成一个较大的纹理对象，从而减少缓存访问所带来的延迟。图7.19展示了这种方法所带来的质量提升。Engel将这种算法的命名为"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"级联阴影贴图（cascade shadow maps，CSM）"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"，Zhang则将其称为"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"平行分割阴影贴图"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（parallel-split shadow maps），效果如下图："}]},{"ID":"20240514174201-te0noml","Type":"NodeParagraph","Properties":{"id":"20240514174201-te0noml","updated":"20240514174201"}},{"ID":"20240514174212-3h3rui9","Type":"NodeParagraph","Properties":{"id":"20240514174212-3h3rui9","updated":"20240514174300"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"20230611111822"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/20230611111822-20240514174212-7gkyryk.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"左图：场景的可见区域很大，导致单张阴影贴图使用了 2048 x 2048 的分辨率，从而避免透视走样（锯齿）。右图：在观察方向上使用了四个 1024 x 1024 的阴影贴图，大大提高了阴影的质量  。上图红框中展示了围栏前角的放大结果，可以看到右侧的阴影质量更高。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240514174248-51auuq4","Type":"NodeParagraph","Properties":{"id":"20240514174248-51auuq4","updated":"20240514174430"},"Children":[{"Type":"NodeText","Data":"这种算法的实现起来十分简单，它"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"能够覆盖较大范围的场景区域，并且可以得到合理的阴影结果，具有较强的健壮性"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。“视锥决斗（dueling frusta）”的问题也可以通过在靠近相机的位置上使用更高的采样率来解决，并且这种算法没有严重的最坏情况问题，也就是说，它在"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"几乎所有的光照条件和场景条件下都表现良好"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240514174436-qdu127v","Type":"NodeParagraph","Properties":{"id":"20240514174436-qdu127v","updated":"20240514174443"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240514174436-kho1efl.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"图7.20：阴影级联的可视化。图中紫色、绿色、黄色和红色分别代表了从近到远的四个级联阴影。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240514174443-cnp9lgf","Type":"NodeParagraph","Properties":{"id":"20240514174443-cnp9lgf","updated":"20240514174506"},"Children":[{"Type":"NodeText","Data":"虽然可以使用透视变形，来将更多的样本打包到单个阴影贴图的细分区域中，但是通用的做法是"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"为每个级联（cascade）使用单独的阴影贴图"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240514174607-nkred0j","Type":"NodeParagraph","Properties":{"id":"20240514174607-nkred0j","updated":"20240514174617"},"Children":[{"Type":"NodeText","Data":"从相机的视角来看，每个阴影贴图所覆盖的区域是不同的。较小的观察空间对应了更近的阴影贴图，它需要提供更多的样本。在不同的阴影贴图之间划分z深度的范围，这可能是一件既简单又复杂的任务，这个任务被称为"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"z划分"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（z-partitioning）。"}]},{"ID":"20240514174612-jv0i4kz","Type":"NodeParagraph","Properties":{"id":"20240514174612-jv0i4kz","updated":"20240514174625"},"Children":[{"Type":"NodeText","Data":"其中一种方法是使用对数划分方法，比例如下："}]},{"ID":"20240514174626-l6xrhrs","Type":"NodeMathBlock","Properties":{"id":"20240514174626-l6xrhrs","updated":"20240514174634"},"Children":[{"Type":"NodeMathBlockOpenMarker"},{"Type":"NodeMathBlockContent","Data":"r=\\sqrt[c]{\\dfrac{f}{n}}\n\\tag{7.5}"},{"Type":"NodeMathBlockCloseMarker"}]},{"ID":"20240514174634-trtvtmi","Type":"NodeParagraph","Properties":{"id":"20240514174634-trtvtmi","updated":"20240514174654"},"Children":[{"Type":"NodeText","Data":"对于每个级联阴影贴图而言，其远裁剪平面与近裁剪平面的距离之比是相同的，其中n是整个场景视锥体的近裁剪平面，f是整个场景视锥体的远裁剪平面；c是阴影贴图的数量，r是最终生成的比例。"}]},{"ID":"20240514174707-q3r2ety","Type":"NodeBlockquote","Properties":{"id":"20240514174707-q3r2ety","updated":"20240514174728"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240514174708-num9qqk","Type":"NodeParagraph","Properties":{"id":"20240514174708-num9qqk","updated":"20240514174728"},"Children":[{"Type":"NodeText","Data":"例如：如果场景中最靠近相机的物体深度为1米，最远离相机的物体深度为1000米，一共划分为三个阴影贴图，那么这个比例是"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"r=\\sqrt[3]{1000 / 1}=10"},{"Type":"NodeText","Data":"。也就是说，最近区域所对应的远近裁剪平面的深度分别是1和10，下一个区域是10和100，最后是100和1000米。初始的近裁剪平面深度，对这种划分方法有着很大的影响，如果近裁剪平面的深度仅为0.1米，那么10000的立方根将会达到21.54，这是一个相当高的比例，最终的深度划分为：0.1，2.154，46.42，1000。这意味着最后一个阴影贴图需要覆盖更大范围的区域，从而降低了精度和阴影的质量。"}]}]},{"ID":"20240514174818-0eff306","Type":"NodeParagraph","Properties":{"id":"20240514174818-0eff306","updated":"20240514180322"},"Children":[{"Type":"NodeText","Data":"在实际应用中，这种划分方法可以为近裁剪平面附近的区域提供了更大的阴影贴图分辨率（采样率），但是"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"如果该区域中没有物体的话，那么这个更大分辨率的阴影贴图就会被浪费"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240514180322-95yggdf","Type":"NodeParagraph","Properties":{"id":"20240514180322-95yggdf","updated":"20240514180336"},"Children":[{"Type":"NodeText","Data":"有一种方法是：将划分距离设置为对数分布（logarithmic distribution）和等距分布（equidistant distribution）的加权混合。"}]},{"ID":"20240514180336-humq4xb","Type":"NodeParagraph","Properties":{"id":"20240514180336-humq4xb","updated":"20240515093928"},"Children":[{"Type":"NodeText","Data":"这个问题的困难之处在于如何设置近裁剪平面的深度。"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"样本分布阴影贴图（SDSM）通过使用前一帧的深度划分值"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"，然后通过两种方法的其中一个确定一个更好的划分方式。"}]},{"ID":"20240514180612-fwmf2cg","Type":"NodeList","ListData":{},"Properties":{"id":"20240514180612-fwmf2cg","updated":"20240514181604"},"Children":[{"ID":"20240514180612-mnuadvv","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240514180612-mnuadvv","updated":"20240514180612"},"Children":[{"ID":"20240514180612-wno7fx1","Type":"NodeParagraph","Properties":{"id":"20240514180612-wno7fx1","updated":"20240514181205"},"Children":[{"Type":"NodeText","Data":"第一种是遍历深度的最小值和最大值，使用他们设置远近裁剪平面的深度。这可以通过GPU上的reduce操作来完成。其中计算着色器或其他着色器会对一系列越来越小的缓冲区进行分析，输出缓冲区会作为输入重新送入这个着色器，最终留下一个大小"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"1\\times1"},{"Type":"NodeText","Data":"的缓冲区。"}]},{"ID":"20240514181214-3kcn00y","Type":"NodeParagraph","Properties":{"id":"20240514181214-3kcn00y","updated":"20240514181218"},"Children":[{"Type":"NodeText","Data":"通常情况下，会根据场景中物体的移动速度，对这些值进行一点调整。如果不采取纠正措施的话，从屏幕边缘进入画面的物体，可能会对当前帧产生一些一些影响和问题，尽管这个问题在下一帧中就会被很快纠正。"}]}]},{"ID":"20240514181218-axr3t3v","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240514181218-axr3t3v","updated":"20240514181604"},"Children":[{"ID":"20240514181218-zq8xxpc","Type":"NodeParagraph","Properties":{"id":"20240514181218-zq8xxpc","updated":"20240514181604"},"Children":[{"Type":"NodeText","Data":"第二种方法对深度缓冲中的深度值分析并生成一个直方图，其中记录的深度值的分度。这个深度图除了寻找最合适的远近裁剪平面之外，还存在一些不包含任何物体和深度的间隙。通常会在实际包含物体的深度区间中进行划分，从而为级联阴影贴图提供更多的深度精度。"}]}]}]},{"ID":"20240514181607-s8b9zl7","Type":"NodeParagraph","Properties":{"id":"20240514181607-s8b9zl7","updated":"20240514181636"},"Children":[{"Type":"NodeText","Data":"实际中通常使用第一种方法，它速度很快（每帧通常在1ms内），并且能生产较好的结果，如下图："}]},{"ID":"20240514181641-6ogto91","Type":"NodeParagraph","Properties":{"id":"20240514181641-6ogto91","updated":"20240514181648"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240514181641-yo8fvft.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"图7.21：深度包围盒对阴影质量的影响。左图中，没有使用特殊处理来调整远近裁剪平面的深度。在右边，使用了SDSM方法来寻找更加紧密的包围盒。注意上图中左侧边缘附近的窗框、二楼花盆下方的区域、以及一楼的窗户，松散的视图包围盒会导致采样不足，从而产生了瑕疵和锯齿。指数划分的阴影贴图可以用于渲染这些特定的图像，但是提高深度精度的思路对所有的阴影贴图技术而言都是有效的。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240514181648-97hy81z","Type":"NodeParagraph","Properties":{"id":"20240514181648-97hy81z","updated":"20240514181750"},"Children":[{"Type":"NodeText","Data":"级联阴影贴图与使用单个阴影贴图具有一些相同的问题，由于光线样本会在帧与帧之间发生变化，从而产生闪烁瑕疵，并且当物体在级联之间进行移动的时候，这种问题可能会变得更加严重。"}]},{"ID":"20240514181752-mowjw7k","Type":"NodeParagraph","Properties":{"id":"20240514181752-mowjw7k","updated":"20240514181836"},"Children":[{"Type":"NodeText","Data":"有许多方法可以用来在世界空间保存稳定的采样点，每种方法都有各自的优点。"}]},{"ID":"20240514181837-qqnc1zt","Type":"NodeParagraph","Properties":{"id":"20240514181837-qqnc1zt","updated":"20240514181906"},"Children":[{"Type":"NodeText","Data":"当一个物体跨域两个级联阴影贴图的公共边界时，阴影的质量会发生突变，一种解决方法是"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"让划分的深度区域稍微重叠，位于重叠区域的样本会收集相邻阴影贴图的结果，并对其进行混合"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"；或者也可以使用抖动法（dithering），来在该区域内采集单个样本。"}]},{"ID":"20240514181903-1upf986","Type":"NodeParagraph","Properties":{"id":"20240514181903-1upf986","updated":"20240514182459"},"Children":[{"Type":"NodeText","Data":"此外还有一些可以进一步提高算法效率和质量的方法："}]},{"ID":"20240514182459-82dgucc","Type":"NodeList","ListData":{},"Properties":{"id":"20240514182459-82dgucc","updated":"20240514182648"},"Children":[{"ID":"20240514182648-f6p9gvz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240514182648-f6p9gvz","updated":"20240514182648"},"Children":[{"ID":"20240514182648-23fbvsl","Type":"NodeParagraph","Properties":{"id":"20240514182648-23fbvsl","updated":"20240514182648"},"Children":[{"Type":"NodeText","Data":"使用低层级细节（LOD）的模型来作为实际投射阴影的代理模型。"}]}]}]},{"ID":"20240514182635-lr0ggm2","Type":"NodeList","ListData":{},"Properties":{"id":"20240514182635-lr0ggm2","updated":"20240514183255"},"Children":[{"ID":"20240514182650-auugrum","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240514182650-auugrum","updated":"20240514182650"},"Children":[{"ID":"20240514182650-ttoiutu","Type":"NodeParagraph","Properties":{"id":"20240514182650-ttoiutu","updated":"20240514182650"},"Children":[{"Type":"NodeText","Data":"移除那些很小的遮挡物。"}]}]},{"ID":"20240514183140-dlf7t2w","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240514183140-dlf7t2w"},"Children":[{"ID":"20240514183140-27rc2av","Type":"NodeParagraph","Properties":{"id":"20240514183140-27rc2av","updated":"20240514183201"},"Children":[{"Type":"NodeText","Data":"位于较远处的阴影也不需要每帧都进行更新，因为在理论上而言，这类阴影对于视觉感知的重要性很低；"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"但是当一些很大的物体在远处移动时，这个想法可能会产生一些瑕疵"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"}]}]},{"ID":"20240514183205-32k23n6","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240514183205-32k23n6"},"Children":[{"ID":"20240514183205-opn7qim","Type":"NodeParagraph","Properties":{"id":"20240514183205-opn7qim","updated":"20240514183213"},"Children":[{"Type":"NodeText","Data":"将远处阴影贴图在帧与帧之间进行重复使用的想法，这个想法的依据是，静态阴影贴图中的大部分内容，在帧与帧之间都是相同的，可以重复使用，只有阴影的边缘部分可能会发生变化，因此这部分需要重新渲染。"}]}]},{"ID":"20240514183225-ai972db","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240514183225-ai972db"},"Children":[{"ID":"20240514183225-t3lgy24","Type":"NodeParagraph","Properties":{"id":"20240514183225-t3lgy24","updated":"20240514183225"},"Children":[{"Type":"NodeText","Data":"维护了一个巨大的阴影贴图图集，只在物体发生移动的地方重新生成阴影贴图即可"}]}]},{"ID":"20240514183235-l8c2frb","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240514183235-l8c2frb"},"Children":[{"ID":"20240514183235-07yci76","Type":"NodeParagraph","Properties":{"id":"20240514183235-07yci76","updated":"20240514183235"},"Children":[{"Type":"NodeText","Data":"对于更远的级联阴影贴图，可以让其完全忽略动态物体，因为这些物体的阴影对于场景感知的贡献很少。"}]}]},{"ID":"20240514183249-6r0atje","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240514183249-6r0atje","updated":"20240514183255"},"Children":[{"ID":"20240514183249-c5ypcsy","Type":"NodeParagraph","Properties":{"id":"20240514183249-c5ypcsy","updated":"20240514183255"},"Children":[{"Type":"NodeText","Data":"对于一些大场景而言，可能会有一个十分巨大的静态阴影贴图，在这种情况下，可以使用一个稀疏纹理系统(Ref 19.10.1)"}]}]}]},{"ID":"20240514182911-qdl5mdu","Type":"NodeParagraph","Properties":{"id":"20240514182911-qdl5mdu","updated":"20240514183358"},"Children":[{"Type":"NodeText","Data":"生成若干个独立的阴影贴图意味着要为每个贴图都渲染一组几何图形。有个想法是在单个pass中，将遮挡物渲染到一组阴影贴图中，有许多提高效率的方法都是建立在这个想法上的。"}]},{"ID":"20240514183409-9qrwb0i","Type":"NodeParagraph","Properties":{"id":"20240514183409-9qrwb0i","updated":"20240514183416"},"Children":[{"Type":"NodeText","Data":"可以使用几何着色器来复制物体数据，并将其发送到多个视图中；实例化的几何着色器允许一个物体输出到多达32个深度纹理中。"}]},{"ID":"20240514183416-u6tdr0f","Type":"NodeParagraph","Properties":{"id":"20240514183416-u6tdr0f","updated":"20240514183527"},"Children":[{"Type":"NodeText","Data":"此外还有使用相机的遮挡剔除（Ref 19.7），入口剔除（Ref 19.5）等方法。"}]},{"ID":"20240514183527-5cs5c19","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240514183527-5cs5c19","updated":"20240515093749"},"Children":[{"Type":"NodeText","Data":"7.5 PCF"}]},{"ID":"20240514183531-g25rvf9","Type":"NodeParagraph","Properties":{"id":"20240514183531-g25rvf9","updated":"20240515081539"},"Children":[{"Type":"NodeText","Data":"对阴影贴图技术进行简单的扩展，我们就可以获得质量不错的伪软阴影效果。"}]},{"ID":"20240515081540-ubmrgtm","Type":"NodeParagraph","Properties":{"id":"20240515081540-ubmrgtm","updated":"20240515081630"},"Children":[{"Type":"NodeText","Data":"在对阴影贴图进行检索的时候，并不是简单地从阴影贴图中取出对应的单个样本，而是会检索4个最近的样本。不同的是，这里的所提到的方法并不会在这些深度值之间进行插值，而是先将它们与表面深度进行比较，然后在对比较的结果进行插值。也就是说，"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"这四个纹理样本的深度会先与表面深度进行比较，然后确定每个样本点到底是位于光照区域还是阴影区域"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。我们使用0来代表位于阴影区域，1来代表位于光照区域，然后再对这个0-1结果进行双线性插值，从而计算光源对于该表面位置的实际贡献有多大。这种过滤的结果会产生人为的软阴影，这些半影效果的变化取决于阴影贴图的分辨率、相机的位置以及其他的一些因素。"}]},{"ID":"20240515081630-xyttxaf","Type":"NodeParagraph","Properties":{"id":"20240515081630-xyttxaf","updated":"20240515081741"},"Children":[{"Type":"NodeText","Data":"这种从阴影贴图检索多个样本并将结果混合的想法称为"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"百分比滤波法"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（PCF, Percentage-Closer Filtering）。"}]},{"ID":"20240515081741-lcib0tm","Type":"NodeParagraph","Properties":{"id":"20240515081741-lcib0tm","updated":"20240515081823"},"Children":[{"Type":"NodeText","Data":"面光源可以产生柔和的软阴影效果，到达表面上某个位置的光线数量，与该位置所能看见的光源面积大小成比例。PCF算法试图通过反转这个过程，来对一个精确光源或者方向光的软阴影进行近似。"}]},{"ID":"20240515081900-s6okr0u","Type":"NodeParagraph","Properties":{"id":"20240515081900-s6okr0u","updated":"20240515081906"},"Children":[{"Type":"NodeText","Data":"PCF并没有从一个表面位置上来计算光源可见区域的面积，而是从靠近该位置的一组表面位置上，来计算精确光源的可见性。"}]},{"ID":"20240515081909-6mu1790","Type":"NodeParagraph","Properties":{"id":"20240515081909-6mu1790","updated":"20240515082448"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240515081909-uwmbsjq.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240515081915-75xjz7n","Type":"NodeParagraph","Properties":{"id":"20240515081915-75xjz7n","updated":"20240515081921"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"图7.22：左图中，来自面光源的棕色线代表了半影的范围。对于阴影接收物上的点 "},{"Type":"NodeTextMark","TextMarkType":"code inline-math","TextMarkInlineMathContent":"\\mathbf{p}"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":" ，可以对面光源表面进行采样，并通过计算哪些采样点没有被遮挡物遮挡，从而获得该点所接收到的光线数量。右图中的点光源并不会产生半影现象。PCF通过反转左图中过程，来对面光源效果进行近似：在给定的位置上，对阴影贴图附近的可比较区域进行采样，从而计算有多少样本会被照亮（百分比）。图中红色椭圆代表了在阴影贴图上进行采样的区域，在理想情况下，这个圆形区域的半径，与接收物和遮挡物之间的距离成正比。"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515081921-85iu09v","Type":"NodeParagraph","Properties":{"id":"20240515081921-85iu09v","updated":"20240515082102"},"Children":[{"Type":"NodeText","Data":"在PCF算法中，这些"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"计算光源可见性的样本位置在原始位置附近生成的，它们都具有大致相同的深度值，但是对应了阴影贴图中不同位置的纹素。会在这些位置上计算光源的可见性，然后再对生成的布尔结果（被光源照亮或者不会被光源照亮）进行混合，从而获得软阴影的效果"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240515082103-8nj93c3","Type":"NodeBlockquote","Properties":{"id":"20240515082103-8nj93c3","updated":"20240515082114"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240515082110-lo414ac","Type":"NodeParagraph","Properties":{"id":"20240515082110-lo414ac","updated":"20240515082114"},"Children":[{"Type":"NodeText","Data":"需要注意的是，这个过程并不是物理正确的：我们并没有直接对光源进行采样，而是对表面本身进行采样，再计算可见性百分比。由于表面与遮挡物之间的距离并不会对阴影结果产生影响，因此所生成的软阴影都具有尺寸相似的半影区域。尽管如此，这种方法在大多数情况下都可以提供一个合理的近似效果。"}]}]},{"ID":"20240515082117-1zkjx03","Type":"NodeParagraph","Properties":{"id":"20240515082117-1zkjx03","updated":"20240515082141"},"Children":[{"Type":"NodeText","Data":"那么，如何以避免锯齿瑕疵的方式进行采样呢？"}]},{"ID":"20240515082256-cphxd2c","Type":"NodeParagraph","Properties":{"id":"20240515082256-cphxd2c","updated":"20240515082300"},"Children":[{"Type":"NodeText","Data":"采样区域的宽度、采集的样本数量、采样的模式以及如何对结果进行加权等。"}]},{"ID":"20240515082330-dqmal4j","Type":"NodeParagraph","Properties":{"id":"20240515082330-dqmal4j","updated":"20240515082330"},"Children":[{"Type":"NodeText","Data":"在图形API支持功能较少的情况下，可以采用一种类似于双线性插值的特殊纹理采样模式，通过访问相邻的4个位置来加速采样过程。"}]},{"ID":"20240515082331-88o7h8c","Type":"NodeBlockquote","Properties":{"id":"20240515082331-88o7h8c","updated":"20240515082345"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240515082332-7335l5h","Type":"NodeParagraph","Properties":{"id":"20240515082332-7335l5h","updated":"20240515082345"},"Children":[{"Type":"NodeText","Data":"在获得样本值之后，我们首先会将各个样本值与一个给定的值进行比较，计算通过测试的比例，然后再对结果进行混合。"}]}]},{"ID":"20240515082414-6gyxm8h","Type":"NodeParagraph","Properties":{"id":"20240515082414-6gyxm8h","updated":"20240515082416"},"Children":[{"Type":"NodeText","Data":"但是规则采样所带来的锯齿瑕疵仍然无法解决。为了最小化规则采样所带来的问题，其中一种解决方案是使用一个预先计算好的泊松分布模式来对区域进行采样："}]},{"ID":"20240515082423-22d71fb","Type":"NodeParagraph","Properties":{"id":"20240515082423-22d71fb","updated":"20240515082458"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"图7.23：最左边的图片展示了 4×4 网格模式下，使用最近邻居采样的PCF结果。最右边的图片展示了圆盘上包含12个点的泊松采样模式，使用这种模式对阴影贴图进行采样，可以获得稍微改进的结果（第二张图片），但是仍然可以看到一些锯齿。在第三张图片中，采样模式围绕中心进行逐像素的随机旋转，可以看到结构化阴影锯齿变成了噪声（不那么令人反感）。"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240515082423-wf12gc5.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"图7.23：最左边的图片展示了 4×4 网格模式下，使用最近邻居采样的PCF结果。最右边的图片展示了圆盘上包含12个点的泊松采样模式，使用这种模式对阴影贴图进行采样，可以获得稍微改进的结果（第二张图片），但是仍然可以看到一些锯齿。在第三张图片中，采样模式围绕中心进行逐像素的随机旋转，可以看到结构化阴影锯齿变成了噪声（不那么令人反感）。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240515082429-j7zekg5","Type":"NodeParagraph","Properties":{"id":"20240515082429-j7zekg5","updated":"20240515082617"},"Children":[{"Type":"NodeText","Data":"泊松分布会将样本分散开来，使它们既不相互靠近，也会不处于规则模式。代价是会产生噪声问题。"}]},{"ID":"20240515082650-jfh12t7","Type":"NodeParagraph","Properties":{"id":"20240515082650-jfh12t7","updated":"20240515082651"},"Children":[{"Type":"NodeText","Data":"自阴影问题和漏光问题，即阴影痤疮和Peter Panning，在PCF中会变得更加糟糕。"}]},{"ID":"20240515082703-wxwmn8o","Type":"NodeParagraph","Properties":{"id":"20240515082703-wxwmn8o","updated":"20240515082707"},"Children":[{"Type":"NodeText","Data":"假设样本在阴影贴图上所占据的大小不超过一个纹素，那么斜率修正偏移仅仅会根据表面与光源的夹角，来使得表面稍稍远离光源。"}]},{"ID":"20240515082715-7orcxlr","Type":"NodeParagraph","Properties":{"id":"20240515082715-7orcxlr","updated":"20240515082715"},"Children":[{"Type":"NodeText","Data":"此时如果表面上单个位置在更大的区域内进行采样，会导致一些测试样本被真实表面所遮挡。"}]},{"ID":"20240515082722-bi0vpx6","Type":"NodeParagraph","Properties":{"id":"20240515082722-bi0vpx6","updated":"20240515082805"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"偏移锥"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（bias cone）可以一定程度上减少自阴影问题出现的概率，每个测试样本都会根据自身与原始样本的距离，来成比例地向光源进行移动。Burley建议将比例系数设置为2.0，并添加一个较小的恒定偏移量。"}]},{"ID":"20240515082808-a4opuuc","Type":"NodeParagraph","Properties":{"id":"20240515082808-a4opuuc","updated":"20240515083733"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240515082808-nulcaqd.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"图7.24：额外的阴影偏移方法。对于PCF，会在原始样本位置（即图中五个点的中心位置）周围采集几个测试样本，所有的样本都应当被照亮。在左图中，会构建一个锥形的偏移量，并将样本向上移动。可以进一步增加这个锥形的陡峭程度，从而将位于右侧的样本上移足够的高度，使其能够被照亮；但这样做的风险是，其他真正被阴影所覆盖的样本位置（图中未显示）可能会发生漏光。在中间，所有的样本都被移动到了接收表面所在的平面上，这种方法对于凸面的效果很好，但是对于凹面可能会适得其反，如左侧所示。右图中，法线偏移会使得样本沿着表面的法线方向进行移动，移动的距离与表面法线和光线方向之间夹角的正弦值成正比。对于中心样本而言，可以认为是将其移动到位于原始表面上方的一个假想表面上，这种偏移方式不仅会影响样本的深度值（前面两种偏移方法也会影响），还会改变用于测试阴影贴图的纹理坐标（即向水平方向发生了移动）。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515082815-x5wwouu","Type":"NodeParagraph","Properties":{"id":"20240515082815-x5wwouu","updated":"20240515083510"},"Children":[{"Type":"NodeText","Data":"还可以根据接收物表面本身的斜率，调整剩余样本的深度值。这类技术被称为"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"接收物平面深度偏移（receiver plane depth bias）"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。它在许多情况下都十分精确，因为"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"位于这个假想平面上的样本位置确实位于表面上"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"；如果模型是凸的话，那么这个假想平面会位于原始表面的前方（法线方向）。"}]},{"ID":"20240515083427-48x9b2b","Type":"NodeParagraph","Properties":{"id":"20240515083427-48x9b2b","updated":"20240515083645"},"Children":[{"Type":"NodeText","Data":"PCF算法存在这样的一个问题，由于每个采样区域的宽度保持不变，因此阴影会表现出均匀柔和的外观，即"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"所有阴影区域都具有相同的半影宽度"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。如下："}]},{"ID":"20240515083652-3hdsue5","Type":"NodeParagraph","Properties":{"id":"20240515083652-3hdsue5","updated":"20240515083658"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240515083652-l64gdsx.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"图7.25：PCF和PCSS。左图中，使用了一点点PCF滤波后的硬阴影。中间的图展示了由PCF生成的、具有恒定柔和宽度的软阴影。右图中，在物体与地面相接触的地方，PCSS具有适当硬度的、可变宽度的软阴影效果。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240515083658-rx7ca29","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515083658-rx7ca29","updated":"20240515093749"},"Children":[{"Type":"NodeText","Data":"7.6 PCSS"}]},{"ID":"20240515083800-uocck1d","Type":"NodeParagraph","Properties":{"id":"20240515083800-uocck1d","updated":"20240515083813"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"百分比接近软阴影"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（percentage-closer soft shadow，PCSS）试图通过对阴影贴图上的附近区域进行搜索，来找到所有可能的遮挡物，并使用这些遮挡物与表面位置的平均距离，来决定采样区域的宽度，其方程如下："}]},{"ID":"20240515083812-59bwvpy","Type":"NodeMathBlock","Properties":{"id":"20240515083812-59bwvpy","updated":"20240515083825"},"Children":[{"Type":"NodeMathBlockOpenMarker"},{"Type":"NodeMathBlockContent","Data":"w_{\\text {sample }}=w_{\\text {light }} \\frac{d_{r}-d_{o}}{d_{o}}\n\\tag{7.6}"},{"Type":"NodeMathBlockCloseMarker"}]},{"ID":"20240515083826-zh7gntp","Type":"NodeParagraph","Properties":{"id":"20240515083826-zh7gntp","updated":"20240515083904"},"Children":[{"Type":"NodeText","Data":"其中"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"d_r"},{"Type":"NodeText","Data":"是接收物到光源的距离，"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"d_o"},{"Type":"NodeText","Data":"是遮挡物到光源的平均距离。换句话说，"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"随着遮挡物到接收物的平均距离越远（遮挡物距离光源越来越近，"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"inline-math text","TextMarkInlineMathContent":"d_o"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"变小），表面采样区域的宽度就越大"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240515083905-ukj862i","Type":"NodeParagraph","Properties":{"id":"20240515083905-ukj862i","updated":"20240515083945"},"Children":[{"Type":"NodeText","Data":"如果没有发现遮挡物，那么该位置会被光源完全照亮，不需要任何进一步的处理；同样的，如果该位置被完全遮挡，那么也不需要进行后续处理。"}]},{"ID":"20240515083952-rlvnmob","Type":"NodeParagraph","Properties":{"id":"20240515083952-rlvnmob","updated":"20240515084004"},"Children":[{"Type":"NodeText","Data":"在其他情况下，我们需要对感兴趣的区域进行采样，并计算光源的近似贡献。为了降低计算成本，我们可以根据采样区域的宽度，来动态调整采样的数量。"}]},{"ID":"20240515084011-3hfdf48","Type":"NodeParagraph","Properties":{"id":"20240515084011-3hfdf48","updated":"20240515084016"},"Children":[{"Type":"NodeText","Data":"PCSS的一个缺点是，它"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"需要在阴影贴图中一个较大的区域范围内进行采样，从而寻找遮挡物的平均深度"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240515084016-f04142j","Type":"NodeParagraph","Properties":{"id":"20240515084016-f04142j","updated":"20240515084042"},"Children":[{"Type":"NodeText","Data":"使用上一小节中提到的旋转泊松圆盘采样模式，可以帮助隐藏欠采样导致的锯齿瑕疵。"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"泊松采样在运动情况下可能是不稳定的"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240515084118-nu16p7j","Type":"NodeParagraph","Properties":{"id":"20240515084118-nu16p7j","updated":"20240515084223"},"Children":[{"Type":"NodeText","Data":"接触硬化阴影（contact hardening shadows，CHS）可以更快的视线PCSS，还解决了基础PCSS的另一个问题："},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"半影区域的大小会受到阴影贴图分辨率的影响"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。如图7.25。可以通过首先生成阴影贴图的mipmap，然后选择最接近于（由用户定义）世界空间尺度的mipmap层级，来最小化这个问题。"}]},{"ID":"20240515084213-sekxm1j","Type":"NodeParagraph","Properties":{"id":"20240515084213-sekxm1j","updated":"20240515084532"},"Children":[{"Type":"NodeText","Data":"该算法会对8 × 8的区域进行采样，从而找到平均遮挡物深度，这个操作只需要16次"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\text {GatherRed()}"},{"Type":"NodeText","Data":"纹理调用即可。一旦计算出了半影区域的估计，就可以使用较高分辨率的mipmap来渲染较硬的阴影，使用较低分辨率的mipmap来渲染较软的阴影。"}]},{"ID":"20240515084146-pjrm66w","Type":"NodeParagraph","Properties":{"id":"20240515084146-pjrm66w","updated":"20240515084603"},"Children":[{"Type":"NodeText","Data":"CHS算法已被大量电子游戏采用，其外还有SSSM等方法。"}]},{"ID":"20240515084603-6flqo9k","Type":"NodeParagraph","Properties":{"id":"20240515084603-6flqo9k","updated":"20240515084619"},"Children":[{"Type":"NodeText","Data":"对于那些每个像素采样多个样本（多spp）的算法，有一个已被证明的、可以用于加速计算的概念是分层最小/最大阴影贴图（hierarchical min/max shadow map）。"}]},{"ID":"20240515084641-by4ypd1","Type":"NodeParagraph","Properties":{"id":"20240515084641-by4ypd1","updated":"20240515084653"},"Children":[{"Type":"NodeText","Data":"可以生成两组mipmap，其中一个用于保存每个区域中的最大z-depth（这个mipmap有时会称为"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"HiZ，层次z缓冲"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"），另一个则用于保存每个区域中的最小z-depth。对于给定的采样位置、深度以及采样区域，这两个mipmap可以用于快速判断待测样本是完全光照的还是完全阴影的。"}]},{"ID":"20240515084646-wxy1ubw","Type":"NodeBlockquote","Properties":{"id":"20240515084646-wxy1ubw","updated":"20240515085344"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240515085335-r3z2cuk","Type":"NodeParagraph","Properties":{"id":"20240515085335-r3z2cuk","updated":"20240515085344"},"Children":[{"Type":"NodeText","Data":"例如：如果待测样本的z-depth，大于mipmap相应区域中存储的最大z-depth，那么则说明该样本一定位于阴影中，因此不需要对其进行后续的采样。这种类型的阴影贴图可以使得计算光源可见性的任务变得更加高效"}]}]},{"ID":"20240515085345-00z9f5f","Type":"NodeParagraph","Properties":{"id":"20240515085345-00z9f5f","updated":"20240515085359"},"Children":[{"Type":"NodeText","Data":"PCF方法通过对附近的接收物位置进行采样，来计算光照百分比，从而模拟软阴影效果。PCSS方法通过找到附近遮挡物的平均深度，从而决定测试样本的采样区域宽度。这些算法都会受到阴影贴图分辨率的影响。"}]},{"ID":"20240515085443-dpt5314","Type":"NodeParagraph","Properties":{"id":"20240515085443-dpt5314","updated":"20240515085455"},"Children":[{"Type":"NodeText","Data":"PCSS背后的主要假设是："},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"平均遮挡物深度是一个对半影区域大小的合理估计"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。但是当两个遮挡物（例如路灯和远处的山）都部分遮挡了同一个像素时，上述假设就不成立了，并且可能会导致瑕疵。"}]},{"ID":"20240515085456-lo4029d","Type":"NodeParagraph","Properties":{"id":"20240515085456-lo4029d","updated":"20240515085536"},"Children":[{"Type":"NodeText","Data":"此外还有使用GPU实现反向投影的方法，但是此方法开销太大，目前没有在实时应用程序的应用。"}]},{"ID":"20240515085539-c9eq1pk","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515085539-c9eq1pk","updated":"20240515090122"},"Children":[{"Type":"NodeText","Data":"7.7 过滤阴影贴图"}]},{"ID":"20240515085546-kpj8wjh","Type":"NodeParagraph","Properties":{"id":"20240515085546-kpj8wjh","updated":"20240515085621"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"方差阴影贴图（variance shadow map，VSM）"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"，该方法"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"允许对生成后的阴影贴图进行过滤操作"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240515085623-w24h49k","Type":"NodeParagraph","Properties":{"id":"20240515085623-w24h49k","updated":"20240515085623"},"Children":[{"Type":"NodeText","Data":"该算法将原始深度值存储在一个贴图中，并将原始深度值的平方存储在另一个贴图中。在生成这些贴图的时候，可以使用MSAA或者其他的抗锯齿技术。"}]},{"ID":"20240515085704-7bxra8m","Type":"NodeParagraph","Properties":{"id":"20240515085704-7bxra8m","updated":"20240515085742"},"Children":[{"Type":"NodeText","Data":"首先，VSM算法会在接收物的表面位置处，对深度图进行一次采样，从而返回最近遮挡物的平均深度，我们将这个平均深度称为"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"一阶矩（first moment）"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"，记作"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"M_1"},{"Type":"NodeText","Data":"。当"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"M_1"},{"Type":"NodeText","Data":"大于阴影接收物"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"t"},{"Type":"NodeText","Data":"的深度时，则认为该接收物位置完全处于光照中；当"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"M_1"},{"Type":"NodeText","Data":"小于阴影接收物t的深度时，则使用以下方程："}]},{"ID":"20240515085704-evbww5p","Type":"NodeMathBlock","Properties":{"id":"20240515085704-evbww5p","updated":"20240515085704"},"Children":[{"Type":"NodeMathBlockOpenMarker"},{"Type":"NodeMathBlockContent","Data":"p_{\\max }(t)=\\frac{\\sigma^{2}}{\\sigma^{2}+\\left(t-M_{1}\\right)^{2}} \\tag{7.7}"},{"Type":"NodeMathBlockCloseMarker"}]},{"ID":"20240515085704-vmqt2ym","Type":"NodeParagraph","Properties":{"id":"20240515085704-vmqt2ym","updated":"20240515085823"},"Children":[{"Type":"NodeText","Data":"其中"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"p_{\\max }"},{"Type":"NodeText","Data":"代表了位于光照下的样本最大百分比，"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"\\sigma^{2}"},{"Type":"NodeText","Data":"代表了方差，"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"t"},{"Type":"NodeText","Data":"是阴影接受物的深度，"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"M_1"},{"Type":"NodeText","Data":"阴影贴图中的平均期望深度。上文中我们提到VSM还会生成一个贴图用于存储阴影贴图深度值的平方，我们将这个贴图中的样本称为"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"二阶矩"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（second moment），记作"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"M_2"},{"Type":"NodeText","Data":"，我们使用"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"M_1"},{"Type":"NodeText","Data":"和"},{"Type":"NodeTextMark","TextMarkType":"inline-math","TextMarkInlineMathContent":"M_2"},{"Type":"NodeText","Data":"来计算方差，方程如下："}]},{"ID":"20240515085704-5m95vkp","Type":"NodeMathBlock","Properties":{"id":"20240515085704-5m95vkp","updated":"20240730095344"},"Children":[{"Type":"NodeMathBlockOpenMarker"},{"Type":"NodeMathBlockContent","Data":"\\sigma^{2}=M_{2}-M_{1}^{2} \\tag{7.8}"},{"Type":"NodeMathBlockCloseMarker"}]},{"ID":"20240515085704-swcznmn","Type":"NodeParagraph","Properties":{"id":"20240515085704-swcznmn","updated":"20240515085948"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"strong inline-math text","TextMarkInlineMathContent":"p_{\\max }"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"代表了接收物可见性百分比的上界，实际使用的光照百分比"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"strong text","TextMarkTextContent":"p"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"不能大于这个值"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。这个上界来自于Chebyshev's inequality（切比雪夫不等式）的单侧变体，这个方程试图使用概率论中的方法，来"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"估计表面位置上的遮挡物分布有多少超出了表面到光源的距离"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。Donnelly和Lauritzen证明了，对于具有固定深度的平面遮挡物和平面接收物而言，"},{"Type":"NodeTextMark","TextMarkType":"strong inline-math","TextMarkInlineMathContent":"p=p_{\\max }"},{"Type":"NodeText","Data":"；因此方程7.7可以作为对许多真实阴影的良好近似。"}]},{"ID":"20240515085927-kvqg7s3","Type":"NodeParagraph","Properties":{"id":"20240515085927-kvqg7s3","updated":"20240515090117"},"Children":[{"Type":"NodeText","Data":"下图展示了VSM与其他算法对比的效果："}]},{"ID":"20240515090120-l2nnxrv","Type":"NodeParagraph","Properties":{"id":"20240515090120-l2nnxrv","updated":"20240515090122"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240515090120-a3ma7dz.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515090034-ek2mjeu","Type":"NodeParagraph","Properties":{"id":"20240515090034-ek2mjeu","updated":"20240515090126"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"图7.26：左上角：标准的阴影映射。右上角：透视阴影映射，在靠近观察者的地方增加了阴影贴图的纹素密度。左下角：PCSS，随着遮挡物与接收物之间的距离增加，阴影会逐渐软化。右下角：VSM，它具有恒定的软阴影宽度，每个像素仅使用了一个方差贴图的样本来进行渲染。"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515090126-kgrm041","Type":"NodeParagraph","Properties":{"id":"20240515090126-kgrm041","updated":"20240515090224"},"Children":[{"Type":"NodeText","Data":"VSM的一个重要特点是，它"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"可以以一种十分优雅的方式，来处理由几何形状导致的表面偏差问题"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240515090225-taeve8a","Type":"NodeParagraph","Properties":{"id":"20240515090225-taeve8a","updated":"20240515090235"},"Children":[{"Type":"NodeText","Data":"VSM的一个缺点是，数值稳定性可能会导致一些偏差和其他问题，例如：方程7.8中使用一个相似的值来减去另一个较大的值，这种类型的计算往往会加剧数值精度不足的问题，可以通过使用浮点纹理来避免这个问题。"}]},{"ID":"20240515090253-o3z9nhq","Type":"NodeParagraph","Properties":{"id":"20240515090253-o3z9nhq","updated":"20240515090309"},"Children":[{"Type":"NodeText","Data":"总的来说，"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"VSM算法可以在处理时间相同的情况下，显著提高阴影质量"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240515090452-fy3mpi4","Type":"NodeParagraph","Properties":{"id":"20240515090452-fy3mpi4","updated":"20240515090456"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"202306121125987"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/202306121125987-20240515090452-46vrarr.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240515090503-78pj9uy","Type":"NodeParagraph","Properties":{"id":"20240515090503-78pj9uy","updated":"20240515090503"},"Children":[{"Type":"NodeText","Data":"图7.27：方差阴影映射（VSM），其中遮挡物到光源的距离，从左到右逐渐增加。"}]},{"ID":"20240515090511-6lh1p3q","Type":"NodeParagraph","Properties":{"id":"20240515090511-6lh1p3q","updated":"20240515090537"},"Children":[{"Type":"NodeText","Data":"上图是利用SAT（面积积分表）来生成质量更好的阴影的效果。"}]},{"ID":"20240515090622-dbsh8xo","Type":"NodeParagraph","Properties":{"id":"20240515090622-dbsh8xo","updated":"20240515090738"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"当两个或者两个以上的遮挡物覆盖同一个接收物，并且其中一个遮挡物十分靠近接收物时"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"，方差阴影映射（VSM）的半影区域会失效。如下图："}]},{"ID":"20240515090755-vbi90k2","Type":"NodeParagraph","Properties":{"id":"20240515090755-vbi90k2","updated":"20240515090756"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"image"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/image-20240515090755-h82p5f6.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240515090759-jieqwij","Type":"NodeParagraph","Properties":{"id":"20240515090759-jieqwij","updated":"20240515090759"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"图7.28：左图：使用了VSM来生成茶壶的阴影。右图：一个位于上方的三角形（未显示在图中）在茶壶上投射下阴影，产生了令人反感的阴影瑕疵。"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515090800-jiaq2gr","Type":"NodeParagraph","Properties":{"id":"20240515090800-jiaq2gr","updated":"20240515090820"},"Children":[{"Type":"NodeText","Data":"通过在更小的区域上采集更多的样本，可以将VSM转化为PCF的形式，从而解决这个问题。这需要对性能和质量进行权。"}]},{"ID":"20240515090854-lnjavie","Type":"NodeParagraph","Properties":{"id":"20240515090854-lnjavie","updated":"20240515090854"}},{"ID":"20240515090812-zpcosux","Type":"NodeParagraph","Properties":{"id":"20240515090812-zpcosux","updated":"20240515090859"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"滤波阴影映射"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"能够使用滤波技术来快速生成平滑的阴影，该技术最主要的挑战就是解决各种漏光问题。"}]},{"ID":"20240515090900-fhpgt83","Type":"NodeParagraph","Properties":{"id":"20240515090900-fhpgt83","updated":"20240515090917"},"Children":[{"Type":"NodeText","Data":"卷积阴影贴图（convolution shadow map），在傅里叶展开中，对阴影深度进行编码。与VSM算法一样，这种贴图也可以被过滤，这个方法最终会收敛到正确的阴影效果，从而减少了漏光问题。"}]},{"ID":"20240515090946-hue7ajp","Type":"NodeParagraph","Properties":{"id":"20240515090946-hue7ajp","updated":"20240515091029"},"Children":[{"Type":"NodeText","Data":"卷积阴影映射的一个缺点是，它"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"需要对若干项进行计算和访问，这大大增加了计算成本和存储成本"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240515091030-tt4cm3t","Type":"NodeParagraph","Properties":{"id":"20240515091030-tt4cm3t","updated":"20240515091153"},"Children":[{"Type":"NodeText","Data":"可以基于"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"指数函数来使用单个项的想法，这种方法被称为指数阴影贴图"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（exponential shadow map，ESM），这种方法会将深度值的指数，及其二阶矩存储到两个缓冲区中。"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"指数函数更接近于阴影贴图测试时的阶跃函数"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（即在光照中或者不在光照中），因此它可以显著降低漏光瑕疵。"}]},{"ID":"20240515091121-eta1qb3","Type":"NodeParagraph","Properties":{"id":"20240515091121-eta1qb3","updated":"20240515091212"},"Children":[{"Type":"NodeText","Data":"存储指数会由一个限制，就是其二阶矩的数值可能会非常大，有可能会超出浮点数的范围。"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"为了提高精度，并让指数函数下降得更快，可以生成z-depth，因为这个深度值是线性的"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240515091212-avm8dtf","Type":"NodeParagraph","Properties":{"id":"20240515091212-avm8dtf","updated":"20240515091222"},"Children":[{"Type":"NodeText","Data":"与VSM相比，指数阴影映射（ESM）的质量有所提高；并且与卷积阴影贴图相比，它所占用的存储空间更低，性能更好。"}]},{"ID":"20240515091254-0ivh8nj","Type":"NodeParagraph","Properties":{"id":"20240515091254-0ivh8nj","updated":"20240515091308"},"Children":[{"Type":"NodeText","Data":"级联阴影贴图技术也可以应用于滤波贴图，从而提高精度。与标准的级联阴影贴图相比，级联ESM的一个优点在于，"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"可以为所有级联设置相同的偏移因子"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240515091328-mqlyugu","Type":"NodeParagraph","Properties":{"id":"20240515091328-mqlyugu","updated":"20240515091356"},"Children":[{"Type":"NodeText","Data":"滤波贴图可以被认为是一种廉价形式的PCF，它只需要很少的样本；与PCF一样，这样产生的阴影具有恒定的半影宽度。"}]},{"ID":"20240515091400-95x90bh","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515091400-95x90bh","updated":"20240515093749"},"Children":[{"Type":"NodeText","Data":"7.8 体积阴影技术"}]},{"ID":"20240515091407-0b3u2um","Type":"NodeParagraph","Properties":{"id":"20240515091407-0b3u2um","updated":"20240515091647"},"Children":[{"Type":"NodeText","Data":"透明物体会衰减并改变光线的颜色。"}]},{"ID":"20240515091653-z16br5u","Type":"NodeParagraph","Properties":{"id":"20240515091653-z16br5u","updated":"20240515091653"},"Children":[{"Type":"NodeText","Data":"自阴影问题对于头发、云等物体的真实感渲染而言至关重要，因为这些物体要么是很小的，要么是半透明的，单一深度的阴影贴图无法用于处理这些情况。"}]},{"ID":"20240515091711-v9iogi3","Type":"NodeParagraph","Properties":{"id":"20240515091711-v9iogi3","updated":"20240515091807"},"Children":[{"Type":"NodeText","Data":"这里可用的的有深度阴影贴图（deep shadow map）、自适应体积阴影题图（adaptive volumetric shadow map）、不透明度阴影贴图（opacity shadow map）等方法。"}]},{"ID":"20240515091815-u5uf16u","Type":"NodeParagraph","Properties":{"id":"20240515091815-u5uf16u","updated":"20240515091825"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"202306121618565"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/202306121618565-20240515091815-wtrxmpa.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"使用自适应体积阴影贴图来渲染的头发和烟雾阴影。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240515091827-h080wne","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515091827-h080wne","updated":"20240515093749"},"Children":[{"Type":"NodeText","Data":"7.9 不规则Z-Buffer"}]},{"ID":"20240515091855-lcdzzbh","Type":"NodeParagraph","Properties":{"id":"20240515091855-lcdzzbh","updated":"20240515091947"},"Children":[{"Type":"NodeText","Data":"之前介绍的算法依赖于光栅化来对光源的观察视野进行规则（离散）采样。因此相机所看到的位置与光源所看到的位置并不是一一对应的。当"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"光源对表面的采样频率低于相机的采样频率"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"时，就会出现各种锯齿问题。"}]},{"ID":"20240515091943-0tc0xsl","Type":"NodeParagraph","Properties":{"id":"20240515091943-0tc0xsl","updated":"20240515092229"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"阴影体"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（shadow volume）算法提供了一个精确的、解析的解决方案，光源与表面的相互作用会生成一组三角形，对于任何的给定位置，它都可以判断该位置被光源照亮，还是位于阴影区域中。当在GPU上实现该算法时，它有一个严重的缺点，"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"那就是不可预测的、不稳定的计算成本"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240515092218-ujdk2o3","Type":"NodeParagraph","Properties":{"id":"20240515092218-ujdk2o3","updated":"20240515092243"},"Children":[{"Type":"NodeText","Data":"从长远来看，另一种阴影测试的方法十分具有潜力：光线追踪。(Ref: 11.2.2)"}]},{"ID":"20240515092327-k6lh618","Type":"NodeParagraph","Properties":{"id":"20240515092327-k6lh618","updated":"20240515092335"},"Children":[{"Type":"NodeText","Data":"另一种方法是使用GPU的光栅化硬件来观察场景，除了存储z深度之外，还会存储每个网格单元中，光源遮挡物的额外边缘信息。"}]},{"ID":"20240515092347-uymvjxw","Type":"NodeBlockquote","Properties":{"id":"20240515092347-uymvjxw","updated":"20240515092359"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240515092347-z7bf4da","Type":"NodeParagraph","Properties":{"id":"20240515092347-z7bf4da","updated":"20240515092359"},"Children":[{"Type":"NodeText","Data":"例如：假设在阴影贴图的每个纹素上，都存储一个与网格单元重叠的三角形列表，这样的三角形列表可以通过保守光栅化（conservative rasterization）来生成，在保守光栅化中，如果三角形的任何部分与像素发生重叠（而不仅仅是与像素中心重叠，Ref 23.1.2），就会生成一个片元。"}]}]},{"ID":"20240515092345-ihamube","Type":"NodeParagraph","Properties":{"id":"20240515092345-ihamube","updated":"20240515092420"},"Children":[{"Type":"NodeText","Data":"这种方案的一个问题是，"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"em text","TextMarkTextContent":"通常需要对每个纹素所存储的数据量进行限制，这反过来又可能会导致对每个接收物表面位置状态判定的不准确"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。"}]},{"ID":"20240515092421-dta11vk","Type":"NodeParagraph","Properties":{"id":"20240515092421-dta11vk","updated":"20240515092513"},"Children":[{"Type":"NodeText","Data":"不规则Z-buffer的思想是"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"在阴影贴图中存储接收物的位置，然后再用三角形对其进行检测"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。这个缓冲本身是一个正常的、规则形状的阴影贴图。相反，缓冲区中所包含的内容是不规则的，因为阴影贴图中的每个纹素，将会存储一个或者多个接收物的位置，又或者是根本没有存储任何数据，如下图："}]},{"ID":"20240515092523-yt05u70","Type":"NodeParagraph","Properties":{"id":"20240515092523-yt05u70","updated":"20240515092524"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"202306121721496"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/202306121721496-20240515092523-9jk517l.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240515092531-p8x83xg","Type":"NodeParagraph","Properties":{"id":"20240515092531-p8x83xg","updated":"20240515092608"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"图7.30：不规则z-buffer。左上角：相机视野在像素中心处生成了一组点，图中展示了两个三角形所形成的一个立方体面。右上角：从光源视角生成了这些点。左下角：在这些点上覆盖了一个阴影贴图网格，对于每个纹素而言，会根据其网格单元内的所有点来生成一个列表。右下角：通过使用保守光栅化，来对红色三角形进行阴影测试，与其发生重叠的每个纹素被显示为浅红色，这些纹素列表中的所有点，都会和三角形进行测试，从而计算光照的可见性。"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515092609-rlug7lg","Type":"NodeParagraph","Properties":{"id":"20240515092609-rlug7lg","updated":"20240515092728"},"Children":[{"Type":"NodeText","Data":"这个可见性测试会在像素着色器中进行。"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"测试本身可以看作是光线追踪的一种形式，它会从图像点的位置处，向光源发射一条光线"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"。如果这个光线与三角形平面的交点位于这个三角形内部，并且这个待测点的位置距离光源更远，那么就说明它会被遮挡。当所有的遮挡物都被光栅化之后，光源的可见性结果将会被用于表面着色。这个测试过程也被称为截锥体追踪（frustum tracing），因为这个三角形可以被认为是定义了一个截锥体，它会对位于截锥体内部的点进行检查。"}]},{"ID":"20240515092730-khub34g","Type":"NodeParagraph","Properties":{"id":"20240515092730-khub34g","updated":"20240515092751"},"Children":[{"Type":"NodeText","Data":"想要使得这种方法在GPU上很好地运行，需要格外仔细地编写代码。"}]},{"ID":"20240515092805-a883ufd","Type":"NodeParagraph","Properties":{"id":"20240515092805-a883ufd","updated":"20240515092805"},"Children":[{"Type":"NodeText","Data":"这种性能提升的部分原因是对算法的直接改进，"}]},{"ID":"20240515092809-88x6b4n","Type":"NodeBlockquote","Properties":{"id":"20240515092809-88x6b4n","updated":"20240515092809"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240515092809-puc0s2j","Type":"NodeParagraph","Properties":{"id":"20240515092809-puc0s2j","updated":"20240515092809"},"Children":[{"Type":"NodeText","Data":"例如：剔除表面法线背对光源的图像点（因为它们永远不会被这个光源照亮）；同时避免为空纹素生成片元。"}]}]},{"ID":"20240515093018-aqjaxh1","Type":"NodeParagraph","Properties":{"id":"20240515093018-aqjaxh1","updated":"20240515093024"},"Children":[{"Type":"NodeText","Data":"这种方法避免了其他方法会有的采样问题和偏移问题，并且可以提供完美的尖锐阴影。出于审美和感知的原因，通常我们都更希望实现软阴影的效果，但是这可能会与附近的遮挡物产生偏移问题，例如Peter Panning。"}]},{"ID":"20240515093025-eqo0t7z","Type":"NodeParagraph","Properties":{"id":"20240515093025-eqo0t7z","updated":"20240515093051"},"Children":[{"Type":"NodeText","Data":"可以混合阴影技术，例如当遮挡物距离较近时，则使用硬阴影；当遮挡物距离较远时，则使用软阴影。"}]},{"ID":"20240515092937-886n2c0","Type":"NodeParagraph","Properties":{"id":"20240515092937-886n2c0","updated":"20240515092939"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"202306121817335"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/202306121817335-20240515092937-eeok6wt.png"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240515092939-oc93c4e","Type":"NodeParagraph","Properties":{"id":"20240515092939-oc93c4e","updated":"20240515092959"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"图7.31：左图：PCF会为所有物体都生成均匀的软阴影。中间：PCSS会根据与遮挡物的距离，来对阴影进行软化，但是与板条箱左下角重叠的树枝阴影，会产生一些瑕疵。右图：将来自IZB的尖锐阴影与来自PCSS的柔和阴影进行混合，给出了一个改进的结果。"},{"Type":"NodeText","Data":"​"}]},{"ID":"20240515093000-voc3f7i","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515093000-voc3f7i","updated":"20240515093749"},"Children":[{"Type":"NodeText","Data":"7.10 其他应用"}]},{"ID":"20240515093112-xxql9ri","Type":"NodeParagraph","Properties":{"id":"20240515093112-xxql9ri","updated":"20240515093206"},"Children":[{"Type":"NodeText","Data":"将阴影贴图视为空间体积的一种定义来区分明暗，也有助于确定物体的哪些部分位于阴影区域中。"}]},{"ID":"20240515093226-166tzqw","Type":"NodeParagraph","Properties":{"id":"20240515093226-166tzqw","updated":"20240515093238"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"202306121918382"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/202306121918382-20240515093226-p86vzr1.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"图7.32：每个高度场位置都会计算第一次看见太阳时的高度，然后使用这个高度信息来渲染地形的阴影。请注意阴影边缘的树木，是如何被正确渲染出阴影的。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240515093238-5qjenzt","Type":"NodeParagraph","Properties":{"id":"20240515093238-5qjenzt","updated":"20240515093319"},"Children":[{"Type":"NodeText","Data":"最后一个值得一提的方法是渲染"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"屏幕空间阴影"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"（screen-space shadow）。"}]},{"ID":"20240515093320-sk75yt2","Type":"NodeParagraph","Properties":{"id":"20240515093320-sk75yt2","updated":"20240515093335"},"Children":[{"Type":"NodeText","Data":"由于分辨率的限制，阴影贴图通常无法在较小的几何形状上产生准确的遮挡。"}]},{"ID":"20240515093408-unscjq9","Type":"NodeParagraph","Properties":{"id":"20240515093408-unscjq9","updated":"20240515093413"},"Children":[{"Type":"NodeText","Data":"可以使用已经存在的数据结果来生成阴影。"}]},{"ID":"20240515093416-494mbeg","Type":"NodeParagraph","Properties":{"id":"20240515093416-494mbeg","updated":"20240515093543"},"Children":[{"Type":"NodeText","Data":"在大多数现代渲染引擎中，来自相机视角的深度缓冲，会在较早的pass中生成，它在后续的渲染阶段中都是可以使用的。存储在深度缓冲的数据可以被视为一个场景高度场。通过对这个深度缓冲的迭代采样，我们可以执行一个光线步进的过程（Ref 6.8.1 "},{"Type":"NodeTextMark","TextMarkType":"block-ref","TextMarkBlockRefID":"20240429201045-jyxljhi","TextMarkBlockRefSubtype":"d","TextMarkTextContent":"Chapter6 纹理 Texturing"},{"Type":"NodeText","Data":"），并检查到光源的方向是否会被遮挡。"}]},{"ID":"20240515093438-cdk9nuw","Type":"NodeHeading","HeadingLevel":1,"Properties":{"id":"20240515093438-cdk9nuw","updated":"20240515093749"},"Children":[{"Type":"NodeText","Data":"7.11 总结"}]},{"ID":"20240515093601-ncol7ym","Type":"NodeParagraph","Properties":{"id":"20240515093601-ncol7ym","updated":"20240515093715"},"Children":[{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"阴影映射"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"算法是目前为止最为常用的，它可以将阴影投射到任意表面上。当阴影投射在一个较大的区域时（例如室外场景），使用"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"级联阴影贴图（CSM）"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"可以提高采样质量。通过"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"SDSM"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"算法，来为近裁剪平面找到一个合适的最大距离，可以进一步提高精度。"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"PCF"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"可以在一定程度上软化阴影；"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"PCSS及其变体方法"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"，可以赋予阴影接触硬化的特点，即让shadow caster在接触处的阴影变得尖锐；而"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"IZB"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"可以提供精确的硬阴影效果。"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"滤波阴影贴图"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"可以快速计算的软阴影效果，并且当遮挡物距离接收物较远时（例如地形），它的效果特别好。最后，"},{"Type":"NodeTextMark","Properties":{"style":"color: var(--b3-font-color5);"},"TextMarkType":"text","TextMarkTextContent":"屏幕空间中"},{"Type":"NodeKramdownSpanIAL","Data":"{: style=\"color: var(--b3-font-color5);\"}"},{"Type":"NodeText","Data":"的相关技术可以提高精度，但是其计算成本较高。"}]},{"ID":"20240515093734-rfjyrjw","Type":"NodeParagraph","Properties":{"id":"20240515093734-rfjyrjw","updated":"20240515093747"},"Children":[{"Type":"NodeImage","Data":"span","Properties":{"parent-style":"display: block;"},"Children":[{"Type":"NodeBang"},{"Type":"NodeOpenBracket"},{"Type":"NodeLinkText","Data":"202306121955358"},{"Type":"NodeCloseBracket"},{"Type":"NodeOpenParen"},{"Type":"NodeLinkDest","Data":"assets/202306121955358-20240515093734-25m17dw.png"},{"Type":"NodeLinkSpace"},{"Type":"NodeLinkTitle","Data":"图7.33：第一行图片是使用基本的软阴影近似技术生成的。第二行图片展示了基于体素的面光源阴影效果，它是在一个体素化的场景中，使用锥形追踪来生成的。请注意观察两幅图片中汽车的漫反射阴影。第二行图片中的光照效果还可以随着一天中时间的变化而变化。"},{"Type":"NodeCloseParen"}]},{"Type":"NodeKramdownSpanIAL","Data":"{: parent-style=\"display: block;\"}"}]},{"ID":"20240515093749-ykv8cu1","Type":"NodeParagraph","Properties":{"id":"20240515093749-ykv8cu1"}}]}