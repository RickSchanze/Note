{"ID":"20240213193613-u4cc2j7","Spec":"1","Type":"NodeDocument","Properties":{"id":"20240213193613-u4cc2j7","title":"malloc、free和new、delete区别","updated":"20240213195641"},"Children":[{"ID":"20240213193632-ivs504q","Type":"NodeParagraph","Properties":{"id":"20240213193632-ivs504q","updated":"20240213194115"},"Children":[{"Type":"NodeText","Data":"malloc/free为C语言库函数，new/delete为C++操作符"}]},{"ID":"20240213193722-ge415ac","Type":"NodeList","ListData":{},"Properties":{"id":"20240213193722-ge415ac","updated":"20240213195641"},"Children":[{"ID":"20240213193727-m4l1ytg","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240213193727-m4l1ytg","updated":"20240213193727"},"Children":[{"ID":"20240213193727-lr8weer","Type":"NodeParagraph","Properties":{"id":"20240213193727-lr8weer","updated":"20240213193750"},"Children":[{"Type":"NodeText","Data":"new 自动计算所需分配内存大小，malloc需要手动计算"}]}]},{"ID":"20240213193750-5vrpo47","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240213193750-5vrpo47"},"Children":[{"ID":"20240213193750-c8qvjf0","Type":"NodeParagraph","Properties":{"id":"20240213193750-c8qvjf0","updated":"20240213193807"},"Children":[{"Type":"NodeText","Data":"new 返回对象类型指针，malloc返回void*，需要类型转换"}]}]},{"ID":"20240213193807-aggbi1o","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240213193807-aggbi1o"},"Children":[{"ID":"20240213193807-19k1ln3","Type":"NodeParagraph","Properties":{"id":"20240213193807-19k1ln3","updated":"20240213193825"},"Children":[{"Type":"NodeText","Data":"new 分配失败抛出异常，malloc分配失败返回NULL"}]}]},{"ID":"20240213193825-4kacx6h","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240213193825-4kacx6h","updated":"20240213195641"},"Children":[{"ID":"20240213193825-5s4amwg","Type":"NodeParagraph","Properties":{"id":"20240213193825-5s4amwg","updated":"20240213193943"},"Children":[{"Type":"NodeText","Data":"new 是在free store（自由存储区）分配，malloc通常在堆上分配"}]},{"ID":"20240213193943-5hc10tz","Type":"NodeParagraph","Properties":{"id":"20240213193943-5hc10tz","updated":"20240213193959"},"Children":[{"Type":"NodeText","Data":"new流程："}]},{"ID":"20240213194002-58cgoce","Type":"NodeParagraph","Properties":{"id":"20240213194002-58cgoce","updated":"20240213194048"},"Children":[{"Type":"NodeText","Data":"operator new ➡ 申请足够空间 ➡ 调用构造函数（初始化成员变量）"}]},{"ID":"20240213194500-l5andac","Type":"NodeParagraph","Properties":{"id":"20240213194500-l5andac","updated":"20240213194500"},"Children":[{"Type":"NodeText","Data":"自由存储区是C++基于new操作符的一个抽象概念，凡是通过new操作符进行内存申请，该内存即为自由存储区。"}]},{"ID":"20240213195036-1t9g0vp","Type":"NodeBlockquote","Properties":{"id":"20240213195036-1t9g0vp","updated":"20240213195641"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240213195048-hc6o5i9","Type":"NodeParagraph","Properties":{"id":"20240213195048-hc6o5i9","updated":"20240213195140"},"Children":[{"Type":"NodeText","Data":"malloc分配的是物理内存吗？是否立刻获得物理内存？"}]},{"ID":"20240213195058-wznyyj6","Type":"NodeParagraph","Properties":{"id":"20240213195058-wznyyj6","updated":"20240213195148"},"Children":[{"Type":"NodeText","Data":"不，分配的是虚拟内存。不是立刻获取物理内存。"}]},{"ID":"20240213195116-jsv7eji","Type":"NodeParagraph","Properties":{"id":"20240213195116-jsv7eji","updated":"20240213195641"},"Children":[{"Type":"NodeText","Data":"只有在访问已分配的虚拟地址空间的时候，操作系统通过查找页表，发现虚拟内存对应的页没有在物理内存中，就会触发缺页中断，然后操作系统会建立虚s拟内存和物理内存之间的映射关系。"}]}]},{"ID":"20240213195626-sybom6g","Type":"NodeBlockquote","Properties":{"id":"20240213195626-sybom6g","updated":"20240213195638"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240213195632-lwcsc9o","Type":"NodeParagraph","Properties":{"id":"20240213195632-lwcsc9o","updated":"20240213195632"},"Children":[{"Type":"NodeText","Data":"什么场景下 malloc() 会通过 brk() 分配内存？又是什么场景下通过 mmap() 分配内存？"}]},{"ID":"20240213195638-4l9k9xt","Type":"NodeList","ListData":{},"Properties":{"id":"20240213195638-4l9k9xt","updated":"20240213195638"},"Children":[{"ID":"20240213195638-cw106n2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240213195638-cw106n2","updated":"20240213195638"},"Children":[{"ID":"20240213195638-llx5pss","Type":"NodeParagraph","Properties":{"id":"20240213195638-llx5pss","updated":"20240213195638"},"Children":[{"Type":"NodeText","Data":"如果用户分配的内存小于 128 KB，则通过 brk() 申请内存；"}]}]},{"ID":"20240213195638-7kir8he","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240213195638-7kir8he","updated":"20240213195638"},"Children":[{"ID":"20240213195638-ntpj8nc","Type":"NodeParagraph","Properties":{"id":"20240213195638-ntpj8nc","updated":"20240213195638"},"Children":[{"Type":"NodeText","Data":"如果用户分配的内存大于 128 KB，则通过 mmap() 申请内存；"}]}]}]}]}]},{"ID":"20240213194503-13lddv2","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20240213194503-13lddv2","updated":"20240213195451"},"Children":[{"ID":"20240213194503-mq3p387","Type":"NodeParagraph","Properties":{"id":"20240213194503-mq3p387","updated":"20240213194544"},"Children":[{"Type":"NodeText","Data":"delete 需要对象类型指针，free只需要一个void*类型指针"}]},{"ID":"20240213194558-y27imlq","Type":"NodeParagraph","Properties":{"id":"20240213194558-y27imlq","updated":"20240213194607"},"Children":[{"Type":"NodeText","Data":"原因是delete里要调用析构函数"}]},{"ID":"20240213194610-m2j6s3n","Type":"NodeParagraph","Properties":{"id":"20240213194610-m2j6s3n","updated":"20240213194616"},"Children":[{"Type":"NodeText","Data":"delete流程："}]},{"ID":"20240213194616-txdgqfm","Type":"NodeParagraph","Properties":{"id":"20240213194616-txdgqfm","updated":"20240213194657"},"Children":[{"Type":"NodeText","Data":"析构函数 ➡ operator delete ➡ 释放空间"}]},{"ID":"20240213194704-x3tq23w","Type":"NodeBlockquote","Properties":{"id":"20240213194704-x3tq23w","updated":"20240213195248"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240213194721-oen2d2q","Type":"NodeParagraph","Properties":{"id":"20240213194721-oen2d2q","updated":"20240213194752"},"Children":[{"Type":"NodeText","Data":"free如何知道需要释放多大的空间？"}]},{"ID":"20240213194753-u80vc6z","Type":"NodeParagraph","Properties":{"id":"20240213194753-u80vc6z","updated":"20240213195247"},"Children":[{"Type":"NodeText","Data":"malloc分配空间时会在申请内存前方多申请16字节空间，用于存储内存块的描述信息，在free时会向前寻找这16字节，用于获知需要释放内存的大小"}]}]},{"ID":"20240213195248-ouddhx1","Type":"NodeBlockquote","Properties":{"id":"20240213195248-ouddhx1","updated":"20240213195451"},"Children":[{"Type":"NodeBlockquoteMarker","Data":"\u003e"},{"ID":"20240213195255-x3htv75","Type":"NodeParagraph","Properties":{"id":"20240213195255-x3htv75","updated":"20240213195305"},"Children":[{"Type":"NodeText","Data":"free后内存还在吗？"}]},{"ID":"20240213195306-i4g1ran","Type":"NodeParagraph","Properties":{"id":"20240213195306-i4g1ran","updated":"20240213195451"},"Children":[{"Type":"NodeText","Data":"如果是通过brk或内存池中申请的内存空间，那么内存只是回到了内存池里，而如果通过mmap申请则会立刻释放"}]}]}]}]},{"ID":"20240213193613-8d6vegz","Type":"NodeParagraph","Properties":{"id":"20240213193613-8d6vegz","updated":"20240213194116"}}]}